<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues | Jeha DevLog</title><meta name=keywords content><meta name=description content="첫 번째, DOM 생성과 fetch 사용을 위한 Javascript 학습 후기를 남겨본다. 두 번째, DOM을 조작하여 개발한 과정과 fetch를 사용하여 개발한 각 과정에서 일어난 여러 개발 issue들에 대해 정리해본다."><meta name=author content="Me"><link rel=canonical href=http://jeha00.github.io/post/project/devket/js/dom_fetch_issue/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.8330bf30523628d00ababead16d63a7b5cd7570bd4901cb3c11ec258628d7a67.css integrity="sha256-gzC/MFI2KNAKur6tFtY6e1zXVwvUkByzwR7CWGKNemc=" rel="preload stylesheet" as=style><link rel=icon href=http://jeha00.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://jeha00.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://jeha00.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://jeha00.github.io/apple-touch-icon.png><link rel=mask-icon href=http://jeha00.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.101.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues"><meta property="og:description" content="첫 번째, DOM 생성과 fetch 사용을 위한 Javascript 학습 후기를 남겨본다. 두 번째, DOM을 조작하여 개발한 과정과 fetch를 사용하여 개발한 각 과정에서 일어난 여러 개발 issue들에 대해 정리해본다."><meta property="og:type" content="article"><meta property="og:url" content="http://jeha00.github.io/post/project/devket/js/dom_fetch_issue/"><meta property="og:image" content="http://jeha00.github.io/47"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-11-20T18:25:52+09:00"><meta property="article:modified_time" content="2022-11-20T18:25:52+09:00"><meta property="og:site_name" content="JeHa00 DevLog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://jeha00.github.io/47"><meta name=twitter:title content="Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues"><meta name=twitter:description content="첫 번째, DOM 생성과 fetch 사용을 위한 Javascript 학습 후기를 남겨본다. 두 번째, DOM을 조작하여 개발한 과정과 fetch를 사용하여 개발한 각 과정에서 일어난 여러 개발 issue들에 대해 정리해본다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://jeha00.github.io/post/"},{"@type":"ListItem","position":2,"name":"Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues","item":"http://jeha00.github.io/post/project/devket/js/dom_fetch_issue/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues","name":"Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues","description":"첫 번째, DOM 생성과 fetch 사용을 위한 Javascript 학습 후기를 남겨본다. 두 번째, DOM을 조작하여 개발한 과정과 fetch를 사용하여 개발한 각 과정에서 일어난 여러 개발 issue들에 대해 정리해본다.","keywords":[],"articleBody":"1. DOM 생성과 fetch function 사용을 위한 Javascript 학습 후기 1.1 새로운 언어의 학습 방법 선택하기 파이썬 언어를 학습한 후, 또 다른 프로그래밍 언어를 학습하는 건 처음이어서 파이썬을 학습했던 것처럼 똑같이 하면 될지 고민이 되었다. 만약 파이썬을 학습한 것처럼 파이썬 자체만을 깊이 파는 문법 강의를 통해서 한다면 짧은 프로젝트 기간을 고려하면 좋지 않다.\n고민 중에 이번 부트캠프에서 book study 시간에 읽었던 함께 자라기에서 본 내용이 문득 기억났다. 프로그래밍 언어는 도구임을 기억하여 바로 사용하고, 막히면 문법 내용으로 돌아오는 이 전환과 피드백이 빠를수록 학습이 빠르다고 했다. (독서를 할 때 단지 읽은 것에서 끝내지 않고, 정리하는 것과 함께 읽는 것이 필요하며 나에게 맞는 학습 방법임을 느낀 계기였다.)\n그래서 짧은 기간 안에 만들어야 하기 때문에 해외 유튜브에서 DOM을 자바스크립트로 생성하는 외국 엔지니어의 영상을 따라하며 이해했다. 그리고 바로 프로젝트에 적용했고, 그 과정에서 막히는 부분과 에러 부분은 MDN 문서로 바로 돌아와 놓친 부분을 빠르게 매꿔서 진행했다.\n그 결과가 다음과 같다. PR 날짜만을 보고 판단했을 때 event를 추가하는 것 없이 렌더링 부분만 대략 5일 정도 걸린 것으로 판단된다. 멘토링을 해줬던 멘토님이 처음 프로젝트를 진행하는데 이 속도로 진행한 건 많이 한 것이라는 평가를 들어서 기분이 좋았다.\nFEAT: Rendering mylist view and bottom-toolbar under each item #28 1.2 자발적으로 더 맡아서 진행하기 이 평가가 기분이 유독 좋았던 이유는 다음과 같다. 팀원들을 위해서 스스로 더 압박감을 느끼며 진행했지만, 그 결과 팀 전체 도움과 내 자신의 성장을 이끌 수 있었기 때문이다.\n이 화면단 개발은 우리 프로젝트에서 화면적으로 반드시 개발되어야하는 부분이었다. 하지만 각자 맡은 메인 기능들에 대해 완성된 후 위 이미지의 사이드바 부분을 나눠서 개발하기로 했기 때문에, 자신이 맡은 개발 기능들에 연구 개발을 하느라 팀원들은 시간을 할애하지 못하는 상황이었다.\n이런 상황에서 내 자신에게 도전적인 과제를 던져주기로 결정했다.\n첫 번째 이유 이런 결정을 한 첫 번째 이유는 프로젝트 기한을 고려했을 때 누군가가 더 맡아서 이 부분을 빠르게 구현한다면 프로젝트를 진행하는데 있어서 진행률이 많이 빨라지고, 다른 팀원들도 시각적으로 작동되는 게 보이기 때문에 프로젝트를 이해하고 개발하는데 도움이 될거라 판단했기 때문이다. 왜냐하면 위 이미지의 ‘내 목록’에 각 저장된 사이트들과 하단툴바가 나타나는 것처럼 사이드바 부분의 각 탭에서 나오는 방식이 다 동일하기 때문이다. 단지 ORM을 사용하여 filter로 가져오는 값들이 다를 뿐이다.\n두 번째 이유 또한, 전체 팀원 4명 중 개발 경험이 거의 없는 인원이 나 포함 3명이었기 때문에, 최악의 경우로 각자 맡은 기능들을 개발하다가 시간적인 여유가 없어서 이 부분을 개발하지 못하는 상황까지 고려했다.\n그래서 스스로 도전 과제를 주어 기한을 1주일 정도 정하여 내 자신에게 압박감을 주면서 진행했다. 그 결과, 기본적으로 저장된 사이트를 렌더링하는 DOM은 다 형성했다. 사이드 바에서는 즐겨찾기, 아티클, 동영상 부분의 ORM filter 부분을 짜서 끝냈다.\n1.3 DOM 학습 후기 처음 DOM을 조작하는 것이기 때문에, 저장된 사이트들을 목록에 보여주는 DOM을 생성하는 건 시간이 걸렸다. 그 이유는 진행한 프로젝트는 클론 코딩이기 때문에, html 구조와 css는 거의 그대로 사용하기 위해 html의 class name과 id name을 브라우저의 개발자 도구로 분석하며 가져오느라 오래 걸렸다.\n또한, html 구조와 css는 거의 그대로 사용할 것이기 때문에 class name이 직관적이지 않아도 가져온 이유다. 직접 수정할 수도 있겠지만, 이 프론트 영역까지 파고들고 싶지 않았으며 그 시간에 백엔드 구축에 집중하고 싶었다.\n이후에 ‘하단 툴바’와 modal 창을 렌더링할 때는 금방 DOM 생성 코드를 짤 수 있었다. 이후부터 DOM을 지정하고, 삭제하고, 수정하는 것에 어려움을 느끼지 못했다.\n하지만, React를 사용하지 않고 vanilla js로 다 하다보니 코드 길이가 많이 길어졌다. 하지만 React를 사용하면 손쉽게 생성된다고 한다. 프레임워크의 중요성을 느낀 계기가 되었다.\n1.4 fetch 함수 학습 및 사용 후기 Front와 Back 간의 흐름 이해 fetch 함수를 사용하기 전까지는 api를 통해서 프론트와 백엔드가 어떻게 통신을 하는지 코드적으로 이해할 수가 없었다. 즉, 눈에 보이지 않았다. 하지만 내가 구축한 api를 fetch를 사용해서 통신을 직접 해보니 확실히 이해할 수 있었다. 백엔드에서 구축한 api를 fetch를 사용하여 request를 보내면 django의 views.py의 view method(or function)에서 request로 받아 그 과정에서 짜놓은 로직에 따라서 CRUD 상황이 이뤄지고, response를 반환하면 fetch 함수에서 response로 그 결과 값을 반영할 수 있다. 이 response 값에 따라서 DOM 조작이 이뤄진다.\n그래서 Django가 MTV (Model - Template - View) pattern에서 View가 controller의 역할을 한다는 걸 느꼈다. Django의 MTV 는 기본적으로 MVC 패턴과 동일하다.\n출처: 루나의 TIL 기술 블로그\nMVC에 대응되는 MTV 설명은 Django - MVC 패턴과 MTV 패턴을 참조한다.\nfetch 학습 DOM을 익히면서 유튜브와 공식문서를 반복하여 개발하는 동안, 공식 문서로 빠르게 피드백을 받은 경험을 통해서 fetch 함수를 익힐 때는 유튜브 영상은 안보고 공식 문서와 stackoverflow만을 사용하여 작성할 수 있었다. 하지만 fetch의 경우 비동기적으로 작동하기 때문에 어려움이 있었다. 하지만 이 부분에 대해서도 글로 정리한다.\n2. DOM 렌더링 코드 작성 시 issue 사항 2.1 Custom 함수 만들어 팀 공용으로 사용하기 렌더링 시 자주 사용되는 함수들은 별도로 정의하여 코드 수를 줄이고, 보다 직관적으로 만들기 위해 노력했다. 그 이유는 React가 아닌 vanilla JS로 렌더링하는 것이기 때문에 코드 양이 상대적으로 매우 많아지기 때문이다. 계속해서 document.createElement를 사용해도 되겠지만, 이보다는 createNode 함수를 만들어서 보다 코드를 짧고 직관적으로 만들었다.\n아래 함수로 끝나는 것이 아닌 계속해서 추가했으며, common.js라는 이름의 별도 파일을 생성하여 앞으로 팀 공용으로 사용하면 좋은 함수들에 대해 PR 승인 후 합쳐서 같이 사용하는 방식으로 팀 방식을 진행했다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 // common.js function createNode(tag) { /* tag를 생성하는 함수 */ return document.createElement(tag); } function appendTag(parent, element) { /* parent tag에 child tag를 추가하는 함수 */ return parent.appendChild(element); } 2.2 함수 기능 분리 크롤링으로 가져온 사이트들을 hover 시, 하단에 뜨는 툴바를 렌더링하는 함수다. 하단 툴바에는 즐겨찾기 기능, 카테고리 분류 기능, 태그 추가 기능, 삭제 기능이 있어서 이를 위한 태그 렌더링이 필요하다.\n처음에는 makeBottomToolbar function에 위 기능을 제공하는 태그 렌더링 코드를 다 작성했다.\n하지만, 코드의 길이가 너무 길어지고 내부 내용을 구분하기 어렵기 때문에, 다음과 같이 makeFavoriteInToolBar, makeCategoryInToolBar 등등 별도의 함수로 만들어서 makeBottomToolbar 를 통해 실행되도록 설계했다. 그리고 주석을 작성하여 다시 한번 구분했다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 function makeBottomToolbar(parentNode) { /*각 사이트마다 하단 툴바를 만드는 함수*/ // bottom toolbar container - footer const footer = createNode('footer') footer.className = 'footer' appendTag(parentNode, footer) const itemActionsContainer = createNode('div') itemActionsContainer.className = 'i18uycg6 actions' appendTag(footer, itemActionsContainer) const itemActions = createNode('div') itemActions.className = 'item-actions' appendTag(itemActionsContainer, itemActions) // bottom toolbar - favorite makeFavoriteInToolBar(itemActions) // bottom toolbar - category makeCategoryInToolBar(itemActions) // bottom toolbar - tag makeTagInToolBar(itemActions) // bottom toolbar - delete makeDeleteInToolBar(itemActions) } 2.3 렌더링 시 시간 복잡도 고려 issue 각 저장된 사이트(post)를 내 목록에 렌더링할 때, 전체 항목을 렌더링하고 나서 각 항목에 하단 툴바를 렌더링했다. 즉 크롤링해서 가져온 사이트들을 먼저 각각 렌더링 후, 각 사이트마다 하단툴바를 렌더링을 시도했다.\n실행결과를 보면서 이럴 경우 저장된 사이트의 수 만큼 다시 또 반복하는 것이기 때문에, 파이썬으로 생각하자면 for문을 두 번 돌리는 것과 동일하다고 판단하여 시간 복잡도가 O(2n)이 되므로, 각 항목을 렌더링할 때 하단 툴바도 같이 렌더링하여 O(n)이 되도록 수정했다. 또한, 현재는 DB에 저장된 사이트 수가 적어서 문제가 없겠지만, 저장된 데이터량이 많아진다면 렌더링 속도에 가시적으로 영향을 줄 거라 판단했기 때문이다.\n그래서 다음 아래와 같이 renderItem function에 makeBottomToolbar function을 포함시켰다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 function renderItem(post) { /* 각 post의 tag를 rendering 하는 함수 */ const article = createNode('article') article.className = 'c18o9ext grid hiddenActions noExcerpt' appendTag(root, article) const item = createNode('div') item.className = 'cardWrap' appendTag(article, item) ... // 각 항목(item)의 하단 툴바 makeBottomToolbar(article) } 2.4 svg icon이 인식되지 않는 문제 문제점 [Pull requests]\nEdit html about premium, mylist and Refactor bottom-toolbar.js #51 Rendering mylist view and bottom-toolbar under each item #28 각 항목에 mouse를 hover 시, 하단에 뜨는 하단 툴바를 만들기 위해서 DOM을 생성하는 과정에서 부딪힌 문제점이다. svg icon을 사용하기 위해서 node를 생성해야 하는데, 생성되지 못한 문제점이 있었다.\n프로젝트의 클론 코딩 대상 사이트는 아이콘을 tag보다 를 사용한다. 그래서 다른 태그를 생성하는 것과 동일한 방식을 사용했다.\ncreateNode와 appendTag function을 사용하여 svg tag와 path tag를 생성 .className을 사용하여 class name을 추가 속성명에 -가 있는 건 dot annotation으로 추가 못하기 때문에 setAttribute() 사용 하지만 아이콘이 브라우저에 형성되지 않는 문제를 발견했다. 클론 코딩 대상의 프로젝트 tag 속성을 개발자 도구로 분석하면서 관련 속성들을 하나씩 지워보고, 순서도 바꿔보고, 새로운 html을 생성하여 해당 태그들만 추가해보고, stackoverflow와 여러 구글링을 통해 피드백 받은 방안들을 적용해봤지만 svg icon이 형성되지 않았다.\n이 문제로 2~3일을 소비했기 때문에, 임시로 i tag를 사용하기로 결정하여, fontawesome site를 선택하여 유사한 icon을 선택하여 사용했다.\n마지막으로, 팀원들이 이 시행착오를 겪지 않도록 하기 위해 코드 리뷰 시간에 공유했다.\n해결책 다른 팀원 또한 렌더링하는 과정에서 svg icon 문제에 똑같이 부딪혔고, 내가 공유한 과정들을 통해 다른 방식을 적용하여 문제를 해결했다.\n해결한 방법은 setAttribute로 하면 인식되지 않았지만 html를 통채로 입력하니 가능했다.\n이 때 변수를 insertAdjacentHTML을 사용한 이유는 다음과 같다.\nclassName과 속성들을 별도로 입력하는 방식이 작동되지 않기 때문에, 통째로 입력하는 방법을 선택했다. 그래서 HTML을 통째로 원하는 DOM tree 안에 node들을 추가하기 위해 함수 ‘insertAdjacentHTML’ 를 사용했다.\n사용 방식은 element.insertAdjacentHTML(position, text)와 같다. 이 함수의 사용 방법 출처는 MDN - Element.insertAdjacentHTML()을 참고했다.\n’text’에 들어갈 svg를 담은 변수를 let으로 선언한 이유는 재정의할 수도 있기 때문이다. 클론 코딩의 상단 툴바의 경우 아이콘이 변하는 경우가 있어서 let으로 선언했지만, 하단 툴바의 경우에는 그렇지 않기 때문에 아래 코드의 let은 const로 수정해야하는 부분이다.\nlet \u0026 const\n재선언 재할당 let X O const X X position\nposition 설명 beforebegin element 앞에 afterbegin element 안에 가장 첫번째 chid beforeend element 안에 가장 마지막 child afterend element 뒤에 클론 코딩의 대상 사이트의 svg DOM 구조가 다음과 같았다.\n1 2 3 4 5 \u003cspan\u003e \u003csvg\u003e \u003cpath\u003e\u003c/path\u003e \u003c/svg\u003e \u003c/span\u003e 그래서 favoriteIconContainer이 에 가 들어가기 위해서 favoriteIconContainer.insertAdjacentHTML('beforeend', favoriteIconSvgHTML)을 한 후, 안에 를 넣기 위해서 favoriteIconSvg.insertAdjacentHTML('beforeend', favoriteIconPathHTML)으로 작성했다.\n여기서 beforeend를 선택한 이유는 의 경우, svg icon의 종류에 따라서 복수로 존재하기도 했다. 그래서 tag 순서를 작성한대로 순서를 원래의 것과 유지하여 직관적으로 순서를 바로 확인할 수 있도록 이를 사용했다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 const favoriteButton = createNode('button') ... const favoriteIconContainer = createNode('span') favoriteIconContainer.className = 'i1qqph0t icon' appendTag(favoriteButton, favoriteIconContainer) let favoriteIconSvgHTML = `` favoriteIconContainer.insertAdjacentHTML('beforeend', favoriteIconSvgHTML) const favoriteIconSvg = getElement('.favorite-icon-svg') let favoriteIconPathHTML = '' favoriteIconSvg.insertAdjacentHTML('beforeend', favoriteIconPathHTML) ❗️ let을 const로 수정하기\n2.5 Modal 창을 통한 삭제 기능 issue 발생된 issue [Pull requests]\nModifiy api-url and add delete function by bottom-toolbar #42 [Issue 배경]\n저장된 사이트의 하단 툴바 삭제 기능을 클릭하여, 모달 창이 뜨면 이 모달 창으로 삭제를 진행하는 방식으로 개발했다. 모달 창을 통해서 삭제를 진행하는 이유는 삭제하면 이 사이트 저장을 되돌릴 수 없기 때문에, 경고를 하는 게 유저 편의성을 높이는 방향이라고 생각했기 때문이다.\n[발생된 issue]\n한 사이트의 하단 툴바 삭제 아이콘을 클릭하여 모달 창의 삭제버튼으로 삭제를 진행할 때, 하단툴바가 달려있던 한 사이트만 삭제가 되야하는데 저장된 모든 사이트가 다 삭제되는 이슈가 발생했다.\nissue 발생했을 때 삭제 기능 함수 호출 순서 원인 코드와 해결과정을 작성하기에 앞서 먼저 하단 툴바의 삭제 버튼을 클릭하여, 모달창이 띄어지고, 삭제를 실행하는 전체 흐름 함수를 확인해보자.\n저장된 사이트(site)의 정보를 토대로 목록에 렌더링하는 함수인 renderItem(site) 에서 시작된다.\nrenderItem(site) -\u003e makeBottomToolbar(, site) -\u003e makeDeleteInToolBar(, site) -\u003e openModal() -\u003e Modal 창 오픈\nmakeModal() -\u003e deleteSite() -\u003e closeModal -\u003e window.location.reload()\nmakeModal에 의해서 모달창은 브라우저 창이 load 시, 기본적으로 만들어지지만 화면에 나타나지 않도록 설계했다. 미리 만든 이유는 기본적으로 만들어서 있는 게 버튼을 클릭 이벤트 때마다 렌더링하는 것보다 속도가 빠르다고 생각했기 때문이다. 그래서 openModal()은 기존 class와 tag에 class name을 추가하여 모달창이 보이도록 한다.\n또한, makeModal()을 makeDeleteInToolBar() 안에 넣을 수 없는 이유는 모달창은 1개만 필요하기 떄문이다. 만약 makeDeleteInToolBar 안에서 makeModal이 호출된다면 저장된 사이트 수만큼 하단 툴바가 생성되고, 그만큼 모달창이 생성된다.\n원인 저장된 사이트들을 화면에 렌더링할 때 태그 속성을 식별자로 만들기 위해서 태그 속성 id의 값으로 각 site의 DB에 저장된 id 값으로 정했다.\n❗️ 태그 속성 id의 값으로 db의 id 값을 입력한 것은 보안적으로 좋지 않기 때문에, 프로젝트 완성을 위해 다시 개발할 때 수정할 예정이다.\n리액트의 경우, 자동적으로 이 태그들을 구분하기 때문에 식별자가 필요하다고 한다. 하지만 우리는 바닐라 js로 하기 때문에 필요했다.\n하지만 모달 창을 통해 삭제할 때 이 모든 site의 id를 가져오기 때문에 발생된 issuse다. 식별을 위해서 입력했지만, 정작 코드 상 식별의 역할을 하지 못했다.\n해결 과정 이 issue를 해결하는 초기 과정에서는 무엇이 원인인지 알 수 없어서, 다음과 같이 views.py의 해당 method를 print 문을 통해서 확인해보았다.\n1 2 3 4 5 6 7 8 9 10 def delete(self, request, pk): site = self.get_object(pk) print(f'before delete site: {site}') site.delete() print(f'after delete site: {site}') return Response({'msg': 'Deleted successfully'}, status=status.HTTP_200_OK) 실행한 결과 터미널에서 모든 항목들이 하나씩 하나씩 출력되었다. 의도치 않게 자바스크립트에서 전체 사이트들이 포함된 배열로 보내져서 이것이 하나씩 삭제되는 건가 추측했지만, 터미널의 결과를 보니 그렇지 않았다. 한 항목의 하단 툴바 삭제 기능을 눌러 실행한 것이지만, 각 항목의 하단 툴바 삭제 버튼을 모든 항목에 대해서 클릭하여 일어난 것과 동일한 결과이기 때문이다.\n1 2 before delete site: .... before delete site: .... 그래서 이번에는 javascript 함수인 makeDeleteInToolBar, makeModalActive, deleteSite 에 각각 console.log(site) 를 입력하여 브라우저 콘솔 창에 확인하니 삭제 버튼을 실행하지 않아도 위 각 함수에서 모든 항목이 출력되는 걸 확인했다. 이는 js 문제이며 식별자 문제임을 확인했다.\n만약 리액트로 이를 구현했다면, 리액트에서는 각 항목들을 구분하는 별도의 값을 자동적으로 만들어주기 때문에 이런 문제에 부딪히지 않는다고 멘토님을 통해 확인했다.\n그래서 각 항목들을 확실하게 구별할 수 있는 식별자를 만들어, 이 식별자에 접근하여 삭제하는 방식을 권하셨다. 이에 대한 구체적인 방안으로 각 항목의 하단 툴바 삭제 버튼을 클릭하면 해당 항목의 class에 selected 를 추가한다.\n1 2 3 4 5 6 7 8 9 10 function makeDeleteInToolBar() { deleteButton.addEventListener('click', () =\u003e { const article = document.getElementById(`${site.id}`) // 추가 article.classList.add('selected') openModal(deleteButton) })} 그리고 selected가 클래스 값에 있는 태그를 가져와, 이 태그의 id 값을 fetch에 입력하여 view 단에 보내는 흐름으로 구성했다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 function deleteSite() { /* DELETE http message를 보내는 함수 */ const site = getElement('.c18o9ext.grid.hiddenActions.noExcerpt.selected') const csrftoken = getCookie('csrftoken'); const data = { method: 'DELETE', headers: { 'content-type': 'application/json', 'X-CSRFToken' : csrftoken, }, } fetch(`/api/sites/${site.id}`, data) .then(response =\u003e { const status = response.status if (status === 200) { console.log('삭제 완료했습니다.') } else if (status === 404) { console.log('해당 항목이 존재하지 않습니다.') } return response.json() }) .catch(error =\u003e console.log('Error:', error)) } 삭제 후, 화면을 다시 불러오기 위해서 window.location.reload()를 사용한다.\n최종 호출 순서 문제 상황을 해결하고, 다른 팀원들도 공통으로 사용할 수 있도록 모달창을 모듈화한 최종 함수 호출 흐름은 다음과 같다.\nissue 발생 시 함수 호출 흐름: renderItem(site) -\u003e makeBottomToolbar(, site) -\u003e makeDeleteInToolBar(, site) -\u003e\n최종 함수 호출 흐름: renderItem(site) -\u003e makeBottomToolbar(, site) -\u003e makeDeleteInToolBar(, site) -\u003e openModal(param) -\u003e makeModal(param) -\u003e deleteSite()\n내가 코드를 작성했을 때 모달창 렌더링은 하단 툴바에서만 사용하는 경고 텍스트, 버튼 이름이었지만, 이를 상단 툴바나 이외의 곳에서 팀원들이 같이 사용하기 위해서 팀원들 모두 동의 하에 모듈화를 진행했다. 그래서 param의 역할은 모듈로 사용되기 위해서 다음과 같이 만들어진 객체다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // 하단 툴바의 모달창 Parameter let modalParam = { func : deleteSite, type : 'bottom', alarm_txt : `이 항목을 삭제하겠습니까? 삭제한 항목은 복원할 수 없습니다.`, title : '항목 삭제', buttonName : '삭제', args : '', } // 상단 툴바의 즐겨찾기 추가 복수 작업 let modalParam = { func : bulkFavorite, type : 'bulk', alarm_txt : alarm_txt, title : '선택 항목 즐겨찾기', buttonName : '추가', args : favorite, } 또한, 추가로 article.classList.add('selected') 였지만 코드 리뷰 시간에 .toggle()이란 걸 사용하면 없으면 추가하고, 있으면 빼는 작업을 자동적으로 해주는 걸 알게되어 article.classList.toggle('selected')로 수정했다.\n2.6 Document.querySelector() issue 발생된 issue 와 원인 코드 첫 번째 article tag에 저장된 모든 사이트 수만큼 svg, path tag가 다 들어간 상황\n아래 첫 번째 article tag의 하단 툴바 svg tag에 저장된 사이트의 갯수만큼 path 태그가 추가되어, 다른 항목들의 하단 툴바 이미지 아이콘이 보이지 않는 문제가 발생했다.\n아래 이미지는 두 항목 모두 hover 된 상태이지만, 첫 번째에만 하단툴바 아이콘 이미지가 뜨고 있다.\n즐겨찾기 만드는 함수 외에 카테고리 함수, 태그 함수, 삭제 함수 모두 다 발생된 문제이지만 예로서 즐겨찾기만 가져왔다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 function makeFavoriteInToolBar(parentNode, site) { /* 하단 툴바의 즐겨찾기 버튼 Dom을 만드는 함수 - 특정 문자열로 className에 할당되는 값들은 클론코딩으로 가져오는 css를 반영하기 위한 것입니다. */ const favoriteButtonContainer = createNode('span') appendTag(parentNode, favoriteButtonContainer) const favoriteButton = createNode('button') favoriteButton.className = site.favorite == false ? 'm11fpiro t1221eea pmdugmx d1mp5exd favorite' : 'm11fpiro t1221eea pmdugmx d1mp5exd favorite active' favoriteButton.setAttribute('data-tooltip', site.favorite == false ? '즐겨찾기' : '즐겨찾기 해제') appendTag(favoriteButtonContainer, favoriteButton) const favoriteIconContainer = createNode('span') favoriteIconContainer.className = 'i1qqph0t icon' appendTag(favoriteButton, favoriteIconContainer) let favoriteIconSvgHTML = `` favoriteIconContainer.insertAdjacentHTML('beforeend', favoriteIconSvgHTML) // issue가 발생된 원인 const favoriteIconSvg = getElement('.favorite-icon-svg') let favoriteIconPathHTML = '' favoriteIconSvg.insertAdjacentHTML('beforeend', favoriteIconPathHTML) changeFavoriteValue(favoriteButton, site) } 위 코드에서 getElement function이 문제의 원인이다. 이 function은 공통으로 사용하고자 custom function이다.\n1 2 3 4 5 function getElement(elemVal) { /* 단일 요소 가져오는 함수 */ return document.querySelector(elemVal); } 이 함수를 사용했지만 해당 issue를 확인하지 못 했던 이유는 그 당시 내 목록에 추가했던 항목이 1개 밖에 없었기 때문이다. 팀원한테 이 issue를 듣고서 해결하기 시작했다.\nquerySelector 는 전체 document에서 해당되는 태그들 중 첫 번째를 가져오기 때문에 발생한 이슈였다. getElement를 사용할 때 공식문서를 확인했지만, 놓친 부분이 있었던 것이다. 이는 Document.querySelector()의 설명 부분을 보니 알 수 있었다.\n해결과정 그래서 아래 2가지 방법을 생각해냈다.\ndocument.querySelector() 에서 document의 범위를 좁히기 getElement() 의 매개변수에 들어가는 부분을 보다 정확하게 타겟팅하기 만약 첫 번째 방법을 사용한다면 만든 getElement를 사용할 수가 없어서 통일성이 깨지기 때문에, 먼저 getElement를 사용하는 방향을 선택했다.\n1 2 3 4 5 6 7 8 9 10 11 function getElement(elemVal) { /* 단일 요소 가져오는 함수 */ return document.querySelector(elemVal); } function makeFavoriteInToolBar(parentNode, site) { ... const favoriteIconSvg = getElement('.favorite-icon-svg') ... } site.id를 id 값으로 입력한 이유는 저장한 각 항목들을 구분하기 위한 식별자로 각 사이트를 렌더링할 때마다 속성값으로 입력했기 때문이다.\nReact라면 각각의 식별자가 자동적으로 추가된다고 하지만, vanilla JS를 사용했기 때문에 수동적으로 입력하는 게 필요했다. 그래서 아래 코드로 수정해서 화면을 확인하니 console에 입력한 id값은 타당하지 않은 선택자라고 한다.\n1 2 3 4 5 // 변경 전 const favoriteIconSvg = getElement('.favorite-icon-svg') // 변경 후 const favoriteIconSvg = getElement(`'#${site.id}' .favorite-icon-svg`) 그래서 getElementById로 가져올 수도 있지만, 코드 통일성을 위해서 getElement는 사용하지 못 해도 querySelector를 사용하는 게 낫다는 판단으로 두 번째 방법은 사용하지 않고 첫 번째 방법으로 사용하기로 했다.\nsvg tag의 상위 태그인 span tag를 Container로 명명하여 document 대신에 이 컨테이너를 사용하여 범위를 좁혀서 접근하는 방식으로 해결했다.\n1 2 3 4 5 6 7 8 9 const favoriteIconContainer = createNode('span') favoriteIconContainer.className = 'i1qqph0t icon' appendTag(favoriteButton, favoriteIconContainer) let favoriteIconSvgHTML = `` favoriteIconContainer.insertAdjacentHTML('beforeend', favoriteIconSvgHTML) // 수정된 부분 const favoriteIconSvg = favoriteIconContainer.querySelector('.favorite-icon-svg') 그 결과, 다음 이미지와 같이 하단 툴바가 몰리는 issue를 해결할 수 있었다.\n3. Fetch 함수 사용 시 issue 사항 3.1 Custom 함수 만들어 팀 공용으로 사용하기 DOM rendering을 위해 커스텀 함수를 만든 것처럼 fetch 함수의 두 번째 인자로 보낼 HTTP message를 그 때 그 때마다 다 작성하는 건 효율적이지 못하다고 판단하여 method와 Http body에 담을 data를 인자로 받는 setFetchData를 작성했다. 여기서 content-type을 application/json으로 정한 이유는 MDN을 통해 iana을 들어가니 위 content-type에 대한 설명이 있었고, 구글링을 해도 application에서 json 타입으로 데이터를 주고 받을 때는 content-type에 위 형식을 사용한다고 나와서 이 방식으로 선택했다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 ... function setFetchData(method, body){ /* Fetch data 셋팅 */ let csrftoken = getCookie('csrftoken'); const data = { method: method, headers: { 'content-type': 'application/json', 'X-CSRFToken' : csrftoken, }, body: JSON.stringify(body) } return data } 3.2 아임포트 Javascript SDK에 fetch 사용하기 아임포트 결제 연동 서비스를 사용하기 위해서는 아임포트 Javascript SDK(Software Development Kit)를 사용해야 한다. 이 SDK를 통해서 내가 생성한 주문번호와 금액을 아임포트에 전달하고, 아임포트는 결제 번호를 나에게 전달한다.\n그래서 이 SDK를 통해 결제 각 단계에서의 데이터 처리를 js function을 통해서 django의 view로 전달하고, DB에 결제 상태와 정보를 저장한다. 그리고, django의 view에 전달하기 위해서 fetch를 사용했다.\n🔆 아임포트 Javascript SDK는 정확하게는 Ajax 문법으로 작성되어 있다. 구글링을 해도 SDK에 사용되는 function을 Ajax로 작성되어 있어서 javascript만 알고 있기 때문에, 이를 function은 js로 다 바꾸고, IMP.request_pay 부분은 다른 아임포트 라이브러리 ajax파일을 호출하기 때문에, 이 부분을 제외한 나머지 부분들도 js로 바꿨다.\n🔆 이 문서에서는 Javascript SDK와의 전체적인 흐름이 아닌 fetch 함수의 비동기적 특징에 대해서만 다룬다.\n아임포트 Javascript SDK를 사용한 결제 흐름 발생된 issue와 원인 코드 아래 코드에 나와있다시피 결제 금액과 결제 방식을 입력받은 함수가 주문 번호(merchant_id)를 반환하는 함수 과정에서 11번째 줄에는 merchant_id가 확인되지만, 15번째줄 console.log(result)에서는 merchant_id가 확인되지 않는 issue가 있었다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // IMP.request_pay를 호출하기 위한 merchant_id 반환 function passMerchantId(e, amount, type) { e.preventDefault(); const data = setFetchData('POST', { amount: amount, type: type, }) const result = fetch(`/api/payment/checkout`, data) .then(response =\u003e response.json()) .then(result =\u003e { console.log(result.merchant_id) //58b9dea713 merchant_id = result.merchant_id return merchant_id }).catch(err =\u003e alert(`${err}`)) console.log(result) // '' return result } 그래서 아임포트 IMP.request_pay()에 주문번호가 undefined로 전달되어 결제가 실패했다. 이를 방지하고자 아래와 같이 merchant_id !== undefined 또는 merchand_id !== '' 를 했지만, 올바른 값이 아니기 때문에 결제가 진행되지 못 했다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 import {getElement ,setFetchData} from './common.js'; window.onload = function () { const IMP = window.IMP; IMP.init('imp62676076'); const paymentButton = getElement('.order') paymentButton.addEventListener('click', (e) =\u003e { ... const merchant_id = passMerchantId(e, amount, type); if (merchant_id !== '' \u0026\u0026 merchant_id !== undefined) { IMP.request_pay({ pg: 'html5_inicis', merchant_uid: merchant_id, name: 'Devket Premium 서비스', pay_method: 'card', amount: amount, }, // 결제창 오픈 function (response) { // 결제한 유저의 이름과 이메일 확인하고 결제 버튼 누른 후, 진행되는 로직 if (response.success) { ... } else { ... } }); } return false; }) }; 해결과정 [첫 번째 고려사항: Scope 상의 문제]\nfetch의 기본적인 사용법과 scope 극복을 참고하여 다음 코드와 같이 fetch scope 외부에 merchant_id를 선언했고, 값이 재할당 되기 때문에 let을 사용했다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // IMP.request_pay를 호출하기 위한 merchant_id 반환 function passMerchantId(e, amount, type) { e.preventDefault(); // 추가된 코드 let merchant_id = '' const data = setFetchData('POST', { amount: amount, type: type, }) const result = fetch(`/api/payment/checkout`, data) .then(response =\u003e response.json()) .then(result =\u003e { console.log(result.merchant_id) //58b9dea713 merchant_id = result.merchant_id return merchant_id }).catch(err =\u003e alert(`${err}`)) console.log(result) // '' return result } 하지만, 그럼에도 결과는 동일했다.\n[두 번째 고려사항: 비동기]\nJavaScript - 자바스크립트 fetch와 async/await 블로그에 따르면 merchant_id 값이 다르게 출력되는 이유는 fetch가 비동기로 작동하기 때문이다. 이전 작업이 완료될 때까지 기다리지 않고, 따로 처리하며 다른 코드들도 먼저 실행할 수 있도록 하는 작업 이다. 그러므로 fetch 밖에 정의한 merchant_id에는 할당되지 않는 상황인 순서가 정확히 보장되지 못하는 상황 에 처할 수 있다.\n그래서 순서를 보장받고자 async와 await을 사용한다.\nawait은 MDN - await에 따르면 Promise 객체를 리턴하는 부분 앞에만 작성될 수 있고, await 연산자는 async function 내부에서만 사용할 수 있다고 하여 다음과 같이 async와 await을 추가했다. 왜냐하면 Promise가 await 연산자에 넘겨지면, await은 Promise가 완전히 실행되기를 기다렸다가 해당 값을 반환하기 때문이다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // async 추가 async function passMerchantId(e, amount, type) { e.preventDefault(); let merchant_id = '' const data = setFetchData('POST', { amount: amount, type: type, }) // await 추가 await fetch(`/api/payment/checkout`, data) .then(response =\u003e { const result = response.json(); if (response.status === 200) { console.log('result.mechant_id: ', result.merchant_id) merchant_id = result.merchant_id } else if (response.status === 401) { alert('로그인 해주세요.') } else { alert('문제가 발생했습니다. 다시 시도해주세요.') } }) return merchant_id }; 하지만 그럼에도 merchant_id는 빈 값으로 반환되었다.\n[세 번째 고려사항: 정확한 사용방법이 맞는가?]\nMDN - await와 위 블로그들을 보면서 await과 then을 같이 사용하는 코드를 발견하지 못하여 이에 대해 구글링을 했다.\n구글링을 하는 과정에서 async/ await 사용방법 (feat. then과 함께 쓰기), Promise 정리: async/await 사용법 \u0026 then과의 차이 문서뿐만 아니라 여러 문서들을 보면서 잘못된 방식으로 사용했다는 걸 알았다. 또한, 프로젝트 멘토님도 then과 await은 같이 사용하는 게 아니라는 의견을 주셨다.\n그래서 then을 사용하지 않고 const로 변수를 선언하여 사용하기로 했다. result.works는 아임포트에서 success, fail를 판단할 때 사용하는 변수이기 때문에 그 외 함수 분기처리에도 사용하는 게 통일성 있는 방식으로 생각하여 아래와 같이 선택했다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // IMP.request_pay를 호출하기 위한 merchant_id 반환 async function passMerchantId(e, amount, type) { e.preventDefault(); let merchant_id = '' const data = setFetchData('POST', { amount: amount, type: type, }) const response = await fetch(`/api/payment/checkout`, data) const result = await response.json() if (result.works) { merchant_id = result.merchant_id console.log('merchant_id after then:', merchant_id) return merchant_id } else if (result.status === 401) { alert('로그인 해주세요.') } else { alert('문제가 발생했습니다. 다시 시도해주세요.') } }; Javascript Promise 배경부터 then catch 그리고 async await까지 문서 뿐만 아니라 여러 문서들에서 보면 then ~ catch 이후에 새롭게 나온 방식이 async 와 await이라고 한다. then을 계속해서 사용하면 코드가 길어져 가독성이 좋지 않기 때문에, async 와 await 방식을 권장한다고 나온다.\nReference FEAT: Rendering mylist view and bottom-toolbar under each item #28 루나의 TIL 기술 블로그 Django - MVC 패턴과 MTV 패턴 MDN - Element.insertAdjacentHTML() iana fetch의 기본적인 사용법과 scope 극복 JavaScript - 자바스크립트 fetch와 async/await MDN - await async/ await 사용방법 (feat. then과 함께 쓰기) Promise 정리: async/await 사용법 \u0026 then과의 차이 Javascript Promise 배경부터 then catch 그리고 async await까지 ","wordCount":"4107","inLanguage":"en","datePublished":"2022-11-20T18:25:52+09:00","dateModified":"2022-11-20T18:25:52+09:00","author":[{"@type":"Person","name":"Me"}],"mainEntityOfPage":{"@type":"WebPage","@id":"http://jeha00.github.io/post/project/devket/js/dom_fetch_issue/"},"publisher":{"@type":"Organization","name":"Jeha DevLog","logo":{"@type":"ImageObject","url":"http://jeha00.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://jeha00.github.io/ accesskey=h title="@Jeha00 (Alt + H)">@Jeha00</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://jeha00.github.io/me/ title=About><span>About</span></a></li><li><a href=http://jeha00.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=http://jeha00.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=http://jeha00.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://jeha00.github.io/>Home</a>&nbsp;»&nbsp;<a href=http://jeha00.github.io/post/>Posts</a></div><h1 class=post-title>Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues</h1><div class=post-meta>Project: Devket&nbsp;·&nbsp;<span title='2022-11-20 18:25:52 +0900 KST'>November 20, 2022</span>&nbsp;·&nbsp;Me</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-dom-%ec%83%9d%ec%84%b1%ea%b3%bc-fetch-function-%ec%82%ac%ec%9a%a9%ec%9d%84-%ec%9c%84%ed%95%9c-javascript-%ed%95%99%ec%8a%b5-%ed%9b%84%ea%b8%b0 aria-label="1. DOM 생성과 fetch function 사용을 위한 Javascript 학습 후기">1. DOM 생성과 fetch function 사용을 위한 Javascript 학습 후기</a><ul><li><a href=#11-%ec%83%88%eb%a1%9c%ec%9a%b4-%ec%96%b8%ec%96%b4%ec%9d%98-%ed%95%99%ec%8a%b5-%eb%b0%a9%eb%b2%95-%ec%84%a0%ed%83%9d%ed%95%98%ea%b8%b0 aria-label="1.1 새로운 언어의 학습 방법 선택하기">1.1 새로운 언어의 학습 방법 선택하기</a></li><li><a href=#12-%ec%9e%90%eb%b0%9c%ec%a0%81%ec%9c%bc%eb%a1%9c-%eb%8d%94-%eb%a7%a1%ec%95%84%ec%84%9c-%ec%a7%84%ed%96%89%ed%95%98%ea%b8%b0 aria-label="1.2 자발적으로 더 맡아서 진행하기">1.2 자발적으로 더 맡아서 진행하기</a><ul><li><a href=#%ec%b2%ab-%eb%b2%88%ec%a7%b8-%ec%9d%b4%ec%9c%a0 aria-label="첫 번째 이유">첫 번째 이유</a></li><li><a href=#%eb%91%90-%eb%b2%88%ec%a7%b8-%ec%9d%b4%ec%9c%a0 aria-label="두 번째 이유">두 번째 이유</a></li></ul></li><li><a href=#13-dom-%ed%95%99%ec%8a%b5-%ed%9b%84%ea%b8%b0 aria-label="1.3 DOM 학습 후기">1.3 DOM 학습 후기</a></li><li><a href=#14-fetch-%ed%95%a8%ec%88%98-%ed%95%99%ec%8a%b5-%eb%b0%8f-%ec%82%ac%ec%9a%a9-%ed%9b%84%ea%b8%b0 aria-label="1.4 fetch 함수 학습 및 사용 후기">1.4 fetch 함수 학습 및 사용 후기</a><ul><li><a href=#front%ec%99%80-back-%ea%b0%84%ec%9d%98-%ed%9d%90%eb%a6%84-%ec%9d%b4%ed%95%b4 aria-label="Front와 Back 간의 흐름 이해">Front와 Back 간의 흐름 이해</a></li><li><a href=#fetch-%ed%95%99%ec%8a%b5 aria-label="fetch 학습">fetch 학습</a></li></ul></li></ul></li><li><a href=#2-dom-%eb%a0%8c%eb%8d%94%eb%a7%81-%ec%bd%94%eb%93%9c-%ec%9e%91%ec%84%b1-%ec%8b%9c-issue-%ec%82%ac%ed%95%ad aria-label="2. DOM 렌더링 코드 작성 시 issue 사항">2. DOM 렌더링 코드 작성 시 issue 사항</a><ul><li><a href=#21-custom-%ed%95%a8%ec%88%98-%eb%a7%8c%eb%93%a4%ec%96%b4-%ed%8c%80-%ea%b3%b5%ec%9a%a9%ec%9c%bc%eb%a1%9c-%ec%82%ac%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="2.1 Custom 함수 만들어 팀 공용으로 사용하기">2.1 Custom 함수 만들어 팀 공용으로 사용하기</a></li><li><a href=#22-%ed%95%a8%ec%88%98-%ea%b8%b0%eb%8a%a5-%eb%b6%84%eb%a6%ac aria-label="2.2 함수 기능 분리">2.2 함수 기능 분리</a></li><li><a href=#23-%eb%a0%8c%eb%8d%94%eb%a7%81-%ec%8b%9c-%ec%8b%9c%ea%b0%84-%eb%b3%b5%ec%9e%a1%eb%8f%84-%ea%b3%a0%eb%a0%a4-issue aria-label="2.3 렌더링 시 시간 복잡도 고려 issue">2.3 렌더링 시 시간 복잡도 고려 issue</a></li><li><a href=#24-svg-icon%ec%9d%b4-%ec%9d%b8%ec%8b%9d%eb%90%98%ec%a7%80-%ec%95%8a%eb%8a%94-%eb%ac%b8%ec%a0%9c aria-label="2.4 svg icon이 인식되지 않는 문제">2.4 svg icon이 인식되지 않는 문제</a><ul><li><a href=#%eb%ac%b8%ec%a0%9c%ec%a0%90 aria-label=문제점>문제점</a></li><li><a href=#%ed%95%b4%ea%b2%b0%ec%b1%85 aria-label=해결책>해결책</a></li></ul></li><li><a href=#25-modal-%ec%b0%bd%ec%9d%84-%ed%86%b5%ed%95%9c-%ec%82%ad%ec%a0%9c-%ea%b8%b0%eb%8a%a5-issue aria-label="2.5 Modal 창을 통한 삭제 기능 issue">2.5 Modal 창을 통한 삭제 기능 issue</a><ul><li><a href=#%eb%b0%9c%ec%83%9d%eb%90%9c-issue aria-label="발생된 issue">발생된 issue</a></li><li><a href=#issue-%eb%b0%9c%ec%83%9d%ed%96%88%ec%9d%84-%eb%95%8c-%ec%82%ad%ec%a0%9c-%ea%b8%b0%eb%8a%a5-%ed%95%a8%ec%88%98-%ed%98%b8%ec%b6%9c-%ec%88%9c%ec%84%9c aria-label="issue 발생했을 때 삭제 기능 함수 호출 순서">issue 발생했을 때 삭제 기능 함수 호출 순서</a></li><li><a href=#%ec%9b%90%ec%9d%b8 aria-label=원인>원인</a></li><li><a href=#%ed%95%b4%ea%b2%b0-%ea%b3%bc%ec%a0%95 aria-label="해결 과정">해결 과정</a></li><li><a href=#%ec%b5%9c%ec%a2%85-%ed%98%b8%ec%b6%9c-%ec%88%9c%ec%84%9c aria-label="최종 호출 순서">최종 호출 순서</a></li></ul></li><li><a href=#26-documentqueryselector-issue aria-label="2.6 Document.querySelector() issue">2.6 Document.querySelector() issue</a><ul><li><a href=#%eb%b0%9c%ec%83%9d%eb%90%9c-issue-%ec%99%80-%ec%9b%90%ec%9d%b8-%ec%bd%94%eb%93%9c aria-label="발생된 issue 와 원인 코드">발생된 issue 와 원인 코드</a></li><li><a href=#%ed%95%b4%ea%b2%b0%ea%b3%bc%ec%a0%95 aria-label=해결과정>해결과정</a></li></ul></li></ul></li><li><a href=#3-fetch-%ed%95%a8%ec%88%98-%ec%82%ac%ec%9a%a9-%ec%8b%9c-issue-%ec%82%ac%ed%95%ad aria-label="3. Fetch 함수 사용 시 issue 사항">3. Fetch 함수 사용 시 issue 사항</a><ul><li><a href=#31-custom-%ed%95%a8%ec%88%98-%eb%a7%8c%eb%93%a4%ec%96%b4-%ed%8c%80-%ea%b3%b5%ec%9a%a9%ec%9c%bc%eb%a1%9c-%ec%82%ac%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="3.1 Custom 함수 만들어 팀 공용으로 사용하기">3.1 Custom 함수 만들어 팀 공용으로 사용하기</a></li><li><a href=#32-%ec%95%84%ec%9e%84%ed%8f%ac%ed%8a%b8-javascript-sdk%ec%97%90-fetch-%ec%82%ac%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="3.2 아임포트 Javascript SDK에 fetch 사용하기">3.2 아임포트 Javascript SDK에 fetch 사용하기</a><ul><li><a href=#%eb%b0%9c%ec%83%9d%eb%90%9c-issue%ec%99%80-%ec%9b%90%ec%9d%b8-%ec%bd%94%eb%93%9c aria-label="발생된 issue와 원인 코드">발생된 issue와 원인 코드</a></li><li><a href=#%ed%95%b4%ea%b2%b0%ea%b3%bc%ec%a0%95-1 aria-label=해결과정>해결과정</a></li></ul></li></ul></li><li><a href=#reference aria-label=Reference>Reference</a></li></ul></div></details></div><div class=post-content><h1 id=1-dom-생성과-fetch-function-사용을-위한-javascript-학습-후기>1. DOM 생성과 fetch function 사용을 위한 Javascript 학습 후기<a hidden class=anchor aria-hidden=true href=#1-dom-생성과-fetch-function-사용을-위한-javascript-학습-후기>#</a></h1><h2 id=11-새로운-언어의-학습-방법-선택하기>1.1 새로운 언어의 학습 방법 선택하기<a hidden class=anchor aria-hidden=true href=#11-새로운-언어의-학습-방법-선택하기>#</a></h2><p>파이썬 언어를 학습한 후, 또 다른 프로그래밍 언어를 학습하는 건 처음이어서 파이썬을 학습했던 것처럼 똑같이 하면 될지 고민이 되었다. 만약 파이썬을 학습한 것처럼 파이썬 자체만을 깊이 파는 문법 강의를 통해서 한다면 짧은 프로젝트 기간을 고려하면 좋지 않다.</p><p>고민 중에 이번 부트캠프에서 book study 시간에 읽었던 <a href=https://jeha00.github.io/post/bookstudy/agile/review01/>함께 자라기</a>에서 본 내용이 문득 기억났다. 프로그래밍 언어는 도구임을 기억하여 바로 사용하고, 막히면 문법 내용으로 돌아오는 이 전환과 피드백이 빠를수록 학습이 빠르다고 했다. (독서를 할 때 단지 읽은 것에서 끝내지 않고, 정리하는 것과 함께 읽는 것이 필요하며 나에게 맞는 학습 방법임을 느낀 계기였다.)</p><p>그래서 짧은 기간 안에 만들어야 하기 때문에 해외 유튜브에서 DOM을 자바스크립트로 생성하는 외국 엔지니어의 영상을 따라하며 이해했다. 그리고 바로 프로젝트에 적용했고, 그 과정에서 막히는 부분과 에러 부분은 MDN 문서로 바로 돌아와 놓친 부분을 빠르게 매꿔서 진행했다.</p><p>그 결과가 다음과 같다. PR 날짜만을 보고 판단했을 때 event를 추가하는 것 없이 렌더링 부분만 대략 5일 정도 걸린 것으로 판단된다. 멘토링을 해줬던 멘토님이 처음 프로젝트를 진행하는데 이 속도로 진행한 건 많이 한 것이라는 평가를 들어서 기분이 좋았다.</p><ul><li><a href=https://github.com/backendnanodegree/Devket/pull/28/files>FEAT: Rendering mylist view and bottom-toolbar under each item #28</a></li></ul><h2 id=12-자발적으로-더-맡아서-진행하기>1.2 자발적으로 더 맡아서 진행하기<a hidden class=anchor aria-hidden=true href=#12-자발적으로-더-맡아서-진행하기>#</a></h2><p><img loading=lazy src=https://user-images.githubusercontent.com/78094972/210824475-9a956489-df5c-42dc-a9ef-6b5414199934.png alt=image></p><p>이 평가가 기분이 유독 좋았던 이유는 다음과 같다. 팀원들을 위해서 스스로 더 압박감을 느끼며 진행했지만, 그 결과 팀 전체 도움과 내 자신의 성장을 이끌 수 있었기 때문이다.</p><p>이 화면단 개발은 우리 프로젝트에서 화면적으로 반드시 개발되어야하는 부분이었다. 하지만 각자 맡은 메인 기능들에 대해 완성된 후 위 이미지의 사이드바 부분을 나눠서 개발하기로 했기 때문에, 자신이 맡은 개발 기능들에 연구 개발을 하느라 팀원들은 시간을 할애하지 못하는 상황이었다.</p><p>이런 상황에서 내 자신에게 도전적인 과제를 던져주기로 결정했다.</p><h3 id=첫-번째-이유>첫 번째 이유<a hidden class=anchor aria-hidden=true href=#첫-번째-이유>#</a></h3><p>이런 결정을 한 첫 번째 이유는 프로젝트 기한을 고려했을 때 누군가가 더 맡아서 이 부분을 빠르게 구현한다면 프로젝트를 진행하는데 있어서 진행률이 많이 빨라지고, 다른 팀원들도 시각적으로 작동되는 게 보이기 때문에 프로젝트를 이해하고 개발하는데 도움이 될거라 판단했기 때문이다. 왜냐하면 위 이미지의 &lsquo;내 목록&rsquo;에 각 저장된 사이트들과 하단툴바가 나타나는 것처럼 사이드바 부분의 각 탭에서 나오는 방식이 다 동일하기 때문이다. 단지 ORM을 사용하여 filter로 가져오는 값들이 다를 뿐이다.</p><h3 id=두-번째-이유>두 번째 이유<a hidden class=anchor aria-hidden=true href=#두-번째-이유>#</a></h3><p>또한, 전체 팀원 4명 중 개발 경험이 거의 없는 인원이 나 포함 3명이었기 때문에, 최악의 경우로 각자 맡은 기능들을 개발하다가 시간적인 여유가 없어서 이 부분을 개발하지 못하는 상황까지 고려했다.</p><p>그래서 스스로 도전 과제를 주어 기한을 1주일 정도 정하여 내 자신에게 압박감을 주면서 진행했다. 그 결과, 기본적으로 저장된 사이트를 렌더링하는 DOM은 다 형성했다. 사이드 바에서는 즐겨찾기, 아티클, 동영상 부분의 ORM filter 부분을 짜서 끝냈다.</p><p> </p><h2 id=13-dom-학습-후기>1.3 DOM 학습 후기<a hidden class=anchor aria-hidden=true href=#13-dom-학습-후기>#</a></h2><p>처음 DOM을 조작하는 것이기 때문에, 저장된 사이트들을 목록에 보여주는 DOM을 생성하는 건 시간이 걸렸다. 그 이유는 진행한 프로젝트는 클론 코딩이기 때문에, html 구조와 css는 거의 그대로 사용하기 위해 html의 class name과 id name을 브라우저의 개발자 도구로 분석하며 가져오느라 오래 걸렸다.</p><p>또한, html 구조와 css는 거의 그대로 사용할 것이기 때문에 class name이 직관적이지 않아도 가져온 이유다. 직접 수정할 수도 있겠지만, 이 프론트 영역까지 파고들고 싶지 않았으며 그 시간에 백엔드 구축에 집중하고 싶었다.</p><p>이후에 &lsquo;하단 툴바&rsquo;와 modal 창을 렌더링할 때는 금방 DOM 생성 코드를 짤 수 있었다. 이후부터 DOM을 지정하고, 삭제하고, 수정하는 것에 어려움을 느끼지 못했다.</p><p>하지만, React를 사용하지 않고 vanilla js로 다 하다보니 코드 길이가 많이 길어졌다. 하지만 React를 사용하면 손쉽게 생성된다고 한다. 프레임워크의 중요성을 느낀 계기가 되었다.</p><p> </p><h2 id=14-fetch-함수-학습-및-사용-후기>1.4 fetch 함수 학습 및 사용 후기<a hidden class=anchor aria-hidden=true href=#14-fetch-함수-학습-및-사용-후기>#</a></h2><h3 id=front와-back-간의-흐름-이해>Front와 Back 간의 흐름 이해<a hidden class=anchor aria-hidden=true href=#front와-back-간의-흐름-이해>#</a></h3><p>fetch 함수를 사용하기 전까지는 api를 통해서 프론트와 백엔드가 어떻게 통신을 하는지 코드적으로 이해할 수가 없었다. 즉, 눈에 보이지 않았다. 하지만 내가 구축한 api를 fetch를 사용해서 통신을 직접 해보니 확실히 이해할 수 있었다. 백엔드에서 구축한 api를 fetch를 사용하여 request를 보내면 django의 views.py의 view method(or function)에서 request로 받아 그 과정에서 짜놓은 로직에 따라서 CRUD 상황이 이뤄지고, response를 반환하면 fetch 함수에서 response로 그 결과 값을 반영할 수 있다. 이 response 값에 따라서 DOM 조작이 이뤄진다.</p><p>그래서 Django가 MTV (Model - Template - View) pattern에서 View가 controller의 역할을 한다는 걸 느꼈다. Django의 MTV 는 기본적으로 MVC 패턴과 동일하다.</p><p><img loading=lazy src=https://lunayyko.github.io/public/img/MVT.png alt=image></p><blockquote><p>출처: <a href=https://lunayyko.github.io/wecode/2021/10/27/interview1/>루나의 TIL 기술 블로그</a></p></blockquote><p>MVC에 대응되는 MTV 설명은 <a href=https://tibetsandfox.tistory.com/16>Django - MVC 패턴과 MTV 패턴</a>을 참조한다.</p><p> </p><h3 id=fetch-학습>fetch 학습<a hidden class=anchor aria-hidden=true href=#fetch-학습>#</a></h3><p>DOM을 익히면서 유튜브와 공식문서를 반복하여 개발하는 동안, 공식 문서로 빠르게 피드백을 받은 경험을 통해서 fetch 함수를 익힐 때는 유튜브 영상은 안보고 공식 문서와 stackoverflow만을 사용하여 작성할 수 있었다. 하지만 fetch의 경우 비동기적으로 작동하기 때문에 어려움이 있었다. 하지만 이 부분에 대해서도 글로 정리한다.</p><p> </p><hr><h1 id=2-dom-렌더링-코드-작성-시-issue-사항>2. DOM 렌더링 코드 작성 시 issue 사항<a hidden class=anchor aria-hidden=true href=#2-dom-렌더링-코드-작성-시-issue-사항>#</a></h1><h2 id=21-custom-함수-만들어-팀-공용으로-사용하기>2.1 Custom 함수 만들어 팀 공용으로 사용하기<a hidden class=anchor aria-hidden=true href=#21-custom-함수-만들어-팀-공용으로-사용하기>#</a></h2><p>렌더링 시 자주 사용되는 함수들은 별도로 정의하여 코드 수를 줄이고, 보다 직관적으로 만들기 위해 노력했다. 그 이유는 React가 아닌 vanilla JS로 렌더링하는 것이기 때문에 코드 양이 상대적으로 매우 많아지기 때문이다. 계속해서 document.createElement를 사용해도 되겠지만, 이보다는 createNode 함수를 만들어서 보다 코드를 짧고 직관적으로 만들었다.</p><p>아래 함수로 끝나는 것이 아닌 계속해서 추가했으며, <code>common.js</code>라는 이름의 별도 파일을 생성하여 앞으로 팀 공용으로 사용하면 좋은 함수들에 대해 PR 승인 후 합쳐서 같이 사용하는 방식으로 팀 방식을 진행했다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// common.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#a6e22e>tag</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* tag를 생성하는 함수 */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#a6e22e>tag</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>appendTag</span>(<span style=color:#a6e22e>parent</span>, <span style=color:#a6e22e>element</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* parent tag에 child tag를 추가하는 함수 */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>parent</span>.<span style=color:#a6e22e>appendChild</span>(<span style=color:#a6e22e>element</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=22-함수-기능-분리>2.2 함수 기능 분리<a hidden class=anchor aria-hidden=true href=#22-함수-기능-분리>#</a></h2><p>크롤링으로 가져온 사이트들을 hover 시, 하단에 뜨는 툴바를 렌더링하는 함수다. 하단 툴바에는 즐겨찾기 기능, 카테고리 분류 기능, 태그 추가 기능, 삭제 기능이 있어서 이를 위한 태그 렌더링이 필요하다.</p><p>처음에는 <code>makeBottomToolbar</code> function에 위 기능을 제공하는 태그 렌더링 코드를 다 작성했다.<br>하지만, 코드의 길이가 너무 길어지고 내부 내용을 구분하기 어렵기 때문에, 다음과 같이 <code>makeFavoriteInToolBar</code>, <code>makeCategoryInToolBar</code> 등등 별도의 함수로 만들어서 <code>makeBottomToolbar</code> 를 통해 실행되도록 설계했다. 그리고 주석을 작성하여 다시 한번 구분했다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>makeBottomToolbar</span>(<span style=color:#a6e22e>parentNode</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/*각 사이트마다 하단 툴바를 만드는 함수*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// bottom toolbar container - footer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>footer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#e6db74>&#39;footer&#39;</span>)
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>footer</span>.<span style=color:#a6e22e>className</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;footer&#39;</span>
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>appendTag</span>(<span style=color:#a6e22e>parentNode</span>, <span style=color:#a6e22e>footer</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>itemActionsContainer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#e6db74>&#39;div&#39;</span>)
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>itemActionsContainer</span>.<span style=color:#a6e22e>className</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;i18uycg6 actions&#39;</span>
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>appendTag</span>(<span style=color:#a6e22e>footer</span>, <span style=color:#a6e22e>itemActionsContainer</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>itemActions</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#e6db74>&#39;div&#39;</span>)
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>itemActions</span>.<span style=color:#a6e22e>className</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;item-actions&#39;</span>
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>appendTag</span>(<span style=color:#a6e22e>itemActionsContainer</span>, <span style=color:#a6e22e>itemActions</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// bottom toolbar - favorite
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#a6e22e>makeFavoriteInToolBar</span>(<span style=color:#a6e22e>itemActions</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// bottom toolbar - category
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#a6e22e>makeCategoryInToolBar</span>(<span style=color:#a6e22e>itemActions</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// bottom toolbar - tag
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#a6e22e>makeTagInToolBar</span>(<span style=color:#a6e22e>itemActions</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// bottom toolbar - delete
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#a6e22e>makeDeleteInToolBar</span>(<span style=color:#a6e22e>itemActions</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p> </p><h2 id=23-렌더링-시-시간-복잡도-고려-issue>2.3 렌더링 시 시간 복잡도 고려 issue<a hidden class=anchor aria-hidden=true href=#23-렌더링-시-시간-복잡도-고려-issue>#</a></h2><p>각 저장된 사이트(post)를 내 목록에 렌더링할 때, 전체 항목을 렌더링하고 나서 각 항목에 하단 툴바를 렌더링했다. 즉 크롤링해서 가져온 사이트들을 먼저 각각 렌더링 후, 각 사이트마다 하단툴바를 렌더링을 시도했다.</p><p>실행결과를 보면서 이럴 경우 저장된 사이트의 수 만큼 다시 또 반복하는 것이기 때문에, 파이썬으로 생각하자면 for문을 두 번 돌리는 것과 동일하다고 판단하여 시간 복잡도가 <code>O(2n)</code>이 되므로, 각 항목을 렌더링할 때 하단 툴바도 같이 렌더링하여 <code>O(n)</code>이 되도록 수정했다. 또한, 현재는 DB에 저장된 사이트 수가 적어서 문제가 없겠지만, 저장된 데이터량이 많아진다면 렌더링 속도에 가시적으로 영향을 줄 거라 판단했기 때문이다.</p><p>그래서 다음 아래와 같이 <code>renderItem</code> function에 <code>makeBottomToolbar</code> function을 포함시켰다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>renderItem</span>(<span style=color:#a6e22e>post</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* 각 post의 tag를 rendering 하는 함수 */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>article</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#e6db74>&#39;article&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>article</span>.<span style=color:#a6e22e>className</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;c18o9ext grid hiddenActions noExcerpt&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>appendTag</span>(<span style=color:#a6e22e>root</span>, <span style=color:#a6e22e>article</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>item</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#e6db74>&#39;div&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>className</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;cardWrap&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>appendTag</span>(<span style=color:#a6e22e>article</span>, <span style=color:#a6e22e>item</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 각 항목(item)의 하단 툴바
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>makeBottomToolbar</span>(<span style=color:#a6e22e>article</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p> </p><h2 id=24-svg-icon이-인식되지-않는-문제>2.4 svg icon이 인식되지 않는 문제<a hidden class=anchor aria-hidden=true href=#24-svg-icon이-인식되지-않는-문제>#</a></h2><h3 id=문제점>문제점<a hidden class=anchor aria-hidden=true href=#문제점>#</a></h3><p><strong>[Pull requests]</strong></p><ul><li><a href=https://github.com/backendnanodegree/Devket/pull/51>Edit html about premium, mylist and Refactor bottom-toolbar.js #51</a></li><li><a href=https://github.com/backendnanodegree/Devket/pull/28>Rendering mylist view and bottom-toolbar under each item #28</a></li></ul><p>각 항목에 mouse를 hover 시, 하단에 뜨는 하단 툴바를 만들기 위해서 DOM을 생성하는 과정에서 부딪힌 문제점이다. <strong>svg icon을 사용하기 위해서 <code>&lt;svg></code> node를 생성해야 하는데, 생성되지 못한 문제점이 있었다.</strong></p><p>프로젝트의 클론 코딩 대상 사이트는 아이콘을 <code>&lt;i></code> tag보다 <code>&lt;svg>&lt;path d="">&lt;/path>&lt;/svg></code> 를 사용한다. 그래서 다른 태그를 생성하는 것과 동일한 방식을 사용했다.</p><ul><li><code>createNode</code>와 <code>appendTag</code> function을 사용하여 svg tag와 path tag를 생성</li><li><code>.className</code>을 사용하여 class name을 추가</li><li>속성명에 <code>-</code>가 있는 건 dot annotation으로 추가 못하기 때문에 <code>setAttribute()</code> 사용</li></ul><p>하지만 아이콘이 브라우저에 형성되지 않는 문제를 발견했다. 클론 코딩 대상의 프로젝트 tag 속성을 개발자 도구로 분석하면서 관련 속성들을 하나씩 지워보고, 순서도 바꿔보고, 새로운 html을 생성하여 해당 태그들만 추가해보고, stackoverflow와 여러 구글링을 통해 피드백 받은 방안들을 적용해봤지만 svg icon이 형성되지 않았다.</p><p>이 문제로 2~3일을 소비했기 때문에, 임시로 i tag를 사용하기로 결정하여, fontawesome site를 선택하여 유사한 icon을 선택하여 사용했다.</p><p>마지막으로, 팀원들이 이 시행착오를 겪지 않도록 하기 위해 코드 리뷰 시간에 공유했다.</p><h3 id=해결책>해결책<a hidden class=anchor aria-hidden=true href=#해결책>#</a></h3><p>다른 팀원 또한 렌더링하는 과정에서 svg icon 문제에 똑같이 부딪혔고, 내가 공유한 과정들을 통해 다른 방식을 적용하여 문제를 해결했다.</p><p><strong>해결한 방법은 setAttribute로 하면 인식되지 않았지만 html를 통채로 입력하니 가능했다.</strong></p><p>이 때 변수를 <code>insertAdjacentHTML</code>을 사용한 이유는 다음과 같다.</p><p>className과 속성들을 별도로 입력하는 방식이 작동되지 않기 때문에, 통째로 입력하는 방법을 선택했다. 그래서 HTML을 통째로 원하는 DOM tree 안에 node들을 추가하기 위해 함수 &lsquo;insertAdjacentHTML&rsquo; 를 사용했다.</p><p>사용 방식은 <code>element.insertAdjacentHTML(position, text)</code>와 같다. 이 함수의 사용 방법 출처는 <a href=https://developer.mozilla.org/ko/docs/Web/API/Element/insertAdjacentHTML>MDN - Element.insertAdjacentHTML()</a>을 참고했다.</p><p>&rsquo;text&rsquo;에 들어갈 svg를 담은 변수를 <code>let</code>으로 선언한 이유는 재정의할 수도 있기 때문이다. 클론 코딩의 상단 툴바의 경우 아이콘이 변하는 경우가 있어서 let으로 선언했지만, 하단 툴바의 경우에는 그렇지 않기 때문에 아래 코드의 <code>let</code>은 <code>const</code>로 수정해야하는 부분이다.</p><ul><li><p>let & const</p><table><thead><tr><th></th><th>재선언</th><th>재할당</th></tr></thead><tbody><tr><td>let</td><td>X</td><td>O</td></tr><tr><td>const</td><td>X</td><td>X</td></tr></tbody></table></li><li><p>position</p><table><thead><tr><th>position</th><th>설명</th></tr></thead><tbody><tr><td>beforebegin</td><td>element 앞에</td></tr><tr><td>afterbegin</td><td>element 안에 가장 첫번째 chid</td></tr><tr><td>beforeend</td><td>element 안에 가장 마지막 child</td></tr><tr><td>afterend</td><td>element 뒤에</td></tr></tbody></table></li></ul><p>클론 코딩의 대상 사이트의 svg DOM 구조가 다음과 같았다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>span</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>svg</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>path</span>&gt;&lt;/<span style=color:#f92672>path</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>svg</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>span</span>&gt;
</span></span></code></pre></td></tr></table></div></div><p>그래서 favoriteIconContainer이 <code>&lt;span></code>에 <code>&lt;svg></code>가 들어가기 위해서 <code>favoriteIconContainer.insertAdjacentHTML('beforeend', favoriteIconSvgHTML)</code>을 한 후, <code>&lt;svg></code> 안에 <code>&lt;path></code>를 넣기 위해서 <code>favoriteIconSvg.insertAdjacentHTML('beforeend', favoriteIconPathHTML)</code>으로 작성했다.</p><p>여기서 <code>beforeend</code>를 선택한 이유는 <code>&lt;path></code>의 경우, svg icon의 종류에 따라서 복수로 존재하기도 했다. 그래서 <code>&lt;path></code> tag 순서를 <em>작성한대로 순서를 원래의 것과 유지하여 직관적으로 순서를 바로 확인할 수 있도록</em> 이를 사용했다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>favoriteButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#e6db74>&#39;button&#39;</span>)
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>favoriteIconContainer</span>         <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#e6db74>&#39;span&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>favoriteIconContainer</span>.<span style=color:#a6e22e>className</span>     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;i1qqph0t icon&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>appendTag</span>(<span style=color:#a6e22e>favoriteButton</span>, <span style=color:#a6e22e>favoriteIconContainer</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>favoriteIconSvgHTML</span>             <span style=color:#f92672>=</span> <span style=color:#e6db74>`&lt;svg class=&#39;favorite-icon-svg&#39; fill=&#34;currentColor&#34; viewBox=&#34;0 0 24 24&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;aria-hidden=&#34;true&#34;&gt;&lt;/svg&gt;`</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>favoriteIconContainer</span>.<span style=color:#a6e22e>insertAdjacentHTML</span>(<span style=color:#e6db74>&#39;beforeend&#39;</span>, <span style=color:#a6e22e>favoriteIconSvgHTML</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>favoriteIconSvg</span>               <span style=color:#f92672>=</span> <span style=color:#a6e22e>getElement</span>(<span style=color:#e6db74>&#39;.favorite-icon-svg&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>favoriteIconPathHTML</span>            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&lt;path fill-rule=&#34;evenodd&#34; clip-rule=&#34;evenodd&#34; d=&#34;M12 1a1 1 0 0 1 ... 1-.753-.548L12 4.26Z&#34;&gt;&lt;/path&gt;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>favoriteIconSvg</span>.<span style=color:#a6e22e>insertAdjacentHTML</span>(<span style=color:#e6db74>&#39;beforeend&#39;</span>, <span style=color:#a6e22e>favoriteIconPathHTML</span>)
</span></span></code></pre></td></tr></table></div></div><p>❗️ let을 const로 수정하기</p><p> </p><hr><h2 id=25-modal-창을-통한-삭제-기능-issue>2.5 Modal 창을 통한 삭제 기능 issue<a hidden class=anchor aria-hidden=true href=#25-modal-창을-통한-삭제-기능-issue>#</a></h2><h3 id=발생된-issue>발생된 issue<a hidden class=anchor aria-hidden=true href=#발생된-issue>#</a></h3><p><strong>[Pull requests]</strong></p><ul><li><a href=https://github.com/backendnanodegree/Devket/pull/42>Modifiy api-url and add delete function by bottom-toolbar #42</a></li></ul><p><strong>[Issue 배경]</strong><br>저장된 사이트의 하단 툴바 삭제 기능을 클릭하여, 모달 창이 뜨면 이 모달 창으로 삭제를 진행하는 방식으로 개발했다.
모달 창을 통해서 삭제를 진행하는 이유는 삭제하면 이 사이트 저장을 되돌릴 수 없기 때문에, 경고를 하는 게 유저 편의성을 높이는 방향이라고 생각했기 때문이다.</p><p><strong>[발생된 issue]</strong><br>한 사이트의 하단 툴바 삭제 아이콘을 클릭하여 모달 창의 삭제버튼으로 삭제를 진행할 때, 하단툴바가 달려있던 한 사이트만 삭제가 되야하는데 저장된 모든 사이트가 다 삭제되는 이슈가 발생했다.</p><h3 id=issue-발생했을-때-삭제-기능-함수-호출-순서>issue 발생했을 때 삭제 기능 함수 호출 순서<a hidden class=anchor aria-hidden=true href=#issue-발생했을-때-삭제-기능-함수-호출-순서>#</a></h3><p>원인 코드와 해결과정을 작성하기에 앞서 먼저 하단 툴바의 삭제 버튼을 클릭하여, 모달창이 띄어지고, 삭제를 실행하는 전체 흐름 함수를 확인해보자.</p><p>저장된 사이트(site)의 정보를 토대로 목록에 렌더링하는 함수인 renderItem(site) 에서 시작된다.</p><ul><li><p>renderItem(site) -> makeBottomToolbar(, site) -> makeDeleteInToolBar(, site) -> openModal() -> Modal 창 오픈</p></li><li><p>makeModal() -> deleteSite() -> closeModal -> window.location.reload()</p></li></ul><p>makeModal에 의해서 모달창은 브라우저 창이 load 시, 기본적으로 만들어지지만 화면에 나타나지 않도록 설계했다. 미리 만든 이유는 기본적으로 만들어서 있는 게 버튼을 클릭 이벤트 때마다 렌더링하는 것보다 속도가 빠르다고 생각했기 때문이다. 그래서 openModal()은 기존 class와 tag에 class name을 추가하여 모달창이 보이도록 한다.</p><p>또한, makeModal()을 makeDeleteInToolBar() 안에 넣을 수 없는 이유는 모달창은 1개만 필요하기 떄문이다. 만약 makeDeleteInToolBar 안에서 makeModal이 호출된다면 저장된 사이트 수만큼 하단 툴바가 생성되고, 그만큼 모달창이 생성된다.</p><h3 id=원인>원인<a hidden class=anchor aria-hidden=true href=#원인>#</a></h3><p>저장된 사이트들을 화면에 렌더링할 때 태그 속성을 식별자로 만들기 위해서 태그 속성 id의 값으로 각 site의 DB에 저장된 id 값으로 정했다.</p><p>❗️ 태그 속성 id의 값으로 db의 id 값을 입력한 것은 보안적으로 좋지 않기 때문에, 프로젝트 완성을 위해 다시 개발할 때 수정할 예정이다.</p><p>리액트의 경우, 자동적으로 이 태그들을 구분하기 때문에 식별자가 필요하다고 한다. 하지만 우리는 바닐라 js로 하기 때문에 필요했다.</p><p>하지만 모달 창을 통해 삭제할 때 이 모든 site의 id를 가져오기 때문에 발생된 issuse다. 식별을 위해서 입력했지만, 정작 코드 상 식별의 역할을 하지 못했다.</p><h3 id=해결-과정>해결 과정<a hidden class=anchor aria-hidden=true href=#해결-과정>#</a></h3><p>이 issue를 해결하는 초기 과정에서는 무엇이 원인인지 알 수 없어서, 다음과 같이 views.py의 해당 method를 print 문을 통해서 확인해보았다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>delete</span>(self, request, pk):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    site <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>get_object(pk)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;before delete site: </span><span style=color:#e6db74>{</span>site<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    site<span style=color:#f92672>.</span>delete()
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;after delete site: </span><span style=color:#e6db74>{</span>site<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Response({<span style=color:#e6db74>&#39;msg&#39;</span>: <span style=color:#e6db74>&#39;Deleted successfully&#39;</span>}, status<span style=color:#f92672>=</span>status<span style=color:#f92672>.</span>HTTP_200_OK)
</span></span></code></pre></td></tr></table></div></div><p>실행한 결과 터미널에서 모든 항목들이 하나씩 하나씩 출력되었다. 의도치 않게 자바스크립트에서 전체 사이트들이 포함된 배열로 보내져서 이것이 하나씩 삭제되는 건가 추측했지만, 터미널의 결과를 보니 그렇지 않았다. 한 항목의 하단 툴바 삭제 기능을 눌러 실행한 것이지만, 각 항목의 하단 툴바 삭제 버튼을 모든 항목에 대해서 클릭하여 일어난 것과 동일한 결과이기 때문이다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>before delete site: <span style=color:#f92672>....</span>
</span></span><span style=display:flex><span>before delete site: <span style=color:#f92672>....</span>
</span></span></code></pre></td></tr></table></div></div><p>그래서 이번에는 javascript 함수인 <code>makeDeleteInToolBar</code>, <code>makeModalActive</code>, <code>deleteSite</code> 에 각각 <code>console.log(site)</code> 를 입력하여 브라우저 콘솔 창에 확인하니 삭제 버튼을 실행하지 않아도 위 각 함수에서 모든 항목이 출력되는 걸 확인했다. 이는 js 문제이며 식별자 문제임을 확인했다.</p><p>만약 리액트로 이를 구현했다면, 리액트에서는 각 항목들을 구분하는 별도의 값을 자동적으로 만들어주기 때문에 이런 문제에 부딪히지 않는다고 멘토님을 통해 확인했다.</p><p>그래서 각 항목들을 확실하게 구별할 수 있는 식별자를 만들어, 이 식별자에 접근하여 삭제하는 방식을 권하셨다. 이에 대한 구체적인 방안으로 각 항목의 하단 툴바 삭제 버튼을 클릭하면 해당 항목의 class에 <code>selected</code> 를 추가한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>makeDeleteInToolBar</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>deleteButton</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;click&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>article</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>site</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 추가
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>article</span>.<span style=color:#a6e22e>classList</span>.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#39;selected&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>openModal</span>(<span style=color:#a6e22e>deleteButton</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    })}
</span></span></code></pre></td></tr></table></div></div><p>그리고 <code>selected</code>가 클래스 값에 있는 태그를 가져와, 이 태그의 id 값을 fetch에 입력하여 view 단에 보내는 흐름으로 구성했다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>deleteSite</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* DELETE http message를 보내는 함수 */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>site</span>      <span style=color:#f92672>=</span> <span style=color:#a6e22e>getElement</span>(<span style=color:#e6db74>&#39;.c18o9ext.grid.hiddenActions.noExcerpt.selected&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>csrftoken</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getCookie</span>(<span style=color:#e6db74>&#39;csrftoken&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span>      <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;DELETE&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;content-type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;application/json&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;X-CSRFToken&#39;</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>csrftoken</span>,  
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>`/api/sites/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>site</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>response</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>status</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>200</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;삭제 완료했습니다.&#39;</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>404</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;해당 항목이 존재하지 않습니다.&#39;</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>() 
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>error</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Error:&#39;</span>, <span style=color:#a6e22e>error</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>삭제 후, 화면을 다시 불러오기 위해서 <code>window.location.reload()</code>를 사용한다.</p><h3 id=최종-호출-순서>최종 호출 순서<a hidden class=anchor aria-hidden=true href=#최종-호출-순서>#</a></h3><p>문제 상황을 해결하고, 다른 팀원들도 공통으로 사용할 수 있도록 모달창을 모듈화한 최종 함수 호출 흐름은 다음과 같다.</p><ul><li><p>issue 발생 시 함수 호출 흐름: renderItem(site) -> makeBottomToolbar(, site) -> makeDeleteInToolBar(, site) -></p></li><li><p>최종 함수 호출 흐름: renderItem(site) -> makeBottomToolbar(, site) -> makeDeleteInToolBar(, site) -> openModal(param) -> makeModal(param) -> deleteSite()</p></li></ul><p>내가 코드를 작성했을 때 모달창 렌더링은 하단 툴바에서만 사용하는 경고 텍스트, 버튼 이름이었지만, 이를 상단 툴바나 이외의 곳에서 팀원들이 같이 사용하기 위해서 팀원들 모두 동의 하에 모듈화를 진행했다. 그래서 param의 역할은 모듈로 사용되기 위해서 다음과 같이 만들어진 객체다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// 하단 툴바의 모달창 Parameter
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>modalParam</span>  <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>func</span>        <span style=color:#f92672>:</span> <span style=color:#a6e22e>deleteSite</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>type</span>        <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;bottom&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>alarm_txt</span>   <span style=color:#f92672>:</span> <span style=color:#e6db74>`이 항목을 삭제하겠습니까? 삭제한 항목은 복원할 수 없습니다.`</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>title</span>       <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;항목 삭제&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>buttonName</span>  <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;삭제&#39;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>args</span>        <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 상단 툴바의 즐겨찾기 추가 복수 작업
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>modalParam</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>func</span>        <span style=color:#f92672>:</span> <span style=color:#a6e22e>bulkFavorite</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>type</span>        <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;bulk&#39;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>alarm_txt</span>   <span style=color:#f92672>:</span> <span style=color:#a6e22e>alarm_txt</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>title</span>       <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;선택 항목 즐겨찾기&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>buttonName</span>  <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;추가&#39;</span>, 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>args</span>        <span style=color:#f92672>:</span> <span style=color:#a6e22e>favorite</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>또한, 추가로 <code>article.classList.add('selected')</code> 였지만 코드 리뷰 시간에 <code>.toggle()</code>이란 걸 사용하면 없으면 추가하고, 있으면 빼는 작업을 자동적으로 해주는 걸 알게되어 <code>article.classList.toggle('selected')</code>로 수정했다.</p><p> </p><hr><h2 id=26-documentqueryselector-issue>2.6 Document.querySelector() issue<a hidden class=anchor aria-hidden=true href=#26-documentqueryselector-issue>#</a></h2><h3 id=발생된-issue-와-원인-코드>발생된 issue 와 원인 코드<a hidden class=anchor aria-hidden=true href=#발생된-issue-와-원인-코드>#</a></h3><blockquote><p><strong><em>첫 번째 article tag에 저장된 모든 사이트 수만큼 svg, path tag가 다 들어간 상황</em></strong></p></blockquote><p>아래 첫 번째 article tag의 하단 툴바 svg tag에 저장된 사이트의 갯수만큼 path 태그가 추가되어, 다른 항목들의 하단 툴바 이미지 아이콘이 보이지 않는 문제가 발생했다.</p><p>아래 이미지는 두 항목 모두 hover 된 상태이지만, 첫 번째에만 하단툴바 아이콘 이미지가 뜨고 있다.</p><p><img loading=lazy src=https://user-images.githubusercontent.com/78094972/205566677-2b0d0707-94b0-4c0a-a913-b332158d2241.png alt=image></p><p>즐겨찾기 만드는 함수 외에 카테고리 함수, 태그 함수, 삭제 함수 모두 다 발생된 문제이지만 예로서 즐겨찾기만 가져왔다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>makeFavoriteInToolBar</span>(<span style=color:#a6e22e>parentNode</span>, <span style=color:#a6e22e>site</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* 하단 툴바의 즐겨찾기 버튼 Dom을 만드는 함수 
</span></span></span><span style=display:flex><span><span style=color:#75715e>        - 특정 문자열로 className에 할당되는 값들은 클론코딩으로 가져오는 css를 반영하기 위한 것입니다.
</span></span></span><span style=display:flex><span><span style=color:#75715e>    */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>favoriteButtonContainer</span>       <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#e6db74>&#39;span&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>appendTag</span>(<span style=color:#a6e22e>parentNode</span>, <span style=color:#a6e22e>favoriteButtonContainer</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>favoriteButton</span>                <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#e6db74>&#39;button&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>favoriteButton</span>.<span style=color:#a6e22e>className</span>            <span style=color:#f92672>=</span> <span style=color:#a6e22e>site</span>.<span style=color:#a6e22e>favorite</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>false</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;m11fpiro t1221eea pmdugmx d1mp5exd favorite&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;m11fpiro t1221eea pmdugmx d1mp5exd favorite active&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>favoriteButton</span>.<span style=color:#a6e22e>setAttribute</span>(<span style=color:#e6db74>&#39;data-tooltip&#39;</span>, <span style=color:#a6e22e>site</span>.<span style=color:#a6e22e>favorite</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>false</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;즐겨찾기&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;즐겨찾기 해제&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>appendTag</span>(<span style=color:#a6e22e>favoriteButtonContainer</span>, <span style=color:#a6e22e>favoriteButton</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>favoriteIconContainer</span>         <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#e6db74>&#39;span&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>favoriteIconContainer</span>.<span style=color:#a6e22e>className</span>     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;i1qqph0t icon&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>appendTag</span>(<span style=color:#a6e22e>favoriteButton</span>, <span style=color:#a6e22e>favoriteIconContainer</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>favoriteIconSvgHTML</span>             <span style=color:#f92672>=</span> <span style=color:#e6db74>`&lt;svg class=&#39;favorite-icon-svg&#39; fill=&#34;currentColor&#34; viewBox=&#34;0 0 24 24&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;aria-hidden=&#34;true&#34;&gt;&lt;/svg&gt;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>favoriteIconContainer</span>.<span style=color:#a6e22e>insertAdjacentHTML</span>(<span style=color:#e6db74>&#39;beforeend&#39;</span>, <span style=color:#a6e22e>favoriteIconSvgHTML</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// issue가 발생된 원인
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>favoriteIconSvg</span>               <span style=color:#f92672>=</span> <span style=color:#a6e22e>getElement</span>(<span style=color:#e6db74>&#39;.favorite-icon-svg&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>favoriteIconPathHTML</span>            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&lt;path fill-rule=&#34;evenodd&#34; clip-rule=&#34;evenodd&#34; d=&#34;M12 1a1 1 0 0 1 .897.557l2.706 5.484 6.051.88a1 1 0 0 1 .555 1.705l-4.38 4.268 1.034 6.027a1 1 0 0 1-1.45 1.054L12 18.13l-5.413 2.845a1 1 0 0 1-1.45-1.054l1.033-6.027-4.379-4.268a1 1 0 0 1 .555-1.706l6.051-.88 2.706-5.483A1 1 0 0 1 12 1Zm0 3.26L9.958 8.397a1 1 0 0 1-.753.548l-4.567.663 3.305 3.221a1 1 0 0 1 .287.885l-.78 4.548 4.085-2.147a1 1 0 0 1 .93 0l4.085 2.147-.78-4.548a1 1 0 0 1 .287-.885l3.305-3.22-4.567-.664a1 1 0 0 1-.753-.548L12 4.26Z&#34;&gt;&lt;/path&gt;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>favoriteIconSvg</span>.<span style=color:#a6e22e>insertAdjacentHTML</span>(<span style=color:#e6db74>&#39;beforeend&#39;</span>, <span style=color:#a6e22e>favoriteIconPathHTML</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>changeFavoriteValue</span>(<span style=color:#a6e22e>favoriteButton</span>, <span style=color:#a6e22e>site</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>위 코드에서 <code>getElement</code> function이 문제의 원인이다. 이 function은 공통으로 사용하고자 custom function이다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getElement</span>(<span style=color:#a6e22e>elemVal</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* 단일 요소 가져오는 함수 */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#a6e22e>elemVal</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>이 함수를 사용했지만 해당 issue를 확인하지 못 했던 이유는 그 당시 내 목록에 추가했던 항목이 1개 밖에 없었기 때문이다. 팀원한테 이 issue를 듣고서 해결하기 시작했다.</p><p><code>querySelector</code> 는 전체 document에서 해당되는 태그들 중 첫 번째를 가져오기 때문에 발생한 이슈였다. <code>getElement</code>를 사용할 때 공식문서를 확인했지만, 놓친 부분이 있었던 것이다. 이는 <a href=https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector>Document.querySelector()</a>의 설명 부분을 보니 알 수 있었다.</p><h3 id=해결과정>해결과정<a hidden class=anchor aria-hidden=true href=#해결과정>#</a></h3><p>그래서 아래 2가지 방법을 생각해냈다.</p><ul><li>document.querySelector() 에서 document의 범위를 좁히기</li><li>getElement() 의 매개변수에 들어가는 부분을 보다 정확하게 타겟팅하기</li></ul><p>만약 첫 번째 방법을 사용한다면 만든 getElement를 사용할 수가 없어서 통일성이 깨지기 때문에, 먼저 getElement를 사용하는 방향을 선택했다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getElement</span>(<span style=color:#a6e22e>elemVal</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* 단일 요소 가져오는 함수 */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#a6e22e>elemVal</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>makeFavoriteInToolBar</span>(<span style=color:#a6e22e>parentNode</span>, <span style=color:#a6e22e>site</span>) {
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>favoriteIconSvg</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getElement</span>(<span style=color:#e6db74>&#39;.favorite-icon-svg&#39;</span>) 
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p><code>site.id</code>를 id 값으로 입력한 이유는 저장한 각 항목들을 구분하기 위한 식별자로 각 사이트를 렌더링할 때마다 속성값으로 입력했기 때문이다.</p><p>React라면 각각의 식별자가 자동적으로 추가된다고 하지만, vanilla JS를 사용했기 때문에 수동적으로 입력하는 게 필요했다. 그래서 아래 코드로 수정해서 화면을 확인하니 console에 입력한 id값은 타당하지 않은 선택자라고 한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// 변경 전
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>favoriteIconSvg</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getElement</span>(<span style=color:#e6db74>&#39;.favorite-icon-svg&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 변경 후
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>favoriteIconSvg</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getElement</span>(<span style=color:#e6db74>`&#39;#</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>site</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#39; .favorite-icon-svg`</span>)
</span></span></code></pre></td></tr></table></div></div><p>그래서 getElementById로 가져올 수도 있지만, 코드 통일성을 위해서 getElement는 사용하지 못 해도 querySelector를 사용하는 게 낫다는 판단으로 두 번째 방법은 사용하지 않고 첫 번째 방법으로 사용하기로 했다.</p><p>svg tag의 상위 태그인 span tag를 Container로 명명하여 document 대신에 이 컨테이너를 사용하여 범위를 좁혀서 접근하는 방식으로 해결했다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>favoriteIconContainer</span>     <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#e6db74>&#39;span&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>favoriteIconContainer</span>.<span style=color:#a6e22e>className</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;i1qqph0t icon&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>appendTag</span>(<span style=color:#a6e22e>favoriteButton</span>, <span style=color:#a6e22e>favoriteIconContainer</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>favoriteIconSvgHTML</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>`&lt;svg class=&#39;favorite-icon-svg&#39; fill=&#34;currentColor&#34; viewBox=&#34;0 0 24 24&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;aria-hidden=&#34;true&#34;&gt;&lt;/svg&gt;`</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>favoriteIconContainer</span>.<span style=color:#a6e22e>insertAdjacentHTML</span>(<span style=color:#e6db74>&#39;beforeend&#39;</span>, <span style=color:#a6e22e>favoriteIconSvgHTML</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 수정된 부분
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>favoriteIconSvg</span>           <span style=color:#f92672>=</span> <span style=color:#a6e22e>favoriteIconContainer</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;.favorite-icon-svg&#39;</span>)
</span></span></code></pre></td></tr></table></div></div><p>그 결과, 다음 이미지와 같이 하단 툴바가 몰리는 issue를 해결할 수 있었다.</p><p><img loading=lazy src=https://user-images.githubusercontent.com/78094972/205588915-a5022426-8374-4390-b67f-c63413565708.png alt=image></p><p> </p><hr><h1 id=3-fetch-함수-사용-시-issue-사항>3. Fetch 함수 사용 시 issue 사항<a hidden class=anchor aria-hidden=true href=#3-fetch-함수-사용-시-issue-사항>#</a></h1><h2 id=31-custom-함수-만들어-팀-공용으로-사용하기>3.1 Custom 함수 만들어 팀 공용으로 사용하기<a hidden class=anchor aria-hidden=true href=#31-custom-함수-만들어-팀-공용으로-사용하기>#</a></h2><p>DOM rendering을 위해 커스텀 함수를 만든 것처럼 fetch 함수의 두 번째 인자로 보낼 HTTP message를 그 때 그 때마다 다 작성하는 건 효율적이지 못하다고 판단하여 method와 Http body에 담을 data를 인자로 받는 <code>setFetchData</code>를 작성했다. 여기서 <code>content-type</code>을 <code>application/json</code>으로 정한 이유는 MDN을 통해 <a href=https://www.iana.org/assignments/media-types/media-types.xhtml>iana</a>을 들어가니 위 content-type에 대한 설명이 있었고, 구글링을 해도 application에서 json 타입으로 데이터를 주고 받을 때는 content-type에 위 형식을 사용한다고 나와서 이 방식으로 선택했다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setFetchData</span>(<span style=color:#a6e22e>method</span>, <span style=color:#a6e22e>body</span>){
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* Fetch data 셋팅 */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>csrftoken</span>   <span style=color:#f92672>=</span> <span style=color:#a6e22e>getCookie</span>(<span style=color:#e6db74>&#39;csrftoken&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>method</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;content-type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;application/json&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;X-CSRFToken&#39;</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>csrftoken</span>,        
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>body</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>data</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p> </p><h2 id=32-아임포트-javascript-sdk에-fetch-사용하기>3.2 아임포트 Javascript SDK에 fetch 사용하기<a hidden class=anchor aria-hidden=true href=#32-아임포트-javascript-sdk에-fetch-사용하기>#</a></h2><p>아임포트 결제 연동 서비스를 사용하기 위해서는 아임포트 Javascript SDK(Software Development Kit)를 사용해야 한다. 이 SDK를 통해서 내가 생성한 주문번호와 금액을 아임포트에 전달하고, 아임포트는 결제 번호를 나에게 전달한다.</p><p>그래서 이 SDK를 통해 결제 각 단계에서의 데이터 처리를 js function을 통해서 django의 view로 전달하고, DB에 결제 상태와 정보를 저장한다. 그리고, django의 view에 전달하기 위해서 fetch를 사용했다.</p><p>🔆 아임포트 Javascript SDK는 정확하게는 Ajax 문법으로 작성되어 있다. 구글링을 해도 SDK에 사용되는 function을 Ajax로 작성되어 있어서 javascript만 알고 있기 때문에, 이를 function은 js로 다 바꾸고, IMP.request_pay 부분은 다른 아임포트 라이브러리 ajax파일을 호출하기 때문에, 이 부분을 제외한 나머지 부분들도 js로 바꿨다.</p><p>🔆 이 문서에서는 Javascript SDK와의 전체적인 흐름이 아닌 fetch 함수의 비동기적 특징에 대해서만 다룬다.</p><ul><li><a href=http://localhost:1313/post/project/django/08_payment_overall_flow/#3-%EC%95%84%EC%9E%84%ED%8F%AC%ED%8A%B8-javascript-sdk%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-%EA%B2%B0%EC%A0%9C-%ED%9D%90%EB%A6%84>아임포트 Javascript SDK를 사용한 결제 흐름</a></li></ul><h3 id=발생된-issue와-원인-코드>발생된 issue와 원인 코드<a hidden class=anchor aria-hidden=true href=#발생된-issue와-원인-코드>#</a></h3><p>아래 코드에 나와있다시피 결제 금액과 결제 방식을 입력받은 함수가 주문 번호(merchant_id)를 반환하는 함수 과정에서 11번째 줄에는 merchant_id가 확인되지만, 15번째줄 console.log(result)에서는 merchant_id가 확인되지 않는 issue가 있었다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// IMP.request_pay를 호출하기 위한 merchant_id 반환
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>passMerchantId</span>(<span style=color:#a6e22e>e</span>, <span style=color:#a6e22e>amount</span>, <span style=color:#a6e22e>type</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>(); 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>setFetchData</span>(<span style=color:#e6db74>&#39;POST&#39;</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>amount</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>amount</span>, 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>type</span>, 
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>`/api/payment/checkout`</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>response</span> =&gt; <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>())
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>result</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>merchant_id</span>) <span style=color:#75715e>//58b9dea713
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>merchant_id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>merchant_id</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>merchant_id</span>
</span></span><span style=display:flex><span>    }).<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>err</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>result</span>) <span style=color:#75715e>// &#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>그래서 아임포트 IMP.request_pay()에 주문번호가 undefined로 전달되어 결제가 실패했다. 이를 방지하고자 아래와 같이 <code>merchant_id !== undefined</code> 또는 <code>merchand_id !== ''</code> 를 했지만, 올바른 값이 아니기 때문에 결제가 진행되지 못 했다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>import</span> {<span style=color:#a6e22e>getElement</span> ,<span style=color:#a6e22e>setFetchData</span>} <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./common.js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>window.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>IMP</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>IMP</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>IMP</span>.<span style=color:#a6e22e>init</span>(<span style=color:#e6db74>&#39;imp62676076&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>paymentButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getElement</span>(<span style=color:#e6db74>&#39;.order&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>paymentButton</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;click&#39;</span>, (<span style=color:#a6e22e>e</span>) =&gt; {
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>merchant_id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>passMerchantId</span>(<span style=color:#a6e22e>e</span>, <span style=color:#a6e22e>amount</span>, <span style=color:#a6e22e>type</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>merchant_id</span> <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>merchant_id</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>IMP</span>.<span style=color:#a6e22e>request_pay</span>({
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>pg</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;html5_inicis&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>merchant_uid</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>merchant_id</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Devket Premium 서비스&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>pay_method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;card&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>amount</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>amount</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 결제창 오픈
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 결제한 유저의 이름과 이메일 확인하고 결제 버튼 누른 후, 진행되는 로직 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>success</span>) {
</span></span><span style=display:flex><span>                   ...
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                  ...
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p> </p><h3 id=해결과정-1>해결과정<a hidden class=anchor aria-hidden=true href=#해결과정-1>#</a></h3><p><strong>[첫 번째 고려사항: Scope 상의 문제]</strong></p><p><a href=https://velog.io/@along/fetch%EC%9D%98-%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9D%B8-%EC%82%AC%EC%9A%A9%EB%B2%95%EA%B3%BC-scope-%EA%B7%B9%EB%B3%B5>fetch의 기본적인 사용법과 scope 극복</a>을 참고하여 다음 코드와 같이 fetch scope 외부에 <code>merchant_id</code>를 선언했고, 값이 재할당 되기 때문에 <code>let</code>을 사용했다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// IMP.request_pay를 호출하기 위한 merchant_id 반환
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>passMerchantId</span>(<span style=color:#a6e22e>e</span>, <span style=color:#a6e22e>amount</span>, <span style=color:#a6e22e>type</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>(); 
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 추가된 코드
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>merchant_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>setFetchData</span>(<span style=color:#e6db74>&#39;POST&#39;</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>amount</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>amount</span>, 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>type</span>, 
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>`/api/payment/checkout`</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>response</span> =&gt; <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>())
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>result</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>merchant_id</span>) <span style=color:#75715e>//58b9dea713
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>merchant_id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>merchant_id</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>merchant_id</span>
</span></span><span style=display:flex><span>    }).<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>err</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>result</span>) <span style=color:#75715e>// &#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>하지만, 그럼에도 결과는 동일했다.</p><h1 id=heading><a hidden class=anchor aria-hidden=true href=#heading>#</a></h1><p><strong>[두 번째 고려사항: 비동기]</strong></p><p><a href=https://chanhuiseok.github.io/posts/js-6/>JavaScript - 자바스크립트 fetch와 async/await</a> 블로그에 따르면 merchant_id 값이 다르게 출력되는 이유는 fetch가 비동기로 작동하기 때문이다. <strong><em>이전 작업이 완료될 때까지 기다리지 않고, 따로 처리하며 다른 코드들도 먼저 실행할 수 있도록 하는 작업</em></strong> 이다. 그러므로 fetch 밖에 정의한 merchant_id에는 할당되지 않는 상황인 <strong><em>순서가 정확히 보장되지 못하는 상황</em></strong> 에 처할 수 있다.</p><p>그래서 순서를 보장받고자 async와 await을 사용한다.</p><p>await은 <a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Operators/await>MDN - await</a>에 따르면 Promise 객체를 리턴하는 부분 앞에만 작성될 수 있고, await 연산자는 <code>async function</code> 내부에서만 사용할 수 있다고 하여 다음과 같이 async와 await을 추가했다. 왜냐하면 <code>Promise</code>가 <code>await</code> 연산자에 넘겨지면, <code>await</code>은 <code>Promise</code>가 완전히 실행되기를 기다렸다가 해당 값을 반환하기 때문이다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// async 추가
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>passMerchantId</span>(<span style=color:#a6e22e>e</span>, <span style=color:#a6e22e>amount</span>, <span style=color:#a6e22e>type</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>(); 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>merchant_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>setFetchData</span>(<span style=color:#e6db74>&#39;POST&#39;</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>amount</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>amount</span>, 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>type</span>, 
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#75715e>// await 추가
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>`/api/payment/checkout`</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>response</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>200</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;result.mechant_id: &#39;</span>, <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>merchant_id</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>merchant_id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>merchant_id</span>
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>401</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#39;로그인 해주세요.&#39;</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#39;문제가 발생했습니다. 다시 시도해주세요.&#39;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>merchant_id</span>
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p>하지만 그럼에도 merchant_id는 빈 값으로 반환되었다.</p><h1 id=heading-1><a hidden class=anchor aria-hidden=true href=#heading-1>#</a></h1><p><strong>[세 번째 고려사항: 정확한 사용방법이 맞는가?]</strong></p><p><a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Operators/await>MDN - await</a>와 위 블로그들을 보면서 await과 then을 같이 사용하는 코드를 발견하지 못하여 이에 대해 구글링을 했다.</p><p>구글링을 하는 과정에서 <a href=https://appdevelopmaster.tistory.com/491>async/ await 사용방법 (feat. then과 함께 쓰기)</a>, <a href=https://one-it.tistory.com/entry/Promise-%EC%A0%95%EB%A6%AC-asyncawait-%EC%82%AC%EC%9A%A9%EB%B2%95-then%EA%B3%BC%EC%9D%98-%EC%B0%A8%EC%9D%B4>Promise 정리: async/await 사용법 & then과의 차이</a> 문서뿐만 아니라 여러 문서들을 보면서 잘못된 방식으로 사용했다는 걸 알았다. 또한, 프로젝트 멘토님도 then과 await은 같이 사용하는 게 아니라는 의견을 주셨다.</p><p>그래서 then을 사용하지 않고 <code>const</code>로 변수를 선언하여 사용하기로 했다. <code>result.works</code>는 아임포트에서 success, fail를 판단할 때 사용하는 변수이기 때문에 그 외 함수 분기처리에도 사용하는 게 통일성 있는 방식으로 생각하여 아래와 같이 선택했다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// IMP.request_pay를 호출하기 위한 merchant_id 반환
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>passMerchantId</span>(<span style=color:#a6e22e>e</span>, <span style=color:#a6e22e>amount</span>, <span style=color:#a6e22e>type</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>(); 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>merchant_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>setFetchData</span>(<span style=color:#e6db74>&#39;POST&#39;</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>amount</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>amount</span>, 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>type</span>, 
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>`/api/payment/checkout`</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span>   <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>() 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>works</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>merchant_id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>merchant_id</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;merchant_id after then:&#39;</span>, <span style=color:#a6e22e>merchant_id</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>merchant_id</span> 
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>401</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#39;로그인 해주세요.&#39;</span>)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#39;문제가 발생했습니다. 다시 시도해주세요.&#39;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p><a href=https://velog.io/@dishate/Javascript-Promise-%EB%B0%B0%EA%B2%BD%EB%B6%80%ED%84%B0-then-catch-%EA%B7%B8%EB%A6%AC%EA%B3%A0-async-await%EA%B9%8C%EC%A7%80>Javascript Promise 배경부터 then catch 그리고 async await까지</a> 문서 뿐만 아니라 여러 문서들에서 보면 then ~ catch 이후에 새롭게 나온 방식이 async 와 await이라고 한다. then을 계속해서 사용하면 코드가 길어져 가독성이 좋지 않기 때문에, async 와 await 방식을 권장한다고 나온다.</p><hr><h1 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h1><ul><li><a href=https://github.com/backendnanodegree/Devket/pull/28/files>FEAT: Rendering mylist view and bottom-toolbar under each item #28</a></li><li><a href=https://lunayyko.github.io/wecode/2021/10/27/interview1/>루나의 TIL 기술 블로그</a></li><li><a href=https://tibetsandfox.tistory.com/16>Django - MVC 패턴과 MTV 패턴</a></li><li><a href=https://developer.mozilla.org/ko/docs/Web/API/Element/insertAdjacentHTML>MDN - Element.insertAdjacentHTML()</a></li><li><a href=https://www.iana.org/assignments/media-types/media-types.xhtml>iana</a></li><li><a href=https://velog.io/@along/fetch%EC%9D%98-%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9D%B8-%EC%82%AC%EC%9A%A9%EB%B2%95%EA%B3%BC-scope-%EA%B7%B9%EB%B3%B5>fetch의 기본적인 사용법과 scope 극복</a></li><li><a href=https://chanhuiseok.github.io/posts/js-6/>JavaScript - 자바스크립트 fetch와 async/await</a></li><li><a href=https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Operators/await>MDN - await</a></li><li><a href=https://appdevelopmaster.tistory.com/491>async/ await 사용방법 (feat. then과 함께 쓰기)</a></li><li><a href=https://one-it.tistory.com/entry/Promise-%EC%A0%95%EB%A6%AC-asyncawait-%EC%82%AC%EC%9A%A9%EB%B2%95-then%EA%B3%BC%EC%9D%98-%EC%B0%A8%EC%9D%B4>Promise 정리: async/await 사용법 & then과의 차이</a></li><li><a href=https://velog.io/@dishate/Javascript-Promise-%EB%B0%B0%EA%B2%BD%EB%B6%80%ED%84%B0-then-catch-%EA%B7%B8%EB%A6%AC%EA%B3%A0-async-await%EA%B9%8C%EC%A7%80>Javascript Promise 배경부터 then catch 그리고 async await까지</a></li></ul></div><footer class=post-footer><nav class=paginav><a class=prev href=http://jeha00.github.io/post/bookstudy/pythoncleancode/chapter03_formatting./><span class=title>« Prev Page</span><br><span>클린 코드, 이제는 파이썬이다: code formatting and black</span></a>
<a class=next href=http://jeha00.github.io/post/django/drf/drf_study03/><span class=title>Next Page »</span><br><span>Django study: DRF의 Policy - Throttle_scope, pagination, authentication & permission</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues on twitter" href="https://twitter.com/intent/tweet/?text=Project%3a%20DOM%20%ec%83%9d%ec%84%b1%ea%b3%bc%20fetch%20%ec%82%ac%ec%9a%a9%ec%9d%84%20%ec%9c%84%ed%95%9c%20Javascript%20%ed%95%99%ec%8a%b5%20%ed%9b%84%ea%b8%b0%20%eb%b0%8f%20%ea%b0%81%20%ea%b3%bc%ec%a0%95%ec%97%90%20%ec%9d%bc%ec%96%b4%eb%82%9c%20%ea%b0%9c%eb%b0%9c%20issues&url=http%3a%2f%2fjeha00.github.io%2fpost%2fproject%2fdevket%2fjs%2fdom_fetch_issue%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fjeha00.github.io%2fpost%2fproject%2fdevket%2fjs%2fdom_fetch_issue%2f&title=Project%3a%20DOM%20%ec%83%9d%ec%84%b1%ea%b3%bc%20fetch%20%ec%82%ac%ec%9a%a9%ec%9d%84%20%ec%9c%84%ed%95%9c%20Javascript%20%ed%95%99%ec%8a%b5%20%ed%9b%84%ea%b8%b0%20%eb%b0%8f%20%ea%b0%81%20%ea%b3%bc%ec%a0%95%ec%97%90%20%ec%9d%bc%ec%96%b4%eb%82%9c%20%ea%b0%9c%eb%b0%9c%20issues&summary=Project%3a%20DOM%20%ec%83%9d%ec%84%b1%ea%b3%bc%20fetch%20%ec%82%ac%ec%9a%a9%ec%9d%84%20%ec%9c%84%ed%95%9c%20Javascript%20%ed%95%99%ec%8a%b5%20%ed%9b%84%ea%b8%b0%20%eb%b0%8f%20%ea%b0%81%20%ea%b3%bc%ec%a0%95%ec%97%90%20%ec%9d%bc%ec%96%b4%eb%82%9c%20%ea%b0%9c%eb%b0%9c%20issues&source=http%3a%2f%2fjeha00.github.io%2fpost%2fproject%2fdevket%2fjs%2fdom_fetch_issue%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues on reddit" href="https://reddit.com/submit?url=http%3a%2f%2fjeha00.github.io%2fpost%2fproject%2fdevket%2fjs%2fdom_fetch_issue%2f&title=Project%3a%20DOM%20%ec%83%9d%ec%84%b1%ea%b3%bc%20fetch%20%ec%82%ac%ec%9a%a9%ec%9d%84%20%ec%9c%84%ed%95%9c%20Javascript%20%ed%95%99%ec%8a%b5%20%ed%9b%84%ea%b8%b0%20%eb%b0%8f%20%ea%b0%81%20%ea%b3%bc%ec%a0%95%ec%97%90%20%ec%9d%bc%ec%96%b4%eb%82%9c%20%ea%b0%9c%eb%b0%9c%20issues"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fjeha00.github.io%2fpost%2fproject%2fdevket%2fjs%2fdom_fetch_issue%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues on whatsapp" href="https://api.whatsapp.com/send?text=Project%3a%20DOM%20%ec%83%9d%ec%84%b1%ea%b3%bc%20fetch%20%ec%82%ac%ec%9a%a9%ec%9d%84%20%ec%9c%84%ed%95%9c%20Javascript%20%ed%95%99%ec%8a%b5%20%ed%9b%84%ea%b8%b0%20%eb%b0%8f%20%ea%b0%81%20%ea%b3%bc%ec%a0%95%ec%97%90%20%ec%9d%bc%ec%96%b4%eb%82%9c%20%ea%b0%9c%eb%b0%9c%20issues%20-%20http%3a%2f%2fjeha00.github.io%2fpost%2fproject%2fdevket%2fjs%2fdom_fetch_issue%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Project: DOM 생성과 fetch 사용을 위한 Javascript 학습 후기 및 각 과정에 일어난 개발 issues on telegram" href="https://telegram.me/share/url?text=Project%3a%20DOM%20%ec%83%9d%ec%84%b1%ea%b3%bc%20fetch%20%ec%82%ac%ec%9a%a9%ec%9d%84%20%ec%9c%84%ed%95%9c%20Javascript%20%ed%95%99%ec%8a%b5%20%ed%9b%84%ea%b8%b0%20%eb%b0%8f%20%ea%b0%81%20%ea%b3%bc%ec%a0%95%ec%97%90%20%ec%9d%bc%ec%96%b4%eb%82%9c%20%ea%b0%9c%eb%b0%9c%20issues&url=http%3a%2f%2fjeha00.github.io%2fpost%2fproject%2fdevket%2fjs%2fdom_fetch_issue%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://jeha00.github.io/>Jeha DevLog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>