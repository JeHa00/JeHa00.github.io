<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[TIL] Python basic 33: Closure | Jeha00 DevLog</title><meta name=keywords content="TIL,python"><meta name=description content="Closure를 설명하기 위해서 global variable, local variable에 추가하여 free variable에 대해 설명하고, 왜 closure가 필요한지, closure의 잘못된 사용법을 알아본다."><meta name=author content="Jeha00"><link rel=canonical href=http://jeha00.github.io/post/python_basic/python_basic_33_closure/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.1e44d58192cbf6d7a4eb649bc43dbc3d4cc432677e5d8adc69b08c34cbe461ac.css integrity="sha256-HkTVgZLL9tek62SbxD28PUzEMmd+XYrcabCMNMvkYaw=" rel="preload stylesheet" as=style><link rel=icon href=http://jeha00.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://jeha00.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://jeha00.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://jeha00.github.io/apple-touch-icon.png><link rel=mask-icon href=http://jeha00.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.98.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="[TIL] Python basic 33: Closure"><meta property="og:description" content="Closure를 설명하기 위해서 global variable, local variable에 추가하여 free variable에 대해 설명하고, 왜 closure가 필요한지, closure의 잘못된 사용법을 알아본다."><meta property="og:type" content="article"><meta property="og:url" content="http://jeha00.github.io/post/python_basic/python_basic_33_closure/"><meta property="og:image" content="http://jeha00.github.io/47"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-03-28T23:38:59+09:00"><meta property="article:modified_time" content="2022-03-28T23:38:59+09:00"><meta property="og:site_name" content="JeHa00 DevLog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://jeha00.github.io/47"><meta name=twitter:title content="[TIL] Python basic 33: Closure"><meta name=twitter:description content="Closure를 설명하기 위해서 global variable, local variable에 추가하여 free variable에 대해 설명하고, 왜 closure가 필요한지, closure의 잘못된 사용법을 알아본다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://jeha00.github.io/post/"},{"@type":"ListItem","position":2,"name":"[TIL] Python basic 33: Closure","item":"http://jeha00.github.io/post/python_basic/python_basic_33_closure/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[TIL] Python basic 33: Closure","name":"[TIL] Python basic 33: Closure","description":"Closure를 설명하기 위해서 global variable, local variable에 추가하여 free variable에 대해 설명하고, 왜 closure가 필요한지, closure의 잘못된 사용법을 알아본다.","keywords":["TIL","python"],"articleBody":"Intro  Closure가 필요한 이유 그리고, 잘못 사용된 사례에 대해 알아보자.   1. UnboundLocalError  전역 변수와 지역 변수에 대해 간단히 복습해보자.  # global (전역) 변수  c = 30   def func_v3(a):  print(a)  # local (지역) 변수  print(c)  c = 40   func_v3(10) UnboundLocalError: local variable 'c' referenced before assignmnet   func_v3를 정의하기 전에 c에 값을 할당했다.\n  그래서 func_v3 안에 값은 이름의 c 와 이어질거라 생각했지만, Error가 떴다.\n  Error의 의미:\n c 라는 변수에 값이 할당되지 않았는데, print(c)로 참조되었다. 함수 블럭에서 할당하는 건 지역 변수다. 하지만, name이 같아도 함수 밖에서 할당했기 때문에 전역 변수로 인식하여 다르다.    해결책\n function block 안에 global 선언을 하든가, nonlocal 선언을 한다. local scope에서 전역으로 쓸 수 있는 방법이다.     c = 30   def func_v3(a):   global c  print(a)  print(c)  c = 40  # 함수 실행 전 이므로 30이 출력된다.  print('',c) 30   func_v3(10) 10 30  # 함수 실행 후에는 40이 출력된다.  print('',c) 40   해결책의 문제점\n 함수 내에 global 또는 nonlocal을 쓰는 건 좋은 방법이 아니다. 왜냐하면 함수 내에 전역 변수와 연결되는 게 있다면 디버깅 할 때 쉽지 않다. 그래서 위의 statement로 local에서 수정하는 건 권하지 않는다.    그래서 또 다른 방법이 바로 closure(클로저) 다.\n  이 클로저에 대해 알아보자.\n   2. Closure 2.1 What is closure ??  [Reference에 따른 closure 정의]\n 외부에서 호출된 함수의 변수값, 상태(레퍼런스)를 복사 후 저장한다. 그 후에 접근(액세스)이 가능하도록 하는 도구     scope을 기준으로 설명하자면\n  Closure란 enclosing scope에 있는 자유변수(free variable)를 이 scope의 실행이 종료되도 보유하고 있는 내부 함수 또는 중첩함수를 말한다.\n  자유변수(free variable)란??\n 정의되지 않은 code block에 사용되는 변수 여러 번 호출이 일어나도 상태 정보를 보유하기 위해 closure가 사용하는 원리      closure는 outer function을 호출해서 innter function을 return 했지만, outer function의 enclosing scope 에 있던 자유변수(free variable)를 계속해서 기억한다.\n  그래서, 함수실행이 끝나도 그 시점의 변수를 이어서 작업할 수 있다.\n  2.2 Why does we need closure ??   함수 안에 선언된 것들이 함수의 실행이 끝나서 소멸되면 변수 값도 사라지지만, closure를 사용하면 기억된다.\n  서버 프로그래밍의 관점에서 closure를 바라보면\n 서버 프로그래밍에서 어려운 것이 동시성(Concurrency) 제어다. 한정된 메모리 공간에서 여러 자원이 접근하면 교착상태(Dead lock)에 부딪힌다. 이를 해결하는 게 동시성(Concurrency) 제어다. closure는 불변자료 (immutable, Read Only) 구조 및 atom, STM 이므로 multi-thread 프로그래밍에 강점을 가진다. multi-thread가 아닌 단일 thread인데도 동시성을 갖도록 하는 기반이 되는 게 바로 이 closure다.    또한, 이 클로저는 함수형 프로그래밍에도 연결된다.\n  위 관점에 대해서는 그렇구나 정도만 알고 넘어가자. 나중에 차차 알아보자.\n  그러면 class를 사용하여 closure가 무엇인지 구현해보자.\n  # global scope  class Avenager(): # enclosing scope  def __init__(self):  self._series = [] # local scope # special method __call__은 class를 function처럼 호출해서 사용하도록 한다.  def __call__(self, v):  self._series.append(v)  print('inner  {} / {}'.format(self._series, len(self, series)))  return sum(self._series) / len(self._series)  # local scope  # 인스턴스 생성  averager_cls = Averager()  # 누적 # instance를 생성했는데, function처럼 사용하고 있다. # Avenger()를 사용하면 __call_ method의 return 값이 출력된다.   print(averager_cls(15))  print(averager_cls(35))  print(averager_cls(40)) inner  [15] / 1 15.0 inner  [15, 35] / 2 25.0 inner  [15, 35, 40] / 3 30.0  위의 예시처럼 class 실행이 끝나서, 변수가 소멸되야 하는데 유지되고 있다. 상태를 기억하고 있기 때문에 계속해서 누적된다. 그래서 중간부터 해도 이어서 할 수 있다.   3. Exercises for closure  closure는 pattern이 정해져 있다.  # global scope  def closure_ex1():  # closure_ex1의 local scope이면서 # averager(v)의 the enclosing scope 또는 자유영역 # 이 영역에 정의된 변수: series  series = []   def averager(v): # averager의 local scope  series.append(v)  print('inner  {} / {}'.format(series, len(series)))  return sum(series) / len(series)  # 일급 함수의 특징: 함수를 반환할 수 있다.  return averager  # make a instance # 반환값인 averager가 avg_closure1에 할당된다.  avg_closure1 = closure_ex1()   print(avg_closure1) .averager at 0x000001B59D11FC10  # 인자로 입력된 15는 averager function의 인자 v이다.  print(avg_closure1(15)) inner  [15] / 1 15.0  print(avg_closure1(35)) inner  [15, 35] / 2 25.0  print(avg_closure1(40)) inner  [15, 35, 40] / 3 30.0  series가 local scope에 있었다면 위 경우처럼 출력할 때 이전 값이 보존되지 않는다. 왜냐하면 averager가 실행이 끝나면 그 안에 local scope에 있던 변수는 소멸된다. 하지만, enclosing scope에 변수를 정의했기 때문에, 함수를 실행할 때마다 자유변수에 접근해서 값이 보존된다. 그래서 새로 추가해도 실행이 가능하다.   그러면 파이썬에서 이 closure를 어떻게 취급하는지 확인해보자.  # function inspection # __closure__ 로 취급된다. # __call__이 있으므로, 호출할 수 있다.  print(dir(avg_closure1)) ['__annotations__', '__call__', '__class__', '__closure__', '__dict__', '__dir__', '__doc__', '__init__', '__init_subclass__', '__kwdefaults__', '__le__', '__lt__', '__module__', '__name__']  # detail한 함수 목록이 나온다.  print(dir(avg_closure1.__code__))   print(avg_closure1.__code__.co_freevars) ('series',)  # 자유 변수값을 출력할 수 있다.  print(avg_closure1.__closure__[0].cell_contents) [15, 35, 40]  __code__: 함수가 컴파일되서 바이트코드 상태의 정보를 출력해주는 역할   4. Incorrect use of closures  closure의 잘못된 사용법을 예제로 알아보자.   def closure_ex3():  # Free variable  cnt = 0  total = 0   def averager(v):  # cnt와 total을 자유변수로 만든다.  nonlocal cnt, total  cnt += 1  total += v  return total / cnt   return averager   avg_closure3 = closure_ex3()   print(avg_closure3(15)) 15.0  print(avg_closure3(35)) 25.0  print(avg_closure3(40)) 30.0  바로 위의 예시처럼 nonlocal을 사용하는 방법 그리고, UnboundLocalError를 설명할 때 언급한 global 을 사용하는 법이 잘못된 closure 사용법이다. UnboundLocalError 를 설명한 경우와 달리, 변수를 전역이 아닌 자유 변수로 만들었다. 그래서, closure지만 좋은 방법이 아니다. 왜냐하면 함수 내에 전역 변수와 연결되는 게 있다면 디버깅 할 때 쉽지 않다.   Reference  인프런 파이썬 중급 Python Scope \u0026 the LEGB Rule: Resolving Names in Your Code  ","wordCount":"863","inLanguage":"en","datePublished":"2022-03-28T23:38:59+09:00","dateModified":"2022-03-28T23:38:59+09:00","author":{"@type":"Person","name":"Jeha00"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://jeha00.github.io/post/python_basic/python_basic_33_closure/"},"publisher":{"@type":"Organization","name":"Jeha00 DevLog","logo":{"@type":"ImageObject","url":"http://jeha00.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://jeha00.github.io/ accesskey=h title="Jeha00 (Alt + H)">Jeha00</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://jeha00.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=http://jeha00.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=http://jeha00.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://jeha00.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://jeha00.github.io/>Home</a>&nbsp;»&nbsp;<a href=http://jeha00.github.io/post/>Posts</a></div><h1 class=post-title>[TIL] Python basic 33: Closure</h1><div class=post-meta><span title="2022-03-28 23:38:59 +0900 KST">March 28, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Jeha00&nbsp;|&nbsp;<a href=https://github.com/JeHa00/blog/content/post/Python_basic/Python_basic_33_closure.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#intro aria-label=Intro>Intro</a></li><li><a href=#1-unboundlocalerror aria-label="1. UnboundLocalError">1. UnboundLocalError</a></li><li><a href=#2-closure aria-label="2. Closure">2. Closure</a><ul><li><a href=#21-what-is-closure- aria-label="2.1 What is closure ??">2.1 What is closure ??</a></li><li><a href=#22-why-does-we-need-closure- aria-label="2.2 Why does we need closure ??">2.2 Why does we need closure ??</a></li></ul></li><li><a href=#3-exercises-for-closure aria-label="3. Exercises for closure">3. Exercises for closure</a></li><li><a href=#4-incorrect-use-of-closures aria-label="4. Incorrect use of closures">4. Incorrect use of closures</a></li><li><a href=#reference aria-label=Reference>Reference</a></li></ul></div></details></div><div class=post-content><h1 id=intro>Intro<a hidden class=anchor aria-hidden=true href=#intro>#</a></h1><ul><li>Closure가 필요한 이유 그리고, 잘못 사용된 사례에 대해 알아보자.</li></ul><hr><h1 id=1-unboundlocalerror>1. UnboundLocalError<a hidden class=anchor aria-hidden=true href=#1-unboundlocalerror>#</a></h1><ul><li>전역 변수와 지역 변수에 대해 간단히 복습해보자.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#6272a4># global (전역) 변수</span>
</span></span><span style=display:flex><span>&gt; c = 30
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt; def func_v3(a)</span>:
</span></span><span style=display:flex><span>&gt;    print(a)
</span></span><span style=display:flex><span>&gt;    <span style=color:#6272a4># local (지역) 변수</span>
</span></span><span style=display:flex><span>&gt;    print(c)
</span></span><span style=display:flex><span>&gt;    c = 40
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; func_v3(10)
</span></span><span style=display:flex><span><span style=color:#ff79c6>UnboundLocalError</span>: local variable &#39;c&#39; referenced before assignmnet
</span></span></code></pre></div><ul><li><p>func_v3를 정의하기 전에 c에 값을 할당했다.</p></li><li><p>그래서 func_v3 안에 값은 이름의 c 와 이어질거라 생각했지만, Error가 떴다.</p></li><li><p>Error의 의미:</p><ul><li><code>c</code> 라는 변수에 값이 할당되지 않았는데, print(c)로 참조되었다.</li><li>함수 블럭에서 할당하는 건 <code>지역 변수</code>다.</li><li>하지만, name이 같아도 함수 밖에서 할당했기 때문에 <code>전역 변수</code>로 인식하여 다르다.</li></ul></li><li><p>해결책</p><ul><li>function block 안에 <code>global</code> 선언을 하든가, <code>nonlocal</code> 선언을 한다.</li><li>local scope에서 전역으로 쓸 수 있는 방법이다.</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>&gt; c = 30
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt; def func_v3(a)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt;    global c
</span></span><span style=display:flex><span>&gt;    print(a)
</span></span><span style=display:flex><span>&gt;    print(c)
</span></span><span style=display:flex><span>&gt;    c = 40
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 함수 실행 전 이므로 30이 출력된다.</span>
</span></span><span style=display:flex><span>&gt; print(&#39;&gt;&gt;&#39;,c)
</span></span><span style=display:flex><span><span style=color:#bd93f9>30</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; func_v3(10)
</span></span><span style=display:flex><span><span style=color:#bd93f9>10</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>30</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 함수 실행 후에는 40이 출력된다.</span>
</span></span><span style=display:flex><span>&gt; print(&#39;&gt;&gt;&gt;&#39;,c)
</span></span><span style=display:flex><span><span style=color:#bd93f9>40</span>
</span></span></code></pre></div><ul><li><p>해결책의 문제점</p><ul><li>함수 내에 <code>global</code> 또는 <code>nonlocal</code>을 쓰는 건 좋은 방법이 아니다.</li><li>왜냐하면 함수 내에 전역 변수와 연결되는 게 있다면 <em>디버깅</em> 할 때 쉽지 않다.</li><li>그래서 위의 statement로 local에서 수정하는 건 권하지 않는다.</li></ul></li><li><p>그래서 또 다른 방법이 바로 <code>closure(클로저)</code> 다.</p></li><li><p>이 클로저에 대해 알아보자.</p></li></ul><hr><h1 id=2-closure>2. Closure<a hidden class=anchor aria-hidden=true href=#2-closure>#</a></h1><h2 id=21-what-is-closure->2.1 What is closure ??<a hidden class=anchor aria-hidden=true href=#21-what-is-closure->#</a></h2><blockquote><p>[Reference에 따른 closure 정의]</p><ul><li>외부에서 호출된 함수의 변수값, 상태(레퍼런스)를 복사 후 저장한다.</li><li>그 후에 접근(액세스)이 가능하도록 하는 도구</li></ul></blockquote><ul><li><p>scope을 기준으로 설명하자면</p><ul><li><p><strong>Closure란 enclosing scope에 있는 자유변수(free variable)를 이 scope의 실행이 종료되도 보유하고 있는 내부 함수 또는 중첩함수를 말한다.</strong></p></li><li><p>자유변수(free variable)란??</p><ul><li>정의되지 않은 code block에 사용되는 변수</li><li>여러 번 호출이 일어나도 상태 정보를 보유하기 위해 closure가 사용하는 원리</li></ul></li></ul></li><li><p>closure는 outer function을 호출해서 innter function을 return 했지만, outer function의 <strong><em>enclosing scope</em></strong> 에 있던 <strong><em>자유변수(free variable)를 계속해서 기억한다.</em></strong></p></li><li><p>그래서, 함수실행이 끝나도 그 시점의 변수를 이어서 작업할 수 있다.</p></li></ul><h2 id=22-why-does-we-need-closure->2.2 Why does we need closure ??<a hidden class=anchor aria-hidden=true href=#22-why-does-we-need-closure->#</a></h2><ul><li><p>함수 안에 선언된 것들이 함수의 실행이 끝나서 소멸되면 변수 값도 사라지지만, closure를 사용하면 기억된다.</p></li><li><p>서버 프로그래밍의 관점에서 closure를 바라보면</p><ul><li>서버 프로그래밍에서 어려운 것이 <code>동시성(Concurrency) 제어</code>다.</li><li>한정된 메모리 공간에서 여러 자원이 접근하면 <code>교착상태(Dead lock)</code>에 부딪힌다.</li><li>이를 해결하는 게 <code>동시성(Concurrency) 제어</code>다.</li><li>closure는 불변자료 (immutable, Read Only) 구조 및 atom, STM 이므로 multi-thread 프로그래밍에 강점을 가진다.</li><li>multi-thread가 아닌 <code>단일 thread</code>인데도 동시성을 갖도록 하는 기반이 되는 게 바로 이 closure다.</li></ul></li><li><p>또한, 이 클로저는 함수형 프로그래밍에도 연결된다.</p></li><li><p>위 관점에 대해서는 그렇구나 정도만 알고 넘어가자. 나중에 차차 알아보자.</p></li><li><p>그러면 class를 사용하여 closure가 무엇인지 구현해보자.</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#6272a4># global scope</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt; class Avenager()</span>:
</span></span><span style=display:flex><span><span style=color:#6272a4># enclosing scope</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;   def __init__(self)</span>:
</span></span><span style=display:flex><span>&gt;       self._series = []
</span></span><span style=display:flex><span><span style=color:#6272a4># local scope</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># special method __call__은 class를 function처럼 호출해서 사용하도록 한다.</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;   def __call__(self, v)</span>:
</span></span><span style=display:flex><span>&gt;       self._series.append(v)
</span></span><span style=display:flex><span>&gt;       print(&#39;inner &gt;&gt;&gt; {} / {}&#39;.format(self._series, len(self, series)))
</span></span><span style=display:flex><span>&gt;       return sum(self._series) / len(self._series)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># local scope</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 인스턴스 생성</span>
</span></span><span style=display:flex><span>&gt; averager_cls = Averager()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 누적</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># instance를 생성했는데, function처럼 사용하고 있다.</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># Avenger()를 사용하면 __call_ method의 return 값이 출력된다.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; print(averager_cls(15))
</span></span><span style=display:flex><span>&gt; print(averager_cls(35))
</span></span><span style=display:flex><span>&gt; print(averager_cls(40))
</span></span><span style=display:flex><span>inner &gt;&gt;&gt; [15] / 1
</span></span><span style=display:flex><span><span style=color:#bd93f9>15.0</span>
</span></span><span style=display:flex><span>inner &gt;&gt;&gt; [15, 35] / 2
</span></span><span style=display:flex><span><span style=color:#bd93f9>25.0</span>
</span></span><span style=display:flex><span>inner &gt;&gt;&gt; [15, 35, 40] / 3
</span></span><span style=display:flex><span><span style=color:#bd93f9>30.0</span>
</span></span></code></pre></div><ul><li>위의 예시처럼 class 실행이 끝나서, 변수가 소멸되야 하는데 유지되고 있다.</li><li>상태를 기억하고 있기 때문에 계속해서 누적된다.</li><li>그래서 중간부터 해도 이어서 할 수 있다.</li></ul><hr><h1 id=3-exercises-for-closure>3. Exercises for closure<a hidden class=anchor aria-hidden=true href=#3-exercises-for-closure>#</a></h1><ul><li>closure는 pattern이 정해져 있다.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#6272a4># global scope</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt; def closure_ex1()</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># closure_ex1의 local scope이면서</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># averager(v)의 the enclosing scope 또는 자유영역</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 이 영역에 정의된 변수: series</span>
</span></span><span style=display:flex><span>&gt;   series = []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;   def averager(v)</span>:
</span></span><span style=display:flex><span><span style=color:#6272a4># averager의 local scope</span>
</span></span><span style=display:flex><span>&gt;      series.append(v)
</span></span><span style=display:flex><span>&gt;      print(&#39;inner &gt;&gt;&gt; {} / {}&#39;.format(series, len(series)))
</span></span><span style=display:flex><span>&gt;      return sum(series) / len(series)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 일급 함수의 특징: 함수를 반환할 수 있다.</span>
</span></span><span style=display:flex><span>&gt;   return averager
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># make a instance</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 반환값인 averager가 avg_closure1에 할당된다.</span>
</span></span><span style=display:flex><span>&gt; avg_closure1 = closure_ex1()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; print(avg_closure1)
</span></span><span style=display:flex><span>&lt;function closure_ex1.&lt;locals&gt;.averager at 0x000001B59D11FC10&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 인자로 입력된 15는 averager function의 인자 v이다.</span>
</span></span><span style=display:flex><span>&gt; print(avg_closure1(15))
</span></span><span style=display:flex><span>inner &gt;&gt;&gt; [15] / 1
</span></span><span style=display:flex><span><span style=color:#bd93f9>15.0</span>
</span></span><span style=display:flex><span>&gt; print(avg_closure1(35))
</span></span><span style=display:flex><span>inner &gt;&gt;&gt; [15, 35] / 2
</span></span><span style=display:flex><span><span style=color:#bd93f9>25.0</span>
</span></span><span style=display:flex><span>&gt; print(avg_closure1(40))
</span></span><span style=display:flex><span>inner &gt;&gt;&gt; [15, 35, 40] / 3
</span></span><span style=display:flex><span><span style=color:#bd93f9>30.0</span>
</span></span></code></pre></div><ul><li>series가 local scope에 있었다면 위 경우처럼 출력할 때 이전 값이 보존되지 않는다.</li><li>왜냐하면 averager가 실행이 끝나면 그 안에 local scope에 있던 변수는 소멸된다.</li><li>하지만, enclosing scope에 변수를 정의했기 때문에, 함수를 실행할 때마다 자유변수에 접근해서 값이 보존된다.</li><li>그래서 새로 추가해도 실행이 가능하다.</li></ul><ul><li>그러면 파이썬에서 이 closure를 어떻게 취급하는지 확인해보자.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#6272a4># function inspection</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># __closure__ 로 취급된다.</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># __call__이 있으므로, 호출할 수 있다.</span>
</span></span><span style=display:flex><span>&gt; print(dir(avg_closure1))
</span></span><span style=display:flex><span>[<span style=color:#f1fa8c>&#39;__annotations__&#39;</span>, <span style=color:#f1fa8c>&#39;__call__&#39;</span>, <span style=color:#f1fa8c>&#39;__class__&#39;</span>, <span style=color:#f1fa8c>&#39;__closure__&#39;</span>, <span style=color:#f1fa8c>&#39;__dict__&#39;</span>, <span style=color:#f1fa8c>&#39;__dir__&#39;</span>, <span style=color:#f1fa8c>&#39;__doc__&#39;</span>, <span style=color:#f1fa8c>&#39;__init__&#39;</span>, <span style=color:#f1fa8c>&#39;__init_subclass__&#39;</span>, <span style=color:#f1fa8c>&#39;__kwdefaults__&#39;</span>, <span style=color:#f1fa8c>&#39;__le__&#39;</span>, <span style=color:#f1fa8c>&#39;__lt__&#39;</span>, <span style=color:#f1fa8c>&#39;__module__&#39;</span>, <span style=color:#f1fa8c>&#39;__name__&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># detail한 함수 목록이 나온다.</span>
</span></span><span style=display:flex><span>&gt; print(dir(avg_closure1.__code__))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; print(avg_closure1.__code__.co_freevars)
</span></span><span style=display:flex><span>(&#39;series&#39;,)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 자유 변수값을 출력할 수 있다.</span>
</span></span><span style=display:flex><span>&gt; print(avg_closure1.__closure__[0].cell_contents)
</span></span><span style=display:flex><span>[<span style=color:#bd93f9>15</span>, <span style=color:#bd93f9>35</span>, <span style=color:#bd93f9>40</span>]
</span></span></code></pre></div><ul><li><code>__code__</code>: 함수가 컴파일되서 바이트코드 상태의 정보를 출력해주는 역할</li></ul><hr><h1 id=4-incorrect-use-of-closures>4. Incorrect use of closures<a hidden class=anchor aria-hidden=true href=#4-incorrect-use-of-closures>#</a></h1><ul><li>closure의 잘못된 사용법을 예제로 알아보자.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff79c6>&gt; def closure_ex3()</span>:
</span></span><span style=display:flex><span>&gt;     <span style=color:#6272a4># Free variable</span>
</span></span><span style=display:flex><span>&gt;     cnt = 0
</span></span><span style=display:flex><span>&gt;     total = 0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;     def averager(v)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># cnt와 total을 자유변수로 만든다.</span>
</span></span><span style=display:flex><span>&gt;         nonlocal cnt, total
</span></span><span style=display:flex><span>&gt;         cnt += 1
</span></span><span style=display:flex><span>&gt;         total += v
</span></span><span style=display:flex><span>&gt;         return total / cnt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt;     return averager
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; avg_closure3 = closure_ex3()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; print(avg_closure3(15))
</span></span><span style=display:flex><span><span style=color:#bd93f9>15.0</span>
</span></span><span style=display:flex><span>&gt; print(avg_closure3(35))
</span></span><span style=display:flex><span><span style=color:#bd93f9>25.0</span>
</span></span><span style=display:flex><span>&gt; print(avg_closure3(40))
</span></span><span style=display:flex><span><span style=color:#bd93f9>30.0</span>
</span></span></code></pre></div><ul><li>바로 위의 예시처럼 <code>nonlocal</code>을 사용하는 방법 그리고, UnboundLocalError를 설명할 때 언급한 <code>global</code> 을 사용하는 법이 잘못된 closure 사용법이다.</li><li>UnboundLocalError 를 설명한 경우와 달리, 변수를 전역이 아닌 자유 변수로 만들었다.</li><li>그래서, closure지만 좋은 방법이 아니다.</li><li>왜냐하면 함수 내에 전역 변수와 연결되는 게 있다면 <em>디버깅</em> 할 때 쉽지 않다.</li></ul><hr><h1 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h1><ul><li><a href=https://www.inflearn.com/course/%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EC%A4%91%EA%B8%89-%EC%9D%B8%ED%94%84%EB%9F%B0-%EC%98%A4%EB%A6%AC%EC%A7%80%EB%84%90>인프런 파이썬 중급</a></li><li><a href=https://realpython.com/python-scope-legb-rule/#using-enclosing-scopes-as-closures>Python Scope & the LEGB Rule: Resolving Names in Your Code</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://jeha00.github.io/tags/til/>TIL</a></li><li><a href=http://jeha00.github.io/tags/python/>python</a></li></ul><nav class=paginav><a class=prev href=http://jeha00.github.io/post/python_basic/python_basic_34_decorator/><span class=title>« Prev Page</span><br><span>[TIL] Python basic 34: Decorator</span></a>
<a class=next href=http://jeha00.github.io/post/python_basic/python_basic_32_legb_rules/><span class=title>Next Page »</span><br><span>[TIL] Python basic 32: LEGB rules and Memory structures</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share [TIL] Python basic 33: Closure on twitter" href="https://twitter.com/intent/tweet/?text=%5bTIL%5d%20Python%20basic%2033%3a%20Closure&url=http%3a%2f%2fjeha00.github.io%2fpost%2fpython_basic%2fpython_basic_33_closure%2f&hashtags=TIL%2cpython"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [TIL] Python basic 33: Closure on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fjeha00.github.io%2fpost%2fpython_basic%2fpython_basic_33_closure%2f&title=%5bTIL%5d%20Python%20basic%2033%3a%20Closure&summary=%5bTIL%5d%20Python%20basic%2033%3a%20Closure&source=http%3a%2f%2fjeha00.github.io%2fpost%2fpython_basic%2fpython_basic_33_closure%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [TIL] Python basic 33: Closure on reddit" href="https://reddit.com/submit?url=http%3a%2f%2fjeha00.github.io%2fpost%2fpython_basic%2fpython_basic_33_closure%2f&title=%5bTIL%5d%20Python%20basic%2033%3a%20Closure"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [TIL] Python basic 33: Closure on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fjeha00.github.io%2fpost%2fpython_basic%2fpython_basic_33_closure%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [TIL] Python basic 33: Closure on whatsapp" href="https://api.whatsapp.com/send?text=%5bTIL%5d%20Python%20basic%2033%3a%20Closure%20-%20http%3a%2f%2fjeha00.github.io%2fpost%2fpython_basic%2fpython_basic_33_closure%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [TIL] Python basic 33: Closure on telegram" href="https://telegram.me/share/url?text=%5bTIL%5d%20Python%20basic%2033%3a%20Closure&url=http%3a%2f%2fjeha00.github.io%2fpost%2fpython_basic%2fpython_basic_33_closure%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><script src=https://utteranc.es/client.js repo=JeHa00/blog-comments issue-term=pathname theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2022 <a href=http://jeha00.github.io/>Jeha00 DevLog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>