<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기 | Jeha DevLog</title><meta name=keywords content="docker"><meta name=description content="docker만을 사용하여 django를 배포한 후, Dockerfile을 nginx와 djang application 에 대해 각각 만들어서 docker compose로 여러 컨테이너를 연결하여 배포하는 것을 학습해본다."><meta name=author content><link rel=canonical href=http://jeha00.github.io/post/docker/04_deployment-by-docker/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.98b03e72aec907a0ac061df0117773231da749cf102384a4522e91bc58f66b1e.css integrity="sha256-mLA+cq7JB6CsBh3wEXdzIx2nSc8QI4SkUi6RvFj2ax4=" rel="preload stylesheet" as=style><link rel=icon href=http://jeha00.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://jeha00.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://jeha00.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://jeha00.github.io/apple-touch-icon.png><link rel=mask-icon href=http://jeha00.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.101.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기"><meta property="og:description" content="docker만을 사용하여 django를 배포한 후, Dockerfile을 nginx와 djang application 에 대해 각각 만들어서 docker compose로 여러 컨테이너를 연결하여 배포하는 것을 학습해본다."><meta property="og:type" content="article"><meta property="og:url" content="http://jeha00.github.io/post/docker/04_deployment-by-docker/"><meta property="og:image" content="http://jeha00.github.io/47"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-12-08T13:42:28+09:00"><meta property="article:modified_time" content="2022-12-08T13:42:28+09:00"><meta property="og:site_name" content="JeHa00 DevLog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://jeha00.github.io/47"><meta name=twitter:title content="Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기"><meta name=twitter:description content="docker만을 사용하여 django를 배포한 후, Dockerfile을 nginx와 djang application 에 대해 각각 만들어서 docker compose로 여러 컨테이너를 연결하여 배포하는 것을 학습해본다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://jeha00.github.io/post/"},{"@type":"ListItem","position":2,"name":"Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기","item":"http://jeha00.github.io/post/docker/04_deployment-by-docker/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기","name":"Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기","description":"docker만을 사용하여 django를 배포한 후, Dockerfile을 nginx와 djang application 에 대해 각각 만들어서 docker compose로 여러 컨테이너를 연결하여 배포하는 것을 학습해본다.","keywords":["docker"],"articleBody":"0. Introduction 해당 강의는 러닝스푼즈 - 나노디그리 Python \u0026 Django backed course의 장철원 강사님의 docker 강의를 학습한 내용입니다.\n인스턴스는 우분투를 사용한다.\n1. PostgreSQL 컨테이너로 배포하기 DB 관리 db를 컨테이너에 띄어서 관리하는가, 아니면 쌩 서버에 관리하는가 는 호불호가 갈린다.\n왜냐하면 컨테이너의 기본이 지워져도 상관없다는 전제이기 때문에, db는 지워지면 안되기 때문에 컨테이너에 사용되지 않는다.\n컨테이너 내부 접속하기 컨테이너 내부로 들어가기: docker exec -it /bin/bash\n그래서 이 내부에서 명령어를 잘못 입력하면 컨테이너에서 나갔다가 Kill하면 된다. superuser로 로그인하기: psql -U postgres 를 의미한다.\n\\dt: 테이블 조회\npostgresql 종료 명령어: \\q\nDockerfile이란? 도커 이미지에 대한 정보를 기술한 템플릿 패키지, 명령어, 환경 변수 설정등을 기록 도커 파일을 통해 postgreSQL container 띄우기 PostgreSQL에 대한 Dockerfile을 담을 directory를 생성한다.\n해당 경로에 vim Dockerfile를 실행하여 FROM postgres를 입력한다.\n2. 도커 볼륨(docker volume) 도커 볼륨이란? 도커 컨테이너에 있는 데이터를 보관하기 위해서 사용하는 툴\n도커 볼륨을 사용하는 방식에는 2가지 방식이 있다.\nEC2 서버 내부의 file system 경로에 연결하는 것 volume에 연결하는 것 위 방식들을 사용하면 file system과 계속해서 연결되어 있기 때문에, DB가 꺼져도 file system까지 다 저장되어 있어서 데이터를 보존할 수 있다.\n도커에서는 볼륨을 생성하여 사용하기를 추천한다.\n2.1 로컬 경로로 연결 이 방식의 문제점 : 필요한 경로라 생각하여 사용자가 무심코 경로를 삭제할 수 있다. 연결할 호스트 경로 확인 docker run -e POSTGRES_PASSWORD=mysecretpassword -v ~/test:/test:rw -d postgres\n-v: volume을 의미\nlocal 상의 ~/work/test와 container 상의 ~/work/test를 연결\nrw: read와 write 권한을 주겠다는 걸 의미\n-d: background으로 작동한다는 걸 의미\ncontainer ls로 확인 후, 접속하기 docker container ls docker exec -it /bin/bash 접속하면 /test가 있는 걸 확인할 수 있다. 그러면 /test 경로로 이동한다(cd test). ls로 확인하면 postgresql에 접속하기 전과 동일하다는 걸 알 수 있다. 접속한 container에서 생성 후, docker host에서도 확인하기 mkdir inside 후, exit하여 나온다.\n동일한 경로로 이동하여 ls로 확인하면 inside directory가 있는 걸 알 수 있다.\n생성한 directory를 docker host에서 삭제한 후, container에 접속하여 확인하면 똑같이 삭제된 걸 확인할 수 있다.\n2.2 도커 볼륨으로 연결하기 생성 후, 내용 확인하기 첫 번째, 명령어 docker volume create \u003c볼륨명\u003e을 사용하여 볼륨을 ec2 내에서 생성한다.\n생성 후, 볼륨 목록을 확인하고 싶으면 docker volume ls를 입력한다.\n생성한 볼륨에 대한 정보를 확인하고 싶으면 docker volume inspect \u003c생성한 볼륨명\u003e을 입력한다.\n확인된 정보들에서 Mountpoint는 생성한 볼륨의 경로를 의미한다. docker host의 경로와 연결하기 docker run -e POSTGRES_PASSWORD=mysecretpassword -v myvolume:/var/lib/postgresql/data -d postgres\nmyvolume을 postgresql의 데이터 경로와 연결한다.\n❗️/var/lib/postgresql/data 는 내가 임의로 정하는 게 아닌 RDBMS마다 정해져있으므로 다른 것을 사용한다면 추가로 확인해야한다.\npostgresql 데이터 생성, 컨테이너 삭제 후 실행하여 데이터 확인하기 container 접속: docker exec -it postgresql 접속: psql -U postgres 사용자 추가: CREATE USER jeha PASSWORD '1234' SUPERUSER; \\du: 모든 사용자 보여주기 \\q: 나오기 container 중단: docker container stop container 삭제: docker container rm 다시 postgresql 실행하여 접속한다. \\du로 등록된 사용자가 아직 존재하는지 확인 후, exit 3. Docker로 django 배포하기 3.1 Django image pull 받고 확인하기 django image pull 받기: docker pull django django pull 한 image 확인: docker image ls 3.2 장고 컨테이너 가동 배포시스템 구조 이해하기 서버 포트와 컨테이너 포트 연결하기\n트래픽은 바로 들어오는 게 아닌, 서버를 거쳐서 컨테이너로 들어온다. 총 2단계가 필요하다.\n우리가 브라우저의 url 창에 도메인을 입력하고 나서 입력하는 포트 번호는 컨테이너의 포트 번호가 아니라 ‘서버의 포트 번호’를 말한다.\nPort 번호\n내가 사용하는 프레임워크는 django 이므로, port 번호는 8000을 사용하기로 한다. HTTP port는 80으로 정해져있다. www.naver.com 을 입력하는 것은 www.naver.com/:80 을 입력하는 것과 동일하다. 그래서 80 port를 지난 후, 8000 port로 오도록 연결해야 한다. 이를 설계하지 않으면 컨테이너를 띄어도 외부에서 접속할 수 없다.\n장고 컨테이너 가동하기 docker run -d -p 80:8000 django bash -c “pip install django \u0026\u0026 django-admin startproject \u0026\u0026 cd \u0026\u0026 python manage.py runserver 0.0.0.0:8000”\n-d: 도커 컨테이너의 백그라운드 실행\n-p 80:8000: 컨테이너 포트 설정 - 호스트 포트: 컨테이너 포트\n두 포트를 연결하겠다는 의미 bash: 컨테이너 실행 후, bash 실행\nbash에 \"\" 안 내용을 실행한다. bash를 사용해서 장고 프로젝트를 생성한다. \u0026\u0026: 연결지어 순차적으로 실행한다.\npython manage.py runserver 0.0.0.0:8000 에서 위에 -p 옵션으로 입력할 포트번호와 일치시켜야 한다.\n만약 해당 포트가 이미 사용 중이라고 한다면 ps -ef | grep 8000을 입력해서 8000번에 무엇이 사용되는지 알 수 있다.\n🔆 참고사항 만약 docker container ls를 입력했는데 아무것도 안뜨면 자세히 확인하기 위해서 docker container ls -a 를 입력하면 STATUS를 통해 확인하면 Exited를 확인할 수 있다. 그러면 아래 명령어를 사용하여 로그를 확인해보면 에러 원인을 보다 자세히 알 수 있으므로 활용하자.\n로그 확인: docker logs ❗️Error starting userland proxy Error starting userland proxy: listen tcp4 0.0.0.0:80: bind: address already in use.\nsudo netstat -nlptu | grep 80을 입력해보자. 만약 command not found가 뜬다면 apt-get install net-tools를 입력하여 설치 후, 다시 실행해보자.\n그러면 80 port를 누가 사용 중인지 확인할 수 있다.\n만약 그 포트를 사용하는게 nginx, apache라면 sudo systemctl stop nginx 또는 sudo systemctl stop apache 을 입력하여 중단하자.\n그후 다시 장고 컨테이너 가동하기 위한 명령어 docker run -d -p 80:8000 ...을 입력한다.\nnginx, apache가 아니라면서 sudo kill -9 를 입력한다.\n3.3 docker container 정지 및 재가동 정지: docker container stop 재가동\ndocker container ls -a로 정지했었던 container id를 확인 멈춰있는 도커를 재시작한다는 의미이므로, docker start 를 입력 4. 서버에 장고 코드 배포하기 4.1 AWS 외부 접속을 위한 포트 설정 해당 EC2의 인바운드 규칙 편집에 사용자 지정 TCP로 ‘8000’을 추가한다. 4.2 장고 프로젝트 생성 및 가동 root 계정으로 이동: sudo -i\nwork로 이동\npyenv는 아래 링크를 따라서 진행하여 설치 및 활성화한다.\npyenv를 통한 파이썬(python) 가상환경 구축 가상환경 실행: pyenv activate \u003c가상환경명\u003e\npyenv 말고, ec2에 설치된 게 있으면 그것으로 하면 된다. 프로젝트 명칭: django-admin startproject \u003c프로젝트 명\u003e\n4.3 장고 설정파일 수정 및 접속 확인 settings.py 에서 ALLOWED_HOSTS 를 ['*']로 수정한다. 이것의 의미는 모든 외부 접속을 허용한다는 의미다.\n수정할 때에만 vim을 사용하고, 그냥 볼 때는 cat를 사용한다.\npython manage.py runserver 0:8000 를 입력해야 ec2 ip 주소를 사용해서 :8000 로 접속할 수 있다.\n❗️ 발생한 Error _ModuleNotFoundError: No module named ‘_sqlite3’ _\nsqlite3는 파이썬 설치 시, 포함되는데 위와 같은 에러는 파이썬 설치가 제대로 안된 것이기 때문에,\npyenv install 을 입력하여 설치를 다시 한다.\n5. 직접 짠 코드 container로 배포하기 5.1 디렉토리 정리, tree 설치하여 파일 구조 확인하기 sudo apt-get install tree\n위 명령어 실행 후, tree ./로 원하는 경로의 directiory 구조를 tree로 확인한다.\n5.2 requirements.txt 파일 생성 이 파일 추가하는 이유는 나만의 도커 이미지를 만들기 위해 django 4.1.1 layer를 쌓기 위해서다.\n왜냐하면 도커는 여러 Layer가 쌓여진 것이기 때문이다.\nvim requirements.txt를 실행하여 생성한다.\ndjango==4.1.1를 추가한다. 5.3 Dockerfile 생성하기 Dockerfile 생성하기 위 장고 과정에서 직접 하나하나 설치하고 실행한 건 도커 개념을 이해하기 위해서다.\nrequirements.txt만 실행하면 바로 설치된다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 FROM python:3.10.4 WORKDIR /usr/src/app COPY . . RUN python -m pip install -upgrade pip RUN pip install -r requirements.txt WORKDIR ./practice CMD python manage.py runserver 0:8000 EXPOSE 8000 이 때 생성해야하는 Dockerfile 이름은 다음과 같다.\nDockerfile 주의사항: 첫 글자가 대문자이고, 확장자가 존재하지 않는다. FROM: 기본 layer를 무엇으로 할 것인가?\npython:3.10.4: 기본 Layer를 이것으로 한다. 첫 번째 WOKDIR: root부터 시작하는 container 내부 경로를 의미한다.\nCOPY . .: 모든 것을 컨테이너 안으로 가져오겠다는 의미다.\nRUN: 오른쪽에 입력한 명령어를 실행하겠다.\n두 번째 WORKDIR: 위에 RUN 명령어를 실행 후, 오른쪽에 입력한 경로로 이동한다.\nEXPOSE: 컨테이너에 포트 몇 번을 열지를 알려주는 것\nDockerfile 의 file level Dockerfile과 requirements.txt는 동일한 파일 level에 있어야 한다.\n5.4 image build 하기 docker build . -t \u003c만들 image 이름\u003e\nDockerfile이 있는 위치에서 실행한다.\n.은 위 명령어를 실행하는 경로 안에 있는 모든 걸 의미한다.\n-t: 태그를 의미\ndocker image ls를 입력하면 목록에 위에 입력한 image 이름으로 존재하는 걸 확인할 수 있다.\n❗️ 컨테이너는 운영체제가 아니기 때문에, root User 관련 경고는 문제가 아니다. ❗️ 만약 image를 빌드 후, Dockerfile을 수정하면 다시 image를 만들어야 한다.\n빌드한 이미지 실행하여 컨테이너 가동 docker run -d -p 80:8000 \u003c만든 image 이름\u003e\n위 명령어 실행 후, docker container ls를 입력하면 가동되고 있는 container를 확인할 수 있다.\n❗️ 위 명령어로 container id가 떴음에도 불구하고, docker container ls -a로 해당 container id의 status가 exited 이면 docker logs 로 원인을 파악한다.\n6. docker로 nginx 배포하기 django만으로는 traffic을 받을 수 없기 때문에, nginx를 설치해야한다.\n6.1 nginx 디렉토리 생성 mkdir nginxtest 생성\n6.2 Dockerfile 생성 위에 생성한 디렉토리로 이동 후, vim Dockerfile로 생성하여 아래 내용을 입력한다. ❗️ 입력 시, 홀따옴표가 아닌 쌍따옴표를 사용한다.\n1 2 FROM nginx CMD [\"nginx\", \"-g\", \"daemon off;\"] daemon off의 의미 nginx를 foreground로 돌리기 위함 container가 background로 실행되므로, nginx를 foreground로 돌리지 않으면 nginx가 exited된다. file level 6.3 image build 및 확인 image build Dockerfile이 있는 경로에서 아래 명령어를 실행한다.\ndocker build . -t nginx-test\nimage 확인 docker image ls를 실행하여 목록을 확인한다. 이 때 경로는 상관없다.\n6.4 nginx container 가동 container 가동 docker run -d nginx-test\n목록 확인 docker container ls\n7. Docker compose로 장고와 nginx 함께 배포하기 위 이미지처럼 컨테이너 두 개를 연결하려고 한다.\n서버 외부에서 80포트로 들어오면 nginx로 이동하면 django-test 8000 port로 이동되도록 한다. nginx: 서버 와 django: 웹 서버를 연결하기 위해서 gunicorn을 사용해볼 예정이다.\n이를 위해서 docker compose를 사용해보자.\n7.1 Docker compose 개념 \u0026 설치 Docker compose concept django과 nginx를 연결하는데, 많은 컨테이너를 하나 하나 직접 연결하는 건 매우 시간이 많이 걸린다.\n도커 파일은 ‘하나의 컨테이너’ 를 관리하기 위한 파일이다.\n하지만, 도커 컴포즈는 ‘여러 개의 컨테이너’를 관리하는 도커 애플리케이션이다.\n도커 컴포즈를 사용하기 위해서는 docker-compose.yml이라는 YAML 파일을 사용한다.\nYAML YAML은 마크업 언어가 아니다.\n기존 JSON의 불편함을 해소하기 위해 만들어진 언어\n주로 설정 파일(configuration file)에 사용\n확장자: *.yml\n7.2 Docker compose installation docs.docker.com - install the plugin manually를 보고 아래 명령어를 순차적으로 입력한다.\n1 2 3 4 5 6 7 mkdir -p ~/.docker/cli-plugins curl -SL https://github.com/docker/compose/releases/download/v2.14.0/docker-compose-linux-x86_64 -o ~/.docker/cli-plugins/docker-compose chmod +x ~/.docker/cli-plugins/docker-compose docker compose version ❗️ Error docker: ‘compose’ is not a docker command\ncurl -o 뒤에 경로와 mkdir의 경로가 일치한지 확인하기\n7.3 directory 정리 다음과 같이 경로를 수정한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 ./ ├── django │ ├── Devket │ │ ├── config │ │ │ ├── __init__.py │ │ │ ├── __pycache__ │ │ │ │ ├── __init__.cpython-310.pyc │ │ │ │ ├── settings.cpython-310.pyc │ │ │ │ ├── urls.cpython-310.pyc │ │ │ │ └── wsgi.cpython-310.pyc │ │ │ ├── asgi.py │ │ │ ├── settings.py │ │ │ ├── urls.py │ │ │ ├── wsgi.py │ │ │ └── ~ │ │ ├── db.sqlite3 │ │ └── manage.py │ ├── Dockerfile │ └── requirements.txt └── nginx └── Dockerfile 7.4 Dockerfile 수정 django directory 안에 있는 dockerfile 수정 첫 번째 CMD 뒤에 다른 CMD를 추가한다.\nCMD gunicorn config.wsgi:application --bind 0.0.0.0:8000\nnginx directory 안에 있는 dockerfile 수정 다음과 같이 수정한다.\n1 2 3 4 FROM nginx RUN rm /etc/nginx/conf.d/default.conf COPY default.conf /etc/nginx/conf.d CMD [\"nginx\", \"-g\", \"daemon off;\"] 기존 컨테이너에 있던 default.conf를 삭제하고, 새로운 default.conf를 기존에 있던 경로에 만들겠다는 의미다. 7.5 nginx에 default.conf 추가 1 2 3 4 5 6 7 8 server { listen 80; server_name localhost; location /{ proxy_pass http://:8000; } } listen 80 : 서버로부터 들어오는 것을 80 port로 받겠다는 의미 proxy_pass: 80 port로 들어온 것을 8000 port로 돌리겠다는 의미 7.6 docker-compose.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # docker-compose.yml이 있는 경로: ~/test version: \"3\" services: \u003c첫 번째 service name\u003e: build: ./ container_name: \u003c생성될 image name\u003e restart: always expose: - \"8000\" \u003c두 번째 service name\u003e: build: ./ container_name: \u003c생성될 image name\u003e restart: always ports: - \"80:80\" depends_on: - \u003c첫 번째 service name\u003e version: version에 따라 참고하는 규격이 달라진다. About versions and upgrading services 밑에 바로 오는 것은 여러 서비스 명칭들을 의미 expose: container 상에 몇 번 포트를 열지 지정 ports: 서버에서 들어와 바로 받기 때문에 입력해야 한다. depends_on: service 간 관계성을 지정하는 키워드로서, 실행 순서를 정하는 키워드로 depends_on에 있는 service를 실행한 후, 해당 service를 실행 생성될 image name은 현재 test 경로에서 실행되었기 때 문에, test-\u003c생성될 image name\u003e으로 image가 생성된다. 7.7 docker compose 실행 및 내리기 docker compose 명령어는 docker-compose.yml 파일이 있는 경로 및 그 아래 경로 어디서든 실행할 수 있다.\ndocker compose 실행하기: docker compose up -d --build docker compose 내리기: docker compose down 8. 도커로 장고, nginx, PostgreSQL 함께 배포하기 전체적인 서버 구성은 다음과 같다.\n그리고, 컨테이너의 관점에서 바라보면 전체적인 구성은 다음과 같다.\ngunicorn을 선택한 이유 gunicorn을 사용한 이유는 현재 과정에서는 빠른 속도가 불필요하기 때문이다. 빠른 속도와 빠른 성능이 필요하면 wsgi를 쓴다.\n8.1 file directory 구조 django, nginx, psql이 docker-compose.yml과 동일한 file level이어야 한다.\n그리고 django, nginx, psql에는 각 해당되는 Dockerfile이 존재해야한다.\ndjango에는 requirements.txt가, nginx에는 default.conf가 추가로 존재해야 한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 ./ ├── django │ ├── Devket │ │ ├── config │ │ │ ├── __init__.py │ │ │ ├── __pycache__ │ │ │ │ ├── __init__.cpython-310.pyc │ │ │ │ ├── settings.cpython-310.pyc │ │ │ │ ├── urls.cpython-310.pyc │ │ │ │ └── wsgi.cpython-310.pyc │ │ │ ├── asgi.py │ │ │ ├── settings.py │ │ │ ├── urls.py │ │ │ ├── wsgi.py │ │ │ └── ~ │ │ ├── db.sqlite3 │ │ └── manage.py │ ├── Dockerfile │ └── requirements.txt ├── docker-compose.yml ├── nginx │ ├── Dockerfile │ └── default.conf └── psql └── Dockerfile 8.2 docker-compose.yml 수정하기 DB 추가에 따른 docker-compose.yml은 다음 내용이 추가된다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 version: \"3\" services: ... psql: build: ./psql container_name: psql restart: always volumes: - myvolume:var/lib/postgresql/data environment: - POSTGRES_USER=postgres - POSTGRES_PASSWORD=postgres - POSTGRES_DB=postgres volumes: myvolume: psql-test에는 db이기 때문에 volume이 추가된 걸 알 수 있다. ❗️ 만약 용량 부족 error가 뜰 경우 docker system prune --volumes 명령어를 상용해보자.\n8.3 django settings.py의 DB 설정 변경하기 django application의 settings.py의 DATEBASES 환경 변수를 수정한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # before DATABASES = { 'default': { 'ENGINE': 'django.db.backends.sqlite3', 'NAME': BASE_DIR / 'db.sqlite3', } } # after DATABASES = { 'default': { 'ENGINE': 'django.db.backends.postgresql', 'NAME': 'postgres', 'USER': 'postgres', 'PASSWORD': 'postgres', 'HOST': 'db-test', 'PORT': 5432, } } 8.4 requirements 변경 후, compose 실행하기 requirements.txt에 psycopg2를 추가 compose 실행: docker compose up -d --build ❗️ Error 01 invalid mount config for type “volume”: invalid mount path: ‘var/lib/postgresql/data’ mount path must be absolute\n‘var/lib/postgresql/data’ 앞에 /가 없어서 생긴 문제다.\n❗️ Error 02 strconv.Atoi: parsing “”: invalid syntax\ndocker-compose.yml 또는 Dockerfile에 입력 형식이 잘못되었다는 의미다.\n❗️ 용량 부족으로 인한 Error image가 과도하게 많아서 에러가 발생할 경우, sudo docker system prune을 실행한다.\nReference 러닝스푼즈 - 나노디그리 Python \u0026 Django backed course ","wordCount":"2351","inLanguage":"en","datePublished":"2022-12-08T13:42:28+09:00","dateModified":"2022-12-08T13:42:28+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://jeha00.github.io/post/docker/04_deployment-by-docker/"},"publisher":{"@type":"Organization","name":"Jeha DevLog","logo":{"@type":"ImageObject","url":"http://jeha00.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://jeha00.github.io/ accesskey=h title="@Jeha00 (Alt + H)">@Jeha00</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://jeha00.github.io/me/ title=About><span>About</span></a></li><li><a href=http://jeha00.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=http://jeha00.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=http://jeha00.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://jeha00.github.io/>Home</a>&nbsp;»&nbsp;<a href=http://jeha00.github.io/post/>Posts</a></div><h1 class=post-title>Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기</h1><div class=post-meta>Docker&nbsp;·&nbsp;<span title='2022-12-08 13:42:28 +0900 KST'>December 8, 2022</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#0-introduction aria-label="0. Introduction">0. Introduction</a></li><li><a href=#1-postgresql-%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%eb%a1%9c-%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0 aria-label="1. PostgreSQL 컨테이너로 배포하기">1. PostgreSQL 컨테이너로 배포하기</a><ul><ul><li><a href=#db-%ea%b4%80%eb%a6%ac aria-label="DB 관리">DB 관리</a></li><li><a href=#%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88-%eb%82%b4%eb%b6%80-%ec%a0%91%ec%86%8d%ed%95%98%ea%b8%b0 aria-label="컨테이너 내부 접속하기">컨테이너 내부 접속하기</a></li><li><a href=#dockerfile%ec%9d%b4%eb%9e%80 aria-label=Dockerfile이란?>Dockerfile이란?</a></li><li><a href=#%eb%8f%84%ec%bb%a4-%ed%8c%8c%ec%9d%bc%ec%9d%84-%ed%86%b5%ed%95%b4-postgresql-container-%eb%9d%84%ec%9a%b0%ea%b8%b0 aria-label="도커 파일을 통해 postgreSQL container 띄우기">도커 파일을 통해 postgreSQL container 띄우기</a></li></ul></ul></li><li><a href=#2-%eb%8f%84%ec%bb%a4-%eb%b3%bc%eb%a5%a8docker-volume aria-label="2. 도커 볼륨(docker volume)">2. 도커 볼륨(docker volume)</a><ul><li><a href=#21-%eb%a1%9c%ec%bb%ac-%ea%b2%bd%eb%a1%9c%eb%a1%9c-%ec%97%b0%ea%b2%b0 aria-label="2.1 로컬 경로로 연결">2.1 로컬 경로로 연결</a><ul><li><a href=#%ec%97%b0%ea%b2%b0%ed%95%a0-%ed%98%b8%ec%8a%a4%ed%8a%b8-%ea%b2%bd%eb%a1%9c-%ed%99%95%ec%9d%b8 aria-label="연결할 호스트 경로 확인">연결할 호스트 경로 확인</a></li><li><a href=#container-ls%eb%a1%9c-%ed%99%95%ec%9d%b8-%ed%9b%84-%ec%a0%91%ec%86%8d%ed%95%98%ea%b8%b0 aria-label="container ls로 확인 후, 접속하기">container ls로 확인 후, 접속하기</a></li><li><a href=#%ec%a0%91%ec%86%8d%ed%95%9c-container%ec%97%90%ec%84%9c-%ec%83%9d%ec%84%b1-%ed%9b%84-docker-host%ec%97%90%ec%84%9c%eb%8f%84-%ed%99%95%ec%9d%b8%ed%95%98%ea%b8%b0 aria-label="접속한 container에서 생성 후, docker host에서도 확인하기">접속한 container에서 생성 후, docker host에서도 확인하기</a></li></ul></li><li><a href=#22-%eb%8f%84%ec%bb%a4-%eb%b3%bc%eb%a5%a8%ec%9c%bc%eb%a1%9c-%ec%97%b0%ea%b2%b0%ed%95%98%ea%b8%b0 aria-label="2.2 도커 볼륨으로 연결하기">2.2 도커 볼륨으로 연결하기</a><ul><li><a href=#%ec%83%9d%ec%84%b1-%ed%9b%84-%eb%82%b4%ec%9a%a9-%ed%99%95%ec%9d%b8%ed%95%98%ea%b8%b0 aria-label="생성 후, 내용 확인하기">생성 후, 내용 확인하기</a></li><li><a href=#docker-host%ec%9d%98-%ea%b2%bd%eb%a1%9c%ec%99%80-%ec%97%b0%ea%b2%b0%ed%95%98%ea%b8%b0 aria-label="docker host의 경로와 연결하기">docker host의 경로와 연결하기</a></li><li><a href=#postgresql-%eb%8d%b0%ec%9d%b4%ed%84%b0-%ec%83%9d%ec%84%b1-%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88-%ec%82%ad%ec%a0%9c-%ed%9b%84-%ec%8b%a4%ed%96%89%ed%95%98%ec%97%ac-%eb%8d%b0%ec%9d%b4%ed%84%b0-%ed%99%95%ec%9d%b8%ed%95%98%ea%b8%b0 aria-label="postgresql 데이터 생성, 컨테이너 삭제 후 실행하여 데이터 확인하기">postgresql 데이터 생성, 컨테이너 삭제 후 실행하여 데이터 확인하기</a></li></ul></li></ul></li><li><a href=#3-docker%eb%a1%9c-django-%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0 aria-label="3. Docker로 django 배포하기">3. Docker로 django 배포하기</a><ul><li><a href=#31-django-image-pull-%eb%b0%9b%ea%b3%a0-%ed%99%95%ec%9d%b8%ed%95%98%ea%b8%b0 aria-label="3.1 Django image pull 받고 확인하기">3.1 Django image pull 받고 확인하기</a></li><li><a href=#32-%ec%9e%a5%ea%b3%a0-%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88-%ea%b0%80%eb%8f%99 aria-label="3.2 장고 컨테이너 가동">3.2 장고 컨테이너 가동</a><ul><li><a href=#%eb%b0%b0%ed%8f%ac%ec%8b%9c%ec%8a%a4%ed%85%9c-%ea%b5%ac%ec%a1%b0-%ec%9d%b4%ed%95%b4%ed%95%98%ea%b8%b0 aria-label="배포시스템 구조 이해하기">배포시스템 구조 이해하기</a></li><li><a href=#%ec%9e%a5%ea%b3%a0-%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88-%ea%b0%80%eb%8f%99%ed%95%98%ea%b8%b0 aria-label="장고 컨테이너 가동하기">장고 컨테이너 가동하기</a></li><li><a href=#-%ec%b0%b8%ea%b3%a0%ec%82%ac%ed%95%ad aria-label="🔆 참고사항">🔆 참고사항</a></li><li><a href=#error-starting-userland-proxy aria-label="❗️Error starting userland proxy">❗️Error starting userland proxy</a></li><li><a href=#33-docker-container-%ec%a0%95%ec%a7%80-%eb%b0%8f-%ec%9e%ac%ea%b0%80%eb%8f%99 aria-label="3.3 docker container 정지 및 재가동">3.3 docker container 정지 및 재가동</a></li></ul></li></ul></li><li><a href=#4-%ec%84%9c%eb%b2%84%ec%97%90-%ec%9e%a5%ea%b3%a0-%ec%bd%94%eb%93%9c-%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0 aria-label="4. 서버에 장고 코드 배포하기">4. 서버에 장고 코드 배포하기</a><ul><ul><li><a href=#41-aws-%ec%99%b8%eb%b6%80-%ec%a0%91%ec%86%8d%ec%9d%84-%ec%9c%84%ed%95%9c-%ed%8f%ac%ed%8a%b8-%ec%84%a4%ec%a0%95 aria-label="4.1 AWS 외부 접속을 위한 포트 설정">4.1 AWS 외부 접속을 위한 포트 설정</a></li><li><a href=#42-%ec%9e%a5%ea%b3%a0-%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-%ec%83%9d%ec%84%b1-%eb%b0%8f-%ea%b0%80%eb%8f%99 aria-label="4.2 장고 프로젝트 생성 및 가동">4.2 장고 프로젝트 생성 및 가동</a></li><li><a href=#43-%ec%9e%a5%ea%b3%a0-%ec%84%a4%ec%a0%95%ed%8c%8c%ec%9d%bc-%ec%88%98%ec%a0%95-%eb%b0%8f-%ec%a0%91%ec%86%8d-%ed%99%95%ec%9d%b8 aria-label="4.3 장고 설정파일 수정 및 접속 확인">4.3 장고 설정파일 수정 및 접속 확인</a></li></ul><li><a href=#-%eb%b0%9c%ec%83%9d%ed%95%9c-error aria-label="❗️ 발생한 Error">❗️ 발생한 Error</a></li></ul></li><li><a href=#5-%ec%a7%81%ec%a0%91-%ec%a7%a0-%ec%bd%94%eb%93%9c-container%eb%a1%9c-%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0 aria-label="5. 직접 짠 코드 container로 배포하기">5. 직접 짠 코드 container로 배포하기</a><ul><li><a href=#51-%eb%94%94%eb%a0%89%ed%86%a0%eb%a6%ac-%ec%a0%95%eb%a6%ac-tree-%ec%84%a4%ec%b9%98%ed%95%98%ec%97%ac-%ed%8c%8c%ec%9d%bc-%ea%b5%ac%ec%a1%b0-%ed%99%95%ec%9d%b8%ed%95%98%ea%b8%b0 aria-label="5.1 디렉토리 정리, tree 설치하여 파일 구조 확인하기">5.1 디렉토리 정리, tree 설치하여 파일 구조 확인하기</a></li><li><a href=#52-requirementstxt-%ed%8c%8c%ec%9d%bc-%ec%83%9d%ec%84%b1 aria-label="5.2 requirements.txt 파일 생성">5.2 requirements.txt 파일 생성</a></li><li><a href=#53-dockerfile-%ec%83%9d%ec%84%b1%ed%95%98%ea%b8%b0 aria-label="5.3 Dockerfile 생성하기">5.3 Dockerfile 생성하기</a><ul><li><a href=#dockerfile-%ec%83%9d%ec%84%b1%ed%95%98%ea%b8%b0 aria-label="Dockerfile 생성하기">Dockerfile 생성하기</a></li><li><a href=#dockerfile-%ec%9d%98-file-level aria-label="Dockerfile 의 file level">Dockerfile 의 file level</a></li></ul></li><li><a href=#54-image-build-%ed%95%98%ea%b8%b0 aria-label="5.4 image build 하기">5.4 image build 하기</a><ul><li><a href=#%eb%b9%8c%eb%93%9c%ed%95%9c-%ec%9d%b4%eb%af%b8%ec%a7%80-%ec%8b%a4%ed%96%89%ed%95%98%ec%97%ac-%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88-%ea%b0%80%eb%8f%99 aria-label="빌드한 이미지 실행하여 컨테이너 가동">빌드한 이미지 실행하여 컨테이너 가동</a></li></ul></li></ul></li><li><a href=#6-docker%eb%a1%9c-nginx-%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0 aria-label="6. docker로 nginx 배포하기">6. docker로 nginx 배포하기</a><ul><li><a href=#61-nginx-%eb%94%94%eb%a0%89%ed%86%a0%eb%a6%ac-%ec%83%9d%ec%84%b1 aria-label="6.1 nginx 디렉토리 생성">6.1 nginx 디렉토리 생성</a></li><li><a href=#62-dockerfile-%ec%83%9d%ec%84%b1 aria-label="6.2 Dockerfile 생성">6.2 Dockerfile 생성</a><ul><li><a href=#file-level aria-label="file level">file level</a></li></ul></li><li><a href=#63-image-build-%eb%b0%8f-%ed%99%95%ec%9d%b8 aria-label="6.3 image build 및 확인">6.3 image build 및 확인</a><ul><li><a href=#image-build aria-label="image build">image build</a></li><li><a href=#image-%ed%99%95%ec%9d%b8 aria-label="image 확인">image 확인</a></li></ul></li><li><a href=#64-nginx-container-%ea%b0%80%eb%8f%99 aria-label="6.4 nginx container 가동">6.4 nginx container 가동</a><ul><li><a href=#container-%ea%b0%80%eb%8f%99 aria-label="container 가동">container 가동</a></li><li><a href=#%eb%aa%a9%eb%a1%9d-%ed%99%95%ec%9d%b8 aria-label="목록 확인">목록 확인</a></li></ul></li></ul></li><li><a href=#7-docker-compose%eb%a1%9c-%ec%9e%a5%ea%b3%a0%ec%99%80-nginx-%ed%95%a8%ea%bb%98-%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0 aria-label="7. Docker compose로 장고와 nginx 함께 배포하기">7. Docker compose로 장고와 nginx 함께 배포하기</a><ul><li><a href=#71-docker-compose-%ea%b0%9c%eb%85%90--%ec%84%a4%ec%b9%98 aria-label="7.1 Docker compose 개념 &amp;amp; 설치">7.1 Docker compose 개념 & 설치</a><ul><li><a href=#docker-compose-concept aria-label="Docker compose concept">Docker compose concept</a></li><li><a href=#yaml aria-label=YAML>YAML</a></li></ul></li><li><a href=#72-docker-compose-installation aria-label="7.2 Docker compose installation">7.2 Docker compose installation</a><ul><li><a href=#-error aria-label="❗️ Error">❗️ Error</a></li></ul></li><li><a href=#73-directory-%ec%a0%95%eb%a6%ac aria-label="7.3 directory 정리">7.3 directory 정리</a></li><li><a href=#74-dockerfile-%ec%88%98%ec%a0%95 aria-label="7.4 Dockerfile 수정">7.4 Dockerfile 수정</a><ul><li><a href=#django-directory-%ec%95%88%ec%97%90-%ec%9e%88%eb%8a%94-dockerfile-%ec%88%98%ec%a0%95 aria-label="django directory 안에 있는 dockerfile 수정">django directory 안에 있는 dockerfile 수정</a></li><li><a href=#nginx-directory-%ec%95%88%ec%97%90-%ec%9e%88%eb%8a%94-dockerfile-%ec%88%98%ec%a0%95 aria-label="nginx directory 안에 있는 dockerfile 수정">nginx directory 안에 있는 dockerfile 수정</a></li></ul></li><li><a href=#75-nginx%ec%97%90-defaultconf-%ec%b6%94%ea%b0%80 aria-label="7.5 nginx에 default.conf 추가">7.5 nginx에 default.conf 추가</a></li><li><a href=#76-docker-composeyml aria-label="7.6 docker-compose.yml">7.6 docker-compose.yml</a></li><li><a href=#77-docker-compose-%ec%8b%a4%ed%96%89-%eb%b0%8f-%eb%82%b4%eb%a6%ac%ea%b8%b0 aria-label="7.7 docker compose 실행 및 내리기">7.7 docker compose 실행 및 내리기</a></li></ul></li><li><a href=#8-%eb%8f%84%ec%bb%a4%eb%a1%9c-%ec%9e%a5%ea%b3%a0-nginx-postgresql-%ed%95%a8%ea%bb%98-%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0 aria-label="8. 도커로 장고, nginx, PostgreSQL 함께 배포하기">8. 도커로 장고, nginx, PostgreSQL 함께 배포하기</a><ul><ul><li><a href=#gunicorn%ec%9d%84-%ec%84%a0%ed%83%9d%ed%95%9c-%ec%9d%b4%ec%9c%a0 aria-label="gunicorn을 선택한 이유">gunicorn을 선택한 이유</a></li></ul><li><a href=#81-file-directory-%ea%b5%ac%ec%a1%b0 aria-label="8.1 file directory 구조">8.1 file directory 구조</a></li><li><a href=#82-docker-composeyml-%ec%88%98%ec%a0%95%ed%95%98%ea%b8%b0 aria-label="8.2 docker-compose.yml 수정하기">8.2 docker-compose.yml 수정하기</a></li><li><a href=#83-django-settingspy%ec%9d%98-db-%ec%84%a4%ec%a0%95-%eb%b3%80%ea%b2%bd%ed%95%98%ea%b8%b0 aria-label="8.3 django settings.py의 DB 설정 변경하기">8.3 django settings.py의 DB 설정 변경하기</a></li><li><a href=#84-requirements-%eb%b3%80%ea%b2%bd-%ed%9b%84-compose-%ec%8b%a4%ed%96%89%ed%95%98%ea%b8%b0 aria-label="8.4 requirements 변경 후, compose 실행하기">8.4 requirements 변경 후, compose 실행하기</a><ul><li><a href=#-error-01 aria-label="❗️ Error 01">❗️ Error 01</a></li><li><a href=#-error-02 aria-label="❗️ Error 02">❗️ Error 02</a></li><li><a href=#-%ec%9a%a9%eb%9f%89-%eb%b6%80%ec%a1%b1%ec%9c%bc%eb%a1%9c-%ec%9d%b8%ed%95%9c-error aria-label="❗️ 용량 부족으로 인한 Error">❗️ 용량 부족으로 인한 Error</a></li></ul></li></ul></li><li><a href=#reference aria-label=Reference>Reference</a></li></ul></div></details></div><div class=post-content><h1 id=0-introduction>0. Introduction<a hidden class=anchor aria-hidden=true href=#0-introduction>#</a></h1><ul><li><p>해당 강의는 <a href=https://learningspoons.com/course/detail/django-backend/>러닝스푼즈 - 나노디그리 Python & Django backed course</a>의 장철원 강사님의 docker 강의를 학습한 내용입니다.</p></li><li><p>인스턴스는 우분투를 사용한다.</p></li></ul><p> </p><hr><h1 id=1-postgresql-컨테이너로-배포하기>1. PostgreSQL 컨테이너로 배포하기<a hidden class=anchor aria-hidden=true href=#1-postgresql-컨테이너로-배포하기>#</a></h1><h3 id=db-관리>DB 관리<a hidden class=anchor aria-hidden=true href=#db-관리>#</a></h3><p>db를 컨테이너에 띄어서 관리하는가, 아니면 쌩 서버에 관리하는가 는 호불호가 갈린다.</p><p>왜냐하면 컨테이너의 기본이 지워져도 상관없다는 전제이기 때문에, db는 지워지면 안되기 때문에 컨테이너에 사용되지 않는다.</p><h3 id=컨테이너-내부-접속하기>컨테이너 내부 접속하기<a hidden class=anchor aria-hidden=true href=#컨테이너-내부-접속하기>#</a></h3><p>컨테이너 내부로 들어가기: <code>docker exec -it &lt;Container ID> /bin/bash</code></p><ul><li>그래서 이 내부에서 명령어를 잘못 입력하면 컨테이너에서 나갔다가 Kill하면 된다.</li></ul><p>superuser로 로그인하기: <code>psql -U postgres</code> 를 의미한다.</p><ul><li><p><code>\dt</code>: 테이블 조회</p></li><li><p>postgresql 종료 명령어: <code>\q</code></p></li></ul><h3 id=dockerfile이란>Dockerfile이란?<a hidden class=anchor aria-hidden=true href=#dockerfile이란>#</a></h3><ul><li>도커 이미지에 대한 정보를 기술한 템플릿</li><li>패키지, 명령어, 환경 변수 설정등을 기록</li></ul><h3 id=도커-파일을-통해-postgresql-container-띄우기>도커 파일을 통해 postgreSQL container 띄우기<a hidden class=anchor aria-hidden=true href=#도커-파일을-통해-postgresql-container-띄우기>#</a></h3><p>PostgreSQL에 대한 Dockerfile을 담을 directory를 생성한다.</p><p>해당 경로에 <code>vim Dockerfile</code>를 실행하여 <code>FROM postgres</code>를 입력한다.</p><p> </p><hr><h1 id=2-도커-볼륨docker-volume>2. 도커 볼륨(docker volume)<a hidden class=anchor aria-hidden=true href=#2-도커-볼륨docker-volume>#</a></h1><blockquote><p><strong><em>도커 볼륨이란? 도커 컨테이너에 있는 데이터를 보관하기 위해서 사용하는 툴</em></strong></p></blockquote><p>도커 볼륨을 사용하는 방식에는 2가지 방식이 있다.</p><ul><li>EC2 서버 내부의 file system 경로에 연결하는 것</li><li>volume에 연결하는 것</li></ul><p>위 방식들을 사용하면 file system과 계속해서 연결되어 있기 때문에, DB가 꺼져도 file system까지 다 저장되어 있어서 데이터를 보존할 수 있다.</p><p>도커에서는 볼륨을 생성하여 사용하기를 추천한다.</p><h2 id=21-로컬-경로로-연결>2.1 로컬 경로로 연결<a hidden class=anchor aria-hidden=true href=#21-로컬-경로로-연결>#</a></h2><p><img loading=lazy src=https://user-images.githubusercontent.com/78094972/206185981-93ac908c-1cae-4e9d-ba82-898ee0cb11b0.png alt=image></p><ul><li><strong>이 방식의 문제점</strong> : 필요한 경로라 생각하여 사용자가 무심코 경로를 삭제할 수 있다.</li></ul><h3 id=연결할-호스트-경로-확인>연결할 호스트 경로 확인<a hidden class=anchor aria-hidden=true href=#연결할-호스트-경로-확인>#</a></h3><blockquote><p>docker run -e POSTGRES_PASSWORD=mysecretpassword -v ~/test:/test:rw -d postgres</p></blockquote><ul><li><p><code>-v</code>: volume을 의미</p></li><li><p>local 상의 <code>~/work/test</code>와 container 상의 <code>~/work/test</code>를 연결</p></li><li><p><code>rw</code>: read와 write 권한을 주겠다는 걸 의미</p></li><li><p><code>-d</code>: background으로 작동한다는 걸 의미</p></li></ul><h3 id=container-ls로-확인-후-접속하기>container ls로 확인 후, 접속하기<a hidden class=anchor aria-hidden=true href=#container-ls로-확인-후-접속하기>#</a></h3><ul><li><code>docker container ls</code></li><li><code>docker exec -it &lt;container id> /bin/bash</code></li><li>접속하면 <code>/test</code>가 있는 걸 확인할 수 있다. 그러면 /test 경로로 이동한다(<code>cd test</code>).</li><li><code>ls</code>로 확인하면 postgresql에 접속하기 전과 동일하다는 걸 알 수 있다.</li></ul><h3 id=접속한-container에서-생성-후-docker-host에서도-확인하기>접속한 container에서 생성 후, docker host에서도 확인하기<a hidden class=anchor aria-hidden=true href=#접속한-container에서-생성-후-docker-host에서도-확인하기>#</a></h3><ul><li><p><code>mkdir inside</code> 후, exit하여 나온다.</p></li><li><p>동일한 경로로 이동하여 <code>ls</code>로 확인하면 <code>inside</code> directory가 있는 걸 알 수 있다.</p></li><li><p>생성한 directory를 docker host에서 삭제한 후, container에 접속하여 확인하면 똑같이 삭제된 걸 확인할 수 있다.</p></li></ul><h2 id=22-도커-볼륨으로-연결하기>2.2 도커 볼륨으로 연결하기<a hidden class=anchor aria-hidden=true href=#22-도커-볼륨으로-연결하기>#</a></h2><p><img loading=lazy src=https://user-images.githubusercontent.com/78094972/206185086-a0071191-96ea-4b05-a7a6-0b9f740107a9.png alt=image></p><h3 id=생성-후-내용-확인하기>생성 후, 내용 확인하기<a hidden class=anchor aria-hidden=true href=#생성-후-내용-확인하기>#</a></h3><p>첫 번째, 명령어 <code>docker volume create &lt;볼륨명></code>을 사용하여 볼륨을 ec2 내에서 생성한다.</p><p>생성 후, 볼륨 목록을 확인하고 싶으면 <code>docker volume ls</code>를 입력한다.</p><p>생성한 볼륨에 대한 정보를 확인하고 싶으면 <code>docker volume inspect &lt;생성한 볼륨명></code>을 입력한다.</p><ul><li>확인된 정보들에서 <code>Mountpoint</code>는 생성한 볼륨의 경로를 의미한다.</li></ul><h3 id=docker-host의-경로와-연결하기>docker host의 경로와 연결하기<a hidden class=anchor aria-hidden=true href=#docker-host의-경로와-연결하기>#</a></h3><blockquote><p><strong><em>docker run -e POSTGRES_PASSWORD=mysecretpassword -v myvolume:/var/lib/postgresql/data -d postgres</em></strong></p></blockquote><p>myvolume을 postgresql의 데이터 경로와 연결한다.</p><p>❗️/var/lib/postgresql/data 는 내가 임의로 정하는 게 아닌 RDBMS마다 정해져있으므로 다른 것을 사용한다면 추가로 확인해야한다.</p><h3 id=postgresql-데이터-생성-컨테이너-삭제-후-실행하여-데이터-확인하기>postgresql 데이터 생성, 컨테이너 삭제 후 실행하여 데이터 확인하기<a hidden class=anchor aria-hidden=true href=#postgresql-데이터-생성-컨테이너-삭제-후-실행하여-데이터-확인하기>#</a></h3><ol><li>container 접속: <code>docker exec -it &lt;postgresql에 해당되는 container id></code></li><li>postgresql 접속: <code>psql -U postgres</code></li><li>사용자 추가: <code>CREATE USER jeha PASSWORD '1234' SUPERUSER;</code></li><li><code>\du</code>: 모든 사용자 보여주기</li><li><code>\q</code>: 나오기</li><li>container 중단: <code>docker container stop &lt;container id></code></li><li>container 삭제: <code>docker container rm &lt;container id></code></li><li>다시 postgresql 실행하여 접속한다.</li><li><code>\du</code>로 등록된 사용자가 아직 존재하는지 확인 후, exit</li></ol><p> </p><hr><h1 id=3-docker로-django-배포하기>3. Docker로 django 배포하기<a hidden class=anchor aria-hidden=true href=#3-docker로-django-배포하기>#</a></h1><h2 id=31-django-image-pull-받고-확인하기>3.1 Django image pull 받고 확인하기<a hidden class=anchor aria-hidden=true href=#31-django-image-pull-받고-확인하기>#</a></h2><ul><li>django image pull 받기: <code>docker pull django</code></li><li>django pull 한 image 확인: <code>docker image ls</code></li></ul><h2 id=32-장고-컨테이너-가동>3.2 장고 컨테이너 가동<a hidden class=anchor aria-hidden=true href=#32-장고-컨테이너-가동>#</a></h2><h3 id=배포시스템-구조-이해하기>배포시스템 구조 이해하기<a hidden class=anchor aria-hidden=true href=#배포시스템-구조-이해하기>#</a></h3><blockquote><p><strong><em>서버 포트와 컨테이너 포트 연결하기</em></strong></p></blockquote><ul><li><p>트래픽은 바로 들어오는 게 아닌, 서버를 거쳐서 컨테이너로 들어온다. 총 2단계가 필요하다.</p></li><li><p>우리가 브라우저의 url 창에 도메인을 입력하고 나서 입력하는 포트 번호는 컨테이너의 포트 번호가 아니라 &lsquo;서버의 포트 번호&rsquo;를 말한다.</p></li><li><p>Port 번호</p><ul><li>내가 사용하는 프레임워크는 django 이므로, port 번호는 8000을 사용하기로 한다.</li><li>HTTP port는 80으로 정해져있다.</li><li><code>www.naver.com</code> 을 입력하는 것은 <code>www.naver.com/:80</code> 을 입력하는 것과 동일하다.</li></ul></li><li><p>그래서 80 port를 지난 후, 8000 port로 오도록 연결해야 한다. 이를 설계하지 않으면 컨테이너를 띄어도 외부에서 접속할 수 없다.</p></li></ul><h3 id=장고-컨테이너-가동하기>장고 컨테이너 가동하기<a hidden class=anchor aria-hidden=true href=#장고-컨테이너-가동하기>#</a></h3><blockquote><p>docker run -d -p 80:8000 django bash -c &ldquo;pip install django && django-admin startproject && cd && python manage.py runserver 0.0.0.0:8000&rdquo;</p></blockquote><ul><li><p><code>-d</code>: 도커 컨테이너의 백그라운드 실행</p></li><li><p><code>-p 80:8000</code>: 컨테이너 포트 설정 - 호스트 포트: 컨테이너 포트</p><ul><li>두 포트를 연결하겠다는 의미</li></ul></li><li><p><code>bash</code>: 컨테이너 실행 후, bash 실행</p><ul><li>bash에 "" 안 내용을 실행한다.</li><li>bash를 사용해서 장고 프로젝트를 생성한다.</li></ul></li><li><p><code>&&</code>: 연결지어 순차적으로 실행한다.</p></li><li><p><code>python manage.py runserver 0.0.0.0:8000</code> 에서 위에 <code>-p</code> 옵션으로 입력할 포트번호와 일치시켜야 한다.</p></li><li><p>만약 해당 포트가 이미 사용 중이라고 한다면 <code>ps -ef | grep 8000</code>을 입력해서 8000번에 무엇이 사용되는지 알 수 있다.</p></li></ul><h3 id=-참고사항>🔆 참고사항<a hidden class=anchor aria-hidden=true href=#-참고사항>#</a></h3><p>만약 <code>docker container ls</code>를 입력했는데 아무것도 안뜨면 자세히 확인하기 위해서 <code>docker container ls -a</code> 를 입력하면 STATUS를 통해 확인하면 <code>Exited</code>를 확인할 수 있다. 그러면 아래 명령어를 사용하여 로그를 확인해보면 에러 원인을 보다 자세히 알 수 있으므로 활용하자.</p><ul><li>로그 확인: <code>docker logs &lt;container ID></code></li></ul><h3 id=error-starting-userland-proxy>❗️Error starting userland proxy<a hidden class=anchor aria-hidden=true href=#error-starting-userland-proxy>#</a></h3><p>Error starting userland proxy: listen tcp4 0.0.0.0:80: bind: address already in use.</p><p><code>sudo netstat -nlptu | grep 80</code>을 입력해보자. 만약 <code>command not found</code>가 뜬다면 <code>apt-get install net-tools</code>를 입력하여 설치 후, 다시 실행해보자.</p><p>그러면 80 port를 누가 사용 중인지 확인할 수 있다.</p><p>만약 그 포트를 사용하는게 nginx, apache라면 <code>sudo systemctl stop nginx</code> 또는 <code>sudo systemctl stop apache</code> 을 입력하여 중단하자.</p><p>그후 다시 장고 컨테이너 가동하기 위한 명령어 <code>docker run -d -p 80:8000 ...</code>을 입력한다.</p><p>nginx, apache가 아니라면서 <code>sudo kill -9 &lt;PID></code> 를 입력한다.</p><h3 id=33-docker-container-정지-및-재가동>3.3 docker container 정지 및 재가동<a hidden class=anchor aria-hidden=true href=#33-docker-container-정지-및-재가동>#</a></h3><ul><li><p>정지: <code>docker container stop &lt;container ID></code></p></li><li><p>재가동</p><ul><li><code>docker container ls -a</code>로 정지했었던 container id를 확인</li><li>멈춰있는 도커를 재시작한다는 의미이므로, <code>docker start &lt;container id></code>를 입력</li></ul></li></ul><p> </p><hr><h1 id=4-서버에-장고-코드-배포하기>4. 서버에 장고 코드 배포하기<a hidden class=anchor aria-hidden=true href=#4-서버에-장고-코드-배포하기>#</a></h1><h3 id=41-aws-외부-접속을-위한-포트-설정>4.1 AWS 외부 접속을 위한 포트 설정<a hidden class=anchor aria-hidden=true href=#41-aws-외부-접속을-위한-포트-설정>#</a></h3><ul><li>해당 EC2의 인바운드 규칙 편집에 사용자 지정 TCP로 &lsquo;8000&rsquo;을 추가한다.</li></ul><h3 id=42-장고-프로젝트-생성-및-가동>4.2 장고 프로젝트 생성 및 가동<a hidden class=anchor aria-hidden=true href=#42-장고-프로젝트-생성-및-가동>#</a></h3><ul><li><p>root 계정으로 이동: <code>sudo -i</code></p></li><li><p><code>work</code>로 이동</p></li><li><p><code>pyenv</code>는 아래 링크를 따라서 진행하여 설치 및 활성화한다.</p><ul><li><a href=https://losskatsu.github.io/programming/pyenv/#5-%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EA%B0%80%EC%83%81%ED%99%98%EA%B2%BD-%EC%84%A4%EC%B9%98>pyenv를 통한 파이썬(python) 가상환경 구축</a></li></ul></li><li><p>가상환경 실행: <code>pyenv activate &lt;가상환경명></code></p><ul><li>pyenv 말고, ec2에 설치된 게 있으면 그것으로 하면 된다.</li></ul></li><li><p>프로젝트 명칭: <code>django-admin startproject &lt;프로젝트 명></code></p></li></ul><h3 id=43-장고-설정파일-수정-및-접속-확인>4.3 장고 설정파일 수정 및 접속 확인<a hidden class=anchor aria-hidden=true href=#43-장고-설정파일-수정-및-접속-확인>#</a></h3><ul><li><p>settings.py 에서 ALLOWED_HOSTS 를 <code>['*']</code>로 수정한다. 이것의 의미는 모든 외부 접속을 허용한다는 의미다.</p></li><li><p>수정할 때에만 <code>vim</code>을 사용하고, 그냥 볼 때는 <code>cat</code>를 사용한다.</p></li><li><p><code>python manage.py runserver 0:8000</code> 를 입력해야 ec2 ip 주소를 사용해서 <code>&lt;IP v4>:8000</code> 로 접속할 수 있다.</p></li></ul><h2 id=-발생한-error>❗️ 발생한 Error<a hidden class=anchor aria-hidden=true href=#-발생한-error>#</a></h2><blockquote><p><strong>_ModuleNotFoundError: No module named &lsquo;_sqlite3&rsquo; _</strong></p></blockquote><p>sqlite3는 파이썬 설치 시, 포함되는데 위와 같은 에러는 파이썬 설치가 제대로 안된 것이기 때문에,</p><p><code>pyenv install &lt;python version></code>을 입력하여 설치를 다시 한다.</p><p> </p><hr><h1 id=5-직접-짠-코드-container로-배포하기>5. 직접 짠 코드 container로 배포하기<a hidden class=anchor aria-hidden=true href=#5-직접-짠-코드-container로-배포하기>#</a></h1><h2 id=51-디렉토리-정리-tree-설치하여-파일-구조-확인하기>5.1 디렉토리 정리, tree 설치하여 파일 구조 확인하기<a hidden class=anchor aria-hidden=true href=#51-디렉토리-정리-tree-설치하여-파일-구조-확인하기>#</a></h2><blockquote><p><strong><em>sudo apt-get install tree</em></strong></p></blockquote><p>위 명령어 실행 후, <code>tree ./</code>로 원하는 경로의 directiory 구조를 tree로 확인한다.</p><h2 id=52-requirementstxt-파일-생성>5.2 requirements.txt 파일 생성<a hidden class=anchor aria-hidden=true href=#52-requirementstxt-파일-생성>#</a></h2><ul><li><p>이 파일 추가하는 이유는 나만의 도커 이미지를 만들기 위해 django 4.1.1 layer를 쌓기 위해서다.</p></li><li><p>왜냐하면 도커는 여러 Layer가 쌓여진 것이기 때문이다.</p></li><li><p><code>vim requirements.txt</code>를 실행하여 생성한다.</p><ul><li><code>django==4.1.1</code>를 추가한다.</li></ul></li></ul><h2 id=53-dockerfile-생성하기>5.3 Dockerfile 생성하기<a hidden class=anchor aria-hidden=true href=#53-dockerfile-생성하기>#</a></h2><h3 id=dockerfile-생성하기>Dockerfile 생성하기<a hidden class=anchor aria-hidden=true href=#dockerfile-생성하기>#</a></h3><ul><li><p>위 장고 과정에서 직접 하나하나 설치하고 실행한 건 도커 개념을 이해하기 위해서다.</p></li><li><p>requirements.txt만 실행하면 바로 설치된다.</p></li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>FROM python:3.10.4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WORKDIR /usr/src/app
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>COPY . . 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RUN python -m pip install -upgrade pip
</span></span><span style=display:flex><span>RUN pip install -r requirements.txt 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WORKDIR ./practice
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CMD python manage.py runserver 0:8000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>EXPOSE 8000
</span></span></code></pre></td></tr></table></div></div><ul><li><p>이 때 생성해야하는 Dockerfile 이름은 다음과 같다.</p><ul><li><code>Dockerfile</code></li><li>주의사항: 첫 글자가 대문자이고, 확장자가 존재하지 않는다.</li></ul></li><li><p><code>FROM</code>: 기본 layer를 무엇으로 할 것인가?</p><ul><li><code>python:3.10.4</code>: 기본 Layer를 이것으로 한다.</li></ul></li><li><p>첫 번째 <code>WOKDIR</code>: root부터 시작하는 container 내부 경로를 의미한다.</p></li><li><p><code>COPY . .</code>: 모든 것을 컨테이너 안으로 가져오겠다는 의미다.</p></li><li><p><code>RUN</code>: 오른쪽에 입력한 명령어를 실행하겠다.</p></li><li><p>두 번째 <code>WORKDIR</code>: 위에 RUN 명령어를 실행 후, 오른쪽에 입력한 경로로 이동한다.</p></li><li><p><code>EXPOSE</code>: 컨테이너에 포트 몇 번을 열지를 알려주는 것</p></li></ul><h3 id=dockerfile-의-file-level>Dockerfile 의 file level<a hidden class=anchor aria-hidden=true href=#dockerfile-의-file-level>#</a></h3><p>Dockerfile과 requirements.txt는 동일한 파일 level에 있어야 한다.</p><p><img loading=lazy src=https://user-images.githubusercontent.com/78094972/205901668-9b0a42b2-a803-4037-9d54-cbd8be15ac37.png alt=image></p><h2 id=54-image-build-하기>5.4 image build 하기<a hidden class=anchor aria-hidden=true href=#54-image-build-하기>#</a></h2><p><code>docker build . -t &lt;만들 image 이름></code></p><p>Dockerfile이 있는 위치에서 실행한다.</p><ul><li><p><code>.</code>은 위 명령어를 실행하는 경로 안에 있는 모든 걸 의미한다.</p></li><li><p><code>-t</code>: 태그를 의미</p></li><li><p><code>docker image ls</code>를 입력하면 목록에 위에 입력한 image 이름으로 존재하는 걸 확인할 수 있다.</p></li></ul><p>❗️ 컨테이너는 운영체제가 아니기 때문에, root User 관련 경고는 문제가 아니다.
❗️ 만약 image를 빌드 후, Dockerfile을 수정하면 다시 image를 만들어야 한다.</p><h3 id=빌드한-이미지-실행하여-컨테이너-가동>빌드한 이미지 실행하여 컨테이너 가동<a hidden class=anchor aria-hidden=true href=#빌드한-이미지-실행하여-컨테이너-가동>#</a></h3><p><code>docker run -d -p 80:8000 &lt;만든 image 이름></code></p><p>위 명령어 실행 후, <code>docker container ls</code>를 입력하면 가동되고 있는 container를 확인할 수 있다.</p><p>❗️ 위 명령어로 container id가 떴음에도 불구하고, <code>docker container ls -a</code>로 해당 container id의 status가 <code>exited</code> 이면 <code>docker logs &lt;container id></code>로 원인을 파악한다.</p><p> </p><hr><h1 id=6-docker로-nginx-배포하기>6. docker로 nginx 배포하기<a hidden class=anchor aria-hidden=true href=#6-docker로-nginx-배포하기>#</a></h1><p>django만으로는 traffic을 받을 수 없기 때문에, nginx를 설치해야한다.</p><h2 id=61-nginx-디렉토리-생성>6.1 nginx 디렉토리 생성<a hidden class=anchor aria-hidden=true href=#61-nginx-디렉토리-생성>#</a></h2><p><code>mkdir nginxtest</code> 생성</p><h2 id=62-dockerfile-생성>6.2 Dockerfile 생성<a hidden class=anchor aria-hidden=true href=#62-dockerfile-생성>#</a></h2><ul><li>위에 생성한 디렉토리로 이동 후, <code>vim Dockerfile</code>로 생성하여 아래 내용을 입력한다.</li></ul><p>❗️ 입력 시, 홀따옴표가 아닌 쌍따옴표를 사용한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>FROM nginx
</span></span><span style=display:flex><span>CMD [&#34;nginx&#34;, &#34;-g&#34;, &#34;daemon off;&#34;]
</span></span></code></pre></td></tr></table></div></div><ul><li><code>daemon off</code>의 의미<ul><li>nginx를 foreground로 돌리기 위함</li><li>container가 background로 실행되므로, nginx를 foreground로 돌리지 않으면 nginx가 exited된다.</li></ul></li></ul><h3 id=file-level>file level<a hidden class=anchor aria-hidden=true href=#file-level>#</a></h3><p><img loading=lazy src=https://user-images.githubusercontent.com/78094972/205932391-12e25d2c-19cc-4a0e-8c49-299f69e035f8.png alt=image></p><h2 id=63-image-build-및-확인>6.3 image build 및 확인<a hidden class=anchor aria-hidden=true href=#63-image-build-및-확인>#</a></h2><h3 id=image-build>image build<a hidden class=anchor aria-hidden=true href=#image-build>#</a></h3><p>Dockerfile이 있는 경로에서 아래 명령어를 실행한다.</p><p><code>docker build . -t nginx-test</code></p><h3 id=image-확인>image 확인<a hidden class=anchor aria-hidden=true href=#image-확인>#</a></h3><p><code>docker image ls</code>를 실행하여 목록을 확인한다. 이 때 경로는 상관없다.</p><h2 id=64-nginx-container-가동>6.4 nginx container 가동<a hidden class=anchor aria-hidden=true href=#64-nginx-container-가동>#</a></h2><h3 id=container-가동>container 가동<a hidden class=anchor aria-hidden=true href=#container-가동>#</a></h3><p><code>docker run -d nginx-test</code></p><h3 id=목록-확인>목록 확인<a hidden class=anchor aria-hidden=true href=#목록-확인>#</a></h3><p><code>docker container ls</code></p><p> </p><hr><h1 id=7-docker-compose로-장고와-nginx-함께-배포하기>7. Docker compose로 장고와 nginx 함께 배포하기<a hidden class=anchor aria-hidden=true href=#7-docker-compose로-장고와-nginx-함께-배포하기>#</a></h1><p><img loading=lazy src=https://user-images.githubusercontent.com/78094972/206096399-d5734708-c12b-499e-a8a4-f83905ea371c.png alt=image></p><p>위 이미지처럼 컨테이너 두 개를 연결하려고 한다.</p><ul><li>서버 외부에서 80포트로 들어오면 nginx로 이동하면 django-test 8000 port로 이동되도록 한다.</li></ul><p>nginx: 서버 와 django: 웹 서버를 연결하기 위해서 gunicorn을 사용해볼 예정이다.</p><p>이를 위해서 docker compose를 사용해보자.</p><h2 id=71-docker-compose-개념--설치>7.1 Docker compose 개념 & 설치<a hidden class=anchor aria-hidden=true href=#71-docker-compose-개념--설치>#</a></h2><h3 id=docker-compose-concept>Docker compose concept<a hidden class=anchor aria-hidden=true href=#docker-compose-concept>#</a></h3><p>django과 nginx를 연결하는데, 많은 컨테이너를 하나 하나 직접 연결하는 건 매우 시간이 많이 걸린다.</p><p>도커 파일은 &lsquo;하나의 컨테이너&rsquo; 를 관리하기 위한 파일이다.</p><p>하지만, <strong>도커 컴포즈는 &lsquo;여러 개의 컨테이너&rsquo;를 관리하는 도커 애플리케이션</strong>이다.</p><p>도커 컴포즈를 사용하기 위해서는 docker-compose.yml이라는 YAML 파일을 사용한다.</p><h3 id=yaml>YAML<a hidden class=anchor aria-hidden=true href=#yaml>#</a></h3><ul><li><p>YAML은 마크업 언어가 아니다.</p></li><li><p>기존 JSON의 불편함을 해소하기 위해 만들어진 언어</p></li><li><p>주로 설정 파일(configuration file)에 사용</p></li><li><p>확장자: *.yml</p></li></ul><h2 id=72-docker-compose-installation>7.2 Docker compose installation<a hidden class=anchor aria-hidden=true href=#72-docker-compose-installation>#</a></h2><p><a href=https://docs.docker.com/compose/install/linux/#install-the-plugin-manually>docs.docker.com - install the plugin manually</a>를 보고 아래 명령어를 순차적으로 입력한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>mkdir -p ~/.docker/cli-plugins
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -SL https://github.com/docker/compose/releases/download/v2.14.0/docker-compose-linux-x86_64 -o ~/.docker/cli-plugins/docker-compose
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chmod +x ~/.docker/cli-plugins/docker-compose
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker compose version
</span></span></code></pre></td></tr></table></div></div><h3 id=-error>❗️ Error<a hidden class=anchor aria-hidden=true href=#-error>#</a></h3><blockquote><p><strong><em>docker: &lsquo;compose&rsquo; is not a docker command</em></strong></p></blockquote><p>curl -o 뒤에 경로와 mkdir의 경로가 일치한지 확인하기</p><h2 id=73-directory-정리>7.3 directory 정리<a hidden class=anchor aria-hidden=true href=#73-directory-정리>#</a></h2><p>다음과 같이 경로를 수정한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>./
</span></span><span style=display:flex><span>├── django
</span></span><span style=display:flex><span>│   ├── Devket
</span></span><span style=display:flex><span>│   │   ├── config
</span></span><span style=display:flex><span>│   │   │   ├── __init__.py
</span></span><span style=display:flex><span>│   │   │   ├── __pycache__
</span></span><span style=display:flex><span>│   │   │   │   ├── __init__.cpython-310.pyc
</span></span><span style=display:flex><span>│   │   │   │   ├── settings.cpython-310.pyc
</span></span><span style=display:flex><span>│   │   │   │   ├── urls.cpython-310.pyc
</span></span><span style=display:flex><span>│   │   │   │   └── wsgi.cpython-310.pyc
</span></span><span style=display:flex><span>│   │   │   ├── asgi.py
</span></span><span style=display:flex><span>│   │   │   ├── settings.py
</span></span><span style=display:flex><span>│   │   │   ├── urls.py
</span></span><span style=display:flex><span>│   │   │   ├── wsgi.py
</span></span><span style=display:flex><span>│   │   │   └── ~
</span></span><span style=display:flex><span>│   │   ├── db.sqlite3
</span></span><span style=display:flex><span>│   │   └── manage.py
</span></span><span style=display:flex><span>│   ├── Dockerfile
</span></span><span style=display:flex><span>│   └── requirements.txt
</span></span><span style=display:flex><span>└── nginx
</span></span><span style=display:flex><span>    └── Dockerfile
</span></span></code></pre></td></tr></table></div></div><h2 id=74-dockerfile-수정>7.4 Dockerfile 수정<a hidden class=anchor aria-hidden=true href=#74-dockerfile-수정>#</a></h2><h3 id=django-directory-안에-있는-dockerfile-수정>django directory 안에 있는 dockerfile 수정<a hidden class=anchor aria-hidden=true href=#django-directory-안에-있는-dockerfile-수정>#</a></h3><p>첫 번째 <code>CMD</code> 뒤에 다른 <code>CMD</code>를 추가한다.</p><p><code>CMD gunicorn config.wsgi:application --bind 0.0.0.0:8000</code></p><h3 id=nginx-directory-안에-있는-dockerfile-수정>nginx directory 안에 있는 dockerfile 수정<a hidden class=anchor aria-hidden=true href=#nginx-directory-안에-있는-dockerfile-수정>#</a></h3><p>다음과 같이 수정한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>FROM nginx
</span></span><span style=display:flex><span>RUN rm /etc/nginx/conf.d/default.conf
</span></span><span style=display:flex><span>COPY default.conf /etc/nginx/conf.d
</span></span><span style=display:flex><span>CMD [&#34;nginx&#34;, &#34;-g&#34;, &#34;daemon off;&#34;]
</span></span></code></pre></td></tr></table></div></div><ul><li>기존 컨테이너에 있던 default.conf를 삭제하고, 새로운 default.conf를 기존에 있던 경로에 만들겠다는 의미다.</li></ul><h2 id=75-nginx에-defaultconf-추가>7.5 nginx에 default.conf 추가<a hidden class=anchor aria-hidden=true href=#75-nginx에-defaultconf-추가>#</a></h2><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>server {
</span></span><span style=display:flex><span>	listen 80;
</span></span><span style=display:flex><span>	server_name localhost;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	location /{
</span></span><span style=display:flex><span>		proxy_pass http://&lt;nginx에 연결할 service name&gt;:8000;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><ul><li><code>listen 80 </code>: 서버로부터 들어오는 것을 80 port로 받겠다는 의미</li><li><code>proxy_pass</code>: 80 port로 들어온 것을 8000 port로 돌리겠다는 의미</li></ul><h2 id=76-docker-composeyml>7.6 docker-compose.yml<a hidden class=anchor aria-hidden=true href=#76-docker-composeyml>#</a></h2><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#6272a4># docker-compose.yml이 있는 경로: ~/test</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>version</span>: <span style=color:#f1fa8c>&#34;3&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>services</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;첫 번째 service name&gt;</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>build</span>: ./&lt;django Dockerfile이 있는 directory name&gt;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>container_name</span>: &lt;생성될 image name&gt;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>restart</span>: always
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>expose</span>: 
</span></span><span style=display:flex><span>            - <span style=color:#f1fa8c>&#34;8000&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;두 번째 service name&gt;</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>build</span>: ./&lt;nginx Dockerfile이 있는 directory&gt;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>container_name</span>: &lt;생성될 image name&gt;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>restart</span>: always 
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>ports</span>: 
</span></span><span style=display:flex><span>          - <span style=color:#f1fa8c>&#34;80:80&#34;</span> 
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>depends_on</span>: 
</span></span><span style=display:flex><span>          - &lt;첫 번째 service name&gt;
</span></span></code></pre></td></tr></table></div></div><ul><li><code>version</code>: version에 따라 참고하는 규격이 달라진다.<ul><li><a href=https://docs.docker.com/compose/compose-file/compose-versioning/#version-3>About versions and upgrading</a></li></ul></li><li><code>services</code> 밑에 바로 오는 것은 여러 서비스 명칭들을 의미</li><li><code>expose</code>: container 상에 몇 번 포트를 열지 지정</li><li><code>ports</code>: 서버에서 들어와 바로 받기 때문에 입력해야 한다.</li><li><code>depends_on</code>: service 간 관계성을 지정하는 키워드로서, 실행 순서를 정하는 키워드로 depends_on에 있는 service를 실행한 후, 해당 service를 실행</li><li>생성될 image name은 현재 <code>test</code> 경로에서 실행되었기 때 문에, <code>test-&lt;생성될 image name></code>으로 image가 생성된다.</li></ul><h2 id=77-docker-compose-실행-및-내리기>7.7 docker compose 실행 및 내리기<a hidden class=anchor aria-hidden=true href=#77-docker-compose-실행-및-내리기>#</a></h2><p>docker compose 명령어는 docker-compose.yml 파일이 있는 경로 및 그 아래 경로 어디서든 실행할 수 있다.</p><ul><li>docker compose 실행하기: <code>docker compose up -d --build</code></li><li>docker compose 내리기: <code>docker compose down</code></li></ul><p> </p><hr><h1 id=8-도커로-장고-nginx-postgresql-함께-배포하기>8. 도커로 장고, nginx, PostgreSQL 함께 배포하기<a hidden class=anchor aria-hidden=true href=#8-도커로-장고-nginx-postgresql-함께-배포하기>#</a></h1><p>전체적인 서버 구성은 다음과 같다.</p><p><img loading=lazy src=https://user-images.githubusercontent.com/78094972/206230297-44fc1f1a-226e-4173-8e4d-3bbaf88c1764.png alt=image></p><p>그리고, 컨테이너의 관점에서 바라보면 전체적인 구성은 다음과 같다.</p><p><img loading=lazy src=https://user-images.githubusercontent.com/78094972/206230121-50f10a96-878f-4fc1-8f32-acdd353b61ba.png alt=image></p><h3 id=gunicorn을-선택한-이유>gunicorn을 선택한 이유<a hidden class=anchor aria-hidden=true href=#gunicorn을-선택한-이유>#</a></h3><p>gunicorn을 사용한 이유는 현재 과정에서는 빠른 속도가 불필요하기 때문이다. 빠른 속도와 빠른 성능이 필요하면 wsgi를 쓴다.</p><h2 id=81-file-directory-구조>8.1 file directory 구조<a hidden class=anchor aria-hidden=true href=#81-file-directory-구조>#</a></h2><ul><li><p>django, nginx, psql이 docker-compose.yml과 동일한 file level이어야 한다.</p></li><li><p>그리고 django, nginx, psql에는 각 해당되는 Dockerfile이 존재해야한다.</p></li><li><p>django에는 requirements.txt가, nginx에는 default.conf가 추가로 존재해야 한다.</p></li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>./
</span></span><span style=display:flex><span>├── django
</span></span><span style=display:flex><span>│   ├── Devket
</span></span><span style=display:flex><span>│   │   ├── config
</span></span><span style=display:flex><span>│   │   │   ├── __init__.py
</span></span><span style=display:flex><span>│   │   │   ├── __pycache__
</span></span><span style=display:flex><span>│   │   │   │   ├── __init__.cpython-310.pyc
</span></span><span style=display:flex><span>│   │   │   │   ├── settings.cpython-310.pyc
</span></span><span style=display:flex><span>│   │   │   │   ├── urls.cpython-310.pyc
</span></span><span style=display:flex><span>│   │   │   │   └── wsgi.cpython-310.pyc
</span></span><span style=display:flex><span>│   │   │   ├── asgi.py
</span></span><span style=display:flex><span>│   │   │   ├── settings.py
</span></span><span style=display:flex><span>│   │   │   ├── urls.py
</span></span><span style=display:flex><span>│   │   │   ├── wsgi.py
</span></span><span style=display:flex><span>│   │   │   └── ~
</span></span><span style=display:flex><span>│   │   ├── db.sqlite3
</span></span><span style=display:flex><span>│   │   └── manage.py
</span></span><span style=display:flex><span>│   ├── Dockerfile
</span></span><span style=display:flex><span>│   └── requirements.txt
</span></span><span style=display:flex><span>├── docker-compose.yml
</span></span><span style=display:flex><span>├── nginx
</span></span><span style=display:flex><span>│   ├── Dockerfile
</span></span><span style=display:flex><span>│   └── default.conf
</span></span><span style=display:flex><span>└── psql
</span></span><span style=display:flex><span>    └── Dockerfile
</span></span></code></pre></td></tr></table></div></div><h2 id=82-docker-composeyml-수정하기>8.2 docker-compose.yml 수정하기<a hidden class=anchor aria-hidden=true href=#82-docker-composeyml-수정하기>#</a></h2><p>DB 추가에 따른 docker-compose.yml은 다음 내용이 추가된다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff79c6>version</span>: <span style=color:#f1fa8c>&#34;3&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>services</span>:
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>psql</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>build</span>: ./psql
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>container_name</span>: psql
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>restart</span>: always
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>volumes</span>:
</span></span><span style=display:flex><span>          - myvolume:var/lib/postgresql/data
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>environment</span>:
</span></span><span style=display:flex><span>          - POSTGRES_USER=postgres
</span></span><span style=display:flex><span>          - POSTGRES_PASSWORD=postgres
</span></span><span style=display:flex><span>          - POSTGRES_DB=postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>volumes</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>myvolume</span>:
</span></span></code></pre></td></tr></table></div></div><ul><li>psql-test에는 db이기 때문에 volume이 추가된 걸 알 수 있다.</li></ul><p>❗️ 만약 용량 부족 error가 뜰 경우 <code>docker system prune --volumes</code> 명령어를 상용해보자.</p><h2 id=83-django-settingspy의-db-설정-변경하기>8.3 django settings.py의 DB 설정 변경하기<a hidden class=anchor aria-hidden=true href=#83-django-settingspy의-db-설정-변경하기>#</a></h2><p>django application의 settings.py의 DATEBASES 환경 변수를 수정한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#6272a4># before</span>
</span></span><span style=display:flex><span>DATABASES <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#39;default&#39;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;ENGINE&#39;</span>: <span style=color:#f1fa8c>&#39;django.db.backends.sqlite3&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;NAME&#39;</span>: BASE_DIR <span style=color:#ff79c6>/</span> <span style=color:#f1fa8c>&#39;db.sqlite3&#39;</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># after</span>
</span></span><span style=display:flex><span>DATABASES <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#39;default&#39;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;ENGINE&#39;</span>: <span style=color:#f1fa8c>&#39;django.db.backends.postgresql&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;NAME&#39;</span>: <span style=color:#f1fa8c>&#39;postgres&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;USER&#39;</span>: <span style=color:#f1fa8c>&#39;postgres&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;PASSWORD&#39;</span>: <span style=color:#f1fa8c>&#39;postgres&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;HOST&#39;</span>: <span style=color:#f1fa8c>&#39;db-test&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;PORT&#39;</span>: <span style=color:#bd93f9>5432</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=84-requirements-변경-후-compose-실행하기>8.4 requirements 변경 후, compose 실행하기<a hidden class=anchor aria-hidden=true href=#84-requirements-변경-후-compose-실행하기>#</a></h2><ul><li>requirements.txt에 <code>psycopg2</code>를 추가</li><li>compose 실행: <code>docker compose up -d --build</code></li></ul><h3 id=-error-01>❗️ Error 01<a hidden class=anchor aria-hidden=true href=#-error-01>#</a></h3><blockquote><p>invalid mount config for type &ldquo;volume&rdquo;: invalid mount path: &lsquo;var/lib/postgresql/data&rsquo; mount path must be absolute</p></blockquote><p>&lsquo;var/lib/postgresql/data&rsquo; 앞에 <code>/</code>가 없어서 생긴 문제다.</p><h3 id=-error-02>❗️ Error 02<a hidden class=anchor aria-hidden=true href=#-error-02>#</a></h3><blockquote><p>strconv.Atoi: parsing &ldquo;&rdquo;: invalid syntax</p></blockquote><p>docker-compose.yml 또는 Dockerfile에 입력 형식이 잘못되었다는 의미다.</p><h3 id=-용량-부족으로-인한-error>❗️ 용량 부족으로 인한 Error<a hidden class=anchor aria-hidden=true href=#-용량-부족으로-인한-error>#</a></h3><p>image가 과도하게 많아서 에러가 발생할 경우, <code>sudo docker system prune</code>을 실행한다.</p><p> </p><hr><h1 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h1><ul><li><a href=https://learningspoons.com/course/detail/django-backend/>러닝스푼즈 - 나노디그리 Python & Django backed course</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://jeha00.github.io/tags/docker/>docker</a></li></ul><nav class=paginav><a class=prev href=http://jeha00.github.io/post/project/devket/deployment/01_deployment/><span class=title>« Prev Page</span><br><span>Project: Docker를 사용하여 django app 배포하기</span></a>
<a class=next href=http://jeha00.github.io/post/project/devket/django/02_payment_issues/><span class=title>Next Page »</span><br><span>Project: Payment 개발 과정에서의 고려사항들과 개발 이슈들</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기 on twitter" href="https://twitter.com/intent/tweet/?text=Docker-compose%eb%a1%9c%20nginx%2c%20django%2c%20postgreSQL%ec%9d%84%20%ec%97%b0%ea%b2%b0%ed%95%98%ea%b3%a0%20%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0&url=http%3a%2f%2fjeha00.github.io%2fpost%2fdocker%2f04_deployment-by-docker%2f&hashtags=docker"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fjeha00.github.io%2fpost%2fdocker%2f04_deployment-by-docker%2f&title=Docker-compose%eb%a1%9c%20nginx%2c%20django%2c%20postgreSQL%ec%9d%84%20%ec%97%b0%ea%b2%b0%ed%95%98%ea%b3%a0%20%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0&summary=Docker-compose%eb%a1%9c%20nginx%2c%20django%2c%20postgreSQL%ec%9d%84%20%ec%97%b0%ea%b2%b0%ed%95%98%ea%b3%a0%20%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0&source=http%3a%2f%2fjeha00.github.io%2fpost%2fdocker%2f04_deployment-by-docker%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기 on reddit" href="https://reddit.com/submit?url=http%3a%2f%2fjeha00.github.io%2fpost%2fdocker%2f04_deployment-by-docker%2f&title=Docker-compose%eb%a1%9c%20nginx%2c%20django%2c%20postgreSQL%ec%9d%84%20%ec%97%b0%ea%b2%b0%ed%95%98%ea%b3%a0%20%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기 on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fjeha00.github.io%2fpost%2fdocker%2f04_deployment-by-docker%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기 on whatsapp" href="https://api.whatsapp.com/send?text=Docker-compose%eb%a1%9c%20nginx%2c%20django%2c%20postgreSQL%ec%9d%84%20%ec%97%b0%ea%b2%b0%ed%95%98%ea%b3%a0%20%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0%20-%20http%3a%2f%2fjeha00.github.io%2fpost%2fdocker%2f04_deployment-by-docker%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker-compose로 nginx, django, postgreSQL을 연결하고 배포하기 on telegram" href="https://telegram.me/share/url?text=Docker-compose%eb%a1%9c%20nginx%2c%20django%2c%20postgreSQL%ec%9d%84%20%ec%97%b0%ea%b2%b0%ed%95%98%ea%b3%a0%20%eb%b0%b0%ed%8f%ac%ed%95%98%ea%b8%b0&url=http%3a%2f%2fjeha00.github.io%2fpost%2fdocker%2f04_deployment-by-docker%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://jeha00.github.io/>Jeha DevLog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>