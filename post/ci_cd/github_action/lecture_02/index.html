<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets | Jeha DevLog</title><meta name=keywords content="ci/cd"><meta name=description content="첫 번째, Activity type, filters가 뭔지 학습한다. 두 번째 Job artifacts, outputs 를 비교해보고 github actions caching을 어떻게 하면 적용할 수 있는지 알아본다. 세 번째, github action에서 환경 변수와 secrets 값을 어떻게 설정하는지 알아본다."><meta name=author content="Me"><link rel=canonical href=http://jeha00.github.io/post/ci_cd/github_action/lecture_02/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.8330bf30523628d00ababead16d63a7b5cd7570bd4901cb3c11ec258628d7a67.css integrity="sha256-gzC/MFI2KNAKur6tFtY6e1zXVwvUkByzwR7CWGKNemc=" rel="preload stylesheet" as=style><link rel=icon href=http://jeha00.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://jeha00.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://jeha00.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://jeha00.github.io/apple-touch-icon.png><link rel=mask-icon href=http://jeha00.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.101.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets"><meta property="og:description" content="첫 번째, Activity type, filters가 뭔지 학습한다. 두 번째 Job artifacts, outputs 를 비교해보고 github actions caching을 어떻게 하면 적용할 수 있는지 알아본다. 세 번째, github action에서 환경 변수와 secrets 값을 어떻게 설정하는지 알아본다."><meta property="og:type" content="article"><meta property="og:url" content="http://jeha00.github.io/post/ci_cd/github_action/lecture_02/"><meta property="og:image" content="http://jeha00.github.io/47"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-08-10T22:13:42+09:00"><meta property="article:modified_time" content="2023-08-10T22:13:42+09:00"><meta property="og:site_name" content="JeHa00 DevLog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://jeha00.github.io/47"><meta name=twitter:title content="CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets"><meta name=twitter:description content="첫 번째, Activity type, filters가 뭔지 학습한다. 두 번째 Job artifacts, outputs 를 비교해보고 github actions caching을 어떻게 하면 적용할 수 있는지 알아본다. 세 번째, github action에서 환경 변수와 secrets 값을 어떻게 설정하는지 알아본다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://jeha00.github.io/post/"},{"@type":"ListItem","position":2,"name":"CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets","item":"http://jeha00.github.io/post/ci_cd/github_action/lecture_02/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets","name":"CI\/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets","description":"첫 번째, Activity type, filters가 뭔지 학습한다. 두 번째 Job artifacts, outputs 를 비교해보고 github actions caching을 어떻게 하면 적용할 수 있는지 알아본다. 세 번째, github action에서 환경 변수와 secrets 값을 어떻게 설정하는지 알아본다.","keywords":["ci/cd"],"articleBody":"0. Introduction CI/CD를 위한 github action study basic 프로젝트를 진행하면서 새로 작성된 또는 수정된 코드를 repository에 push하면 자동적으로 테스트를 실행하고, 통과되면 합쳐지고 아니면 에러를 발생시키는 workflow를 적용하고 싶어서 예전부터 공부하고 싶었던 github action에 대해 study를 시작한다.\n국내에서는 github action에 대한 강의나 서적을 찾지 못하여 멘토링을 찾았지만 시간 대비 너무 비싸서 포기했다. 그래서 udemy를 찾던 중 저렴한 가격에 좋은 퀄리티 강의를 찾게 되어 이 강의를 중심으로 학습을 진행한다.\n해당 강좌에서 사용되는 소스 코드를 사용하는 부분들은 빼고 블로그에 정리한다.\n해당 소스 코드를 사용하는 부분이 있다면 그 부분이 없어도 해당 블로그만 봐도 익힐 수 있도록 정리해놓는다.\n이미 알고 있는 개념들도 있지만, 놓치고 있는 부분을 확인하고자 정리해본다.\n🔆 첨부된 링크는 구글에 github actions {keyword} 로 입력하면 제일 첫 번째로 나온다.\n1. Activity type and Filters 학습하기 지난 학습을 통해서 on: [push, workflow_dispatch]로 events를 정의해놓으면 모든 push마다 workflow가 진행된다는 걸 알게 되었다.\n그런데 이를 보다 더 정밀하게 event를 정의하고 싶다면 어떻게 해야할까?\n그럴 때는 Activity type 또는 filter를 적용해야 한다. event의 Activity types 과 filters에 대해 알아보자.\nActivity type에는 예를 들어서 event가 pull_request라면 activity type에는 opened, closed, edited 가 존재한다.\nFilters는 push event라고 한다면 target branch에 대해 조건을 걸 수 있다.\ngithub actions events를 보면 여러 event와 activity type가 나와있다. 해당 event를 사용할 때는 Note를 반드시 읽어보도록 하자. types를 입력하는 3가지 방식과 types가 존재할 때 여러 event를 입력하는 방식 1 2 3 4 5 6 7 8 9 10 11 12 13 14 name: Events Demo 1 on: pull_request: # types를 입력하는 3가지 방식: 반드시 types 이어야 한다. types: [opened, edited] types: opened types: - opened workflow_dispatch: jobs: deploy: runs-on: ubuntu-latest steps: ... 그러면 아래와 같이 작성했다고 하면 수동적으로 실행했을 때와 PR을 open했을 때 workflow가 진행된다.\n1 2 3 4 5 6 7 8 9 10 11 name: Events Demo 1 on: pull_request: types: - opened workflow_dispatch: jobs: deploy: runs-on: ubuntu-latest steps: ... 아래 이미지를 통해 실행되는 걸 확인할 수 있다.\n하지만 types: closed 인 경우에는 PR이 닫혀지고 나서 실행된다.\n이처럼 types를 무엇으로 지정하냐에 따라서 workflow 진행 유무 기준을 구체적으로 정할 수 있다.\npush에 대한 filter 적용 push를 할 때 내가 원하는 branch와 원하는 경로에 들어올 때만 실행하는 방법도 있다.\npush keyword에 branches keyword를 입력해보자.\n1 2 3 4 5 6 7 name: Events Demo 1 on: push: branches: - main - 'dev-*' - 'feat/**' 위 workflow의 의미는 다음과 같다.\nmain branch와 dev-로 시작하는 branch와 feat/ 로 시작하는 branch 위 3가지 branch에 push를 할 경우에만 workflow를 실행한다. 만약 feature/ 로 시작한다면 실행되지 않는다.\nworkflow 경로에 따라 실행하기 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 name: Events Demo 1 on: push: paths-ignore: - '.github/workflows/*' jobs: deploy: runs-on: ubuntu-latest steps: - name: Output event data run: echo \"${{toJSON(github.event)}}\" - name: Get code uses: actions/checkout@v3 - name: Install dependencies run: npm ci - name: Test code run: npm run test - name: Build code run: npm run build - name: Deploy project run: echo \"Deploying...\" 이 상황에서 만약 main branch로 push를 할 경우 Events Demo 1은 실행되지 않는다.\nForked Pull Request Workflows 만약 누군가 repository를 fork하고 main branch에 push할 경우, forked repository가 아닌 원래 repository에서 경고 표시로 workflow 가 뜨면서 진행되지 않는다.\n이렇게 된 이유는 모든 사람들이 repository를 fork할 수 있는데, 악의적으로 workflow를 실행시켜서 cost를 과도하게 유발시키 수 있기 때문에, forked repository에서 main으로 push한 경우에는 바로 workflow가 진행되지 않는다.\n진행 중인 workflow 취소하기 기본적으로 workflow가 진행 중이다가 실패하면 workflow는 당연히 취소된다.\n또한, 수동적으로 직접 workflow를 취소할 수도 있다.\n아래 이미지의 오른쪽 위를 보면 Cancel workflow button을 통해서 중지할 수 있다.\nworkflow skip 하기 참고할 공식 문서는 여기 다.\n위 문서에 따르면 commit message를 작성할 때 다음 메세지를 작성하면 된다.\n[skip ci] [ci skip] [no ci] [skip actions] [actions skip] 그러면 main branch에 push는 했지만 github actions는 실행되지 않는 걸 확인할 수 있다.\n2. Job Data \u0026 Outputs \u0026 Caching What is Job Artifacts Job Artifacts란 Job에 의해 생긴 결과물로 예를 들어서 log file이나 website files 등이 있다.\n이 Job Artifacts를 Github UI나 REST API를 사용하여 수동적으로 다운받아 사용하는 방식이 있고 Job을 통해 Action으로 Job Artifacts를 다운받고 사용하는 방식이 있다.\n예를 들어서 npm run build로 실행하여 생긴 dist folder는 build job에 의해서 생긴 artifacts다.\n그러면 이 Artifacts를 upload 및 download 하도록 해보자.\n이 작업이 필요한 이유는 각 job 단계에서의 runner machine은 다르기 때문에 같은 runner machine 정의를 가진다고 해도 각 runner machine에서는 그 파일을 가지고 있지 않는다. 그래서 job이 build -\u003e deploy 순서로 존재한다고 할 때 build 단계에서 업로드한 파일을 deploy 단계에서 가지기 위해서는 ‘다운로드’를 진행해야 한다. 그리고 이를 위해서 업로딩이 필요하다.\nJob artifacts를 업로딩하기 이 Actions를 통해 생긴 결과물인 Job artifacts를 사용할 수 있다. workflow를 다음과 같이 작성한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 name: Deployment Exercise 2 on: push: branches: - main jobs: test: runs-on: ubuntu-latest ... build: needs: test runs-on: ubuntu-latest steps: - name: Get code uses: actions/checkout@v3 - name: Install dependencies run: npm ci - name: Build website run: npm run build # 이 부분을 추가 - name: Upload artifacts uses: actions/upload-artifact@v3 with: name: dist-files path: | dist package.json # package.json은 경로를 여러 개 입력하는 방법을 보여주기 위해 입력한 예시 deploy: needs: build ... 아래 이미지처럼 Artifacts가 생성된다. 이를 클릭하면 수동으로 다운 받을 수 있다.\n자동으로 다운받아지기 위해서는 deploy job 단계에서 다운받는 step을 추가한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 ... build: needs: test ... # 이 부분을 추가 - name: Upload artifacts uses: actions/upload-artifact@v3 with: name: dist-files # 이 부분은 수정한다. # path: | # dist # package.json path: dist deploy: needs: build runs-on: ubuntu-latest steps: # 추가한 단계 - name: Get build artifacts uses: actions/download-artifact@v3 with: name: dist-files # - name: Output contents run: ls - name: Deploy run: echo \"Deploying...\" 아래 이미지를 보면 Output contents step 단계에서 ls를 실행하여 파일 목록을 확인했다.\n다운로드 시 Github에서 제공하는 Action을 사용하여 할 수 있다. 이 때 설정을 추가해야 한다. 업로드 했던 파일의 이름을 name key로 value를 입력한다. 그러면 deploy job이 실행되는 folder 안에 dist-files 내부 파일들이 바로 담겨진다.\nArtifacts와 Job Outputs ‘Artifacts’는 log file이나 website files로 사용된다면 ‘Job Outputs’는 순차적으로 일어나는 다음 job 들에 사용되는 값들을 말한다. 예를 들어서 이전 step 단계에서 생성된 파일의 이름을 말한다. 그러면 Job Outputs를 확인해보자.\n아래 yml은 Job Output을 이용하는 workflow다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 name: Demo on: push: branches: - main jobs: test: runs-on: ubuntu-latest steps: ... build: needs: test runs-on: ubuntu-latest # 추가한 key: outputs outputs: script-file: ${{ steps.publish.outputs.file-name }} # steps: ... # 추가한 step - name: Publish JS filename id: publish run: find dist/assets/*.js -type f -execdir echo 'file-name={}' \u003e\u003e $GITHUB_OUTPUT ';' # ... deploy: needs: build runs-on: ubuntu-latest steps: ... # 추가한 steps - name: Needs run: echo \"${{ needs }}\" - name: Build run: echo \"${{ needs.build }}\" - name: Output run: echo \"${{ needs.build.outputs}}\" - name: Output filename run: echo \"${{ needs.build.outputs.script-file }}\" - name: Deploy run: echo \"Deploying...\" # build job의 Publish JS filename step steps라는 context name은 아래 공식문서에서와 같은 의미를 가지고 있어서 steps를 통해 해당 step의 정보를 얻을 수 있다.\nInformation about the steps that have been run in the current job. 위 단계에서 아래 command를 실행했다.\nfind dist/assets/*.js -type f -execdir echo 'file-name={}' \u003e\u003e $GITHUB_OUTPUT ';'\n위 명령어의 의미는 다음과 같다.\ndist/assets/*.js인 데이터를 찾는데, 이 데이터의 타입은 f로 파일이고, execdir을 사용해서 해당 파일이 있는 경로에서 echo 커맨드를 실행한다. file-name key에 해당하는 value를 $GITHUB_OUTPUT에 저장한다. $GITHUB_OUTPUT은 outputs에 선언된 key 값에 연결된다. file-name key의 value에 저장된다. script-file이 file-name을 가리키기 때문에 script-file에 저장된다. 다른 job의 output 이용하기 deploy job을 보면 여러 개의 환경 변수들을 출력하고 있다\nneeds, needs.build, needs.build.outputs, needs.build.outputs.script-file 아래 image를 보면 해당 step name 별로 출력된 결과를 볼 수 있다.\nneeds.build.outputs.script-file로 적어뒀던 Output filename step만 다른 값을 출력한 걸 확인할 수 있다.\n이처럼 github output에 값을 담아두면 다른 job에서도 꺼내서 사용할 수 있는 걸 알 수 있다.\n그리고, Artifacts와 outputs의 차이 를 확실히 알게 되었다. Artifacts는 외부에서 다운받을 수 있는 결과물이지만, outputs는 단순한 값이라는 걸 확인했다.\ncache를 사용하여 Dependency 설치 시간을 단축시키기 여태 실습한 workflow는 간단하기 때문에 1분 내외지만 복잡한 workflow를 하게 되면서 시간이 많이 걸리게 된다.\n이번 섹션에서는 이 workflow 실행 시간을 줄이는 것에 초점을 둔다.\n실행 시간을 줄이는 방법 중 하나는 각 Step 마다 반복되는 부분을 빠르게 진행하는 것이다.\n반복되는 부분을 확인해보자.\nTest job: Get code =\u003e Install Dependencies =\u003e Test App\nBuild job: Get code =\u003e Install Dependencies =\u003e Build Project\n여러 step 중에서 Get code 부분이 반복된다. 하지만 이 부분은 ‘1s’ 밖에 걸리지 않기 때문에 이는 많이 느리지 않는다.\n또한, Install dependencies 부분이 반복된다. 이 부분은 ’12s’나 걸리기 때문에 많이 느리다.\n그렇다면 dependencies 를 설치할 때 매 step마다 달라지는가? 얼마나 달라지는가?\ndependencies는 자주 바뀌지 않는다. 그렇기 때문에 이 부분을 공통적으로 사용해도 문제가 없다. 이 부분을 단축한다면 전체 workflow 실행 시간이 줄어들 것이다. dependencies를 설치하는 부분의 시간을 ‘cache’ 를 사용하여 단축해보자.\n각 job마다 실행되는 runner (os)가 다른데 어떻게 cache를 사용할 수 있을까?\ngithub actions - cache 를 사용하여 해당 job이 끝나면 지정한 폴더 또는 파일을 저장하여 다른 job이 실행될 때 이를 꺼내서 사용하는 방식으로 cache가 저장 및 사용된다.\n코드는 다음과 같다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 jobs: test: runs-on: ubuntu-latest steps: - name: Get code uses: actions/checkout@v3 # 추가된 코드 - name: Cache dependencies uses: actions/cache@v3 with: path: ~/.npm key: deps-node-modules-${{ hashFiles('**/package-lock.json') }} # - name: Install dependencies run: npm ci - name: Lint code run: npm run lint - name: Test code run: npm run test 위 추가된 코드에 대해 설명하자면\n~/.npm은 npm 에서 생성한 자체 cache folder인데, 이 folder를 actions를 사용하여 다른 workflow 또는 job 공용으로 사용하기 위해 github server에 있는 github cloud에 저장한다.\nkey는 미래에 이 cache data를 가져올 때 필요하다.\nhashFiles를 사용한 이유는 혹시 dependency가 업데이트되었을 때, 중복되면 않되기 때문에 고유 식별자 역할을 하기 위해 사용한다.\n**/package-lock.json 인 이유는 경로 상관없이 package-lock.json을 저장할 것이기 때문이다.\ntest job에 작성된 Cache dependencies를 다음 단계 job인 build에도 추가한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 build: needs: test runs-on: ubuntu-latest outputs: script-file: ${{ steps.publish.outputs.file-name }} steps: - name: Get code uses: actions/checkout@v3 # add code - name: Cache dependencies uses: actions/cache@v3 with: path: ~/.npm key: deps-node-modules-${{ hashFiles('**/package-lock.json') }} # - name: Install dependencies run: npm ci ... 그러면 실행 결과를 확인해보자. 아래 이미지는 test job에서의 이미지다.\nCache dependencies 단계에서는 해당 key를 발견할 수 없다고 떴지만 Post Cache dependencies 단계에서 해당 key 값으로 cache에 저장된 걸 알 수 있다.\n위 이미지에서는 안보이지만 test job에서 Install dependencies 단계에서는 ’11s’가 걸렸다.\n그러면 test 다음 job인 build job일 때 설치 시간, Cache dependencies를 확인해보자.\nCache dependencies 단계에서 다음 메세지를 확인할 수 있다.\ncache restored from key: deps-node-modules-... test 단계에서는 해당 key를 발견할 수 없다고 떴지만, 그 다음 build 단계에서는 해당 key로 cache에서 꺼낸 걸 알 수 있다.\n그리고 그 다음 step인 Install dependencies 단계의 설치 시간은 ‘5s’로 줄어든 걸 확인할 수 있다.\n다른 workflow에도 똑같은 Install dependencies step이 존재한다면 실행 시간이 짧아진 거를 확인할 수 있을 것이다.\nSummary Artifacts Job 실행에 의한 결과물로 공유되거나 분석될 수 있다. Artifacts 또는 Job artifacts라고 불린다. Github Actions에서 제공하는 action을 통해 uploading 과 downloading을 제공한다. Outputs Steps 실행에 의해 생성된 결과물이고 단순한 값들이며, Job 간에 공유될 수 있다.\n‘steps’ context를 통해서 Jobs들은 이를 사용 및 공유할 수 있다.\necho '{output-name}={output-value}' \u003e\u003e $GITHUB_OUTPUT 명령어로 key-value로 저장한다.\n위 command를 사용하는 step의 경우 id를 key를 입력해야 한다.\n다른 job에서 이를 사용할 경우, steps.{step_id}.outputs.{key}로 사용가능하다.\n1 2 3 4 5 6 7 8 9 build: needs: test runs-on: ubuntu-latest outputs: script-file: ${{ steps.publish.outputs.file-name }} steps: - name: Publish JS filename id: publish run: find dist/assets/*.js -type f -execdir echo 'file-name={}' \u003e\u003e $GITHUB_OUTPUT ';' caching 반복되고, 느린 step들의 속도를 증가시킬 수 있다. 전형적으로 사용되는 경우는 dependency 설치지만, 어느 파일과 폴더 모두 가능하다. ❗️ 하지만 artifacts를 caching하여 사용하지 말자. 용량이 크다. 3. Enviroment variables \u0026 Secrets 사용하기 왜 github actions에 환경 변수가 필요할까? 왜냐하면 tesing 시 db와 production 시 db에 대한 password가 다른데 이를 환경 설정으로 다르게 해야 workflow를 진행 시 의도한 대로 정확하게 진행할 수 있기 때문이다.\nEnvironments variables code 상에서 사용할 수 있는 동적 값으로 다음과 같이 workflow 전체 범위로도, 해당 Job에 대해서만으로도, step에 대해서만으로도 할 수 있다. 환경 변수를 사용하기 위해서는 env 라는 내장 키워드를 통해서 접근할 수 있다.\nworkflow, job, step에 대해서 환경 변수 선언하기 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 name: Deployment on: push: branches: - main # on과 같은 level에서 선언: workflow 전체 범위로 선언 env: DB_NAME: test jobs: test: # 해당 job에 대해서만 선언 env: DB_USERNAME: project DB_PASSWORD: 1234 runs-on: ubuntu-latest steps: - name: # 해당 step에 대해서만 선언 env: APPLE: 1234 uses: 위 코드에서 ‘DB_NAME’은 workflow 전체 범위로 선언한 이유는 db name은 test이든 production이든 잘 변하지 않기 때문이다. 환경 변수 사용하기 그러면 환경 변수를 사용하기 위해 workflow를 작성해보자.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 name: Demo on: push: branches: - main env: DB_NAME: test jobs: test: env: DB_USERNAME: project DB_PASSWORD: 1234 runs-on: ubuntu-latest steps: ... # 추가된 코드 - name: Check DB information run: | echo \"DB_NAME: ${{ env.DB_NAME }}\" echo \"DB_USERNAME: $DB_USERNAME\" echo \"DB_PASSWORD: $DB_PASSWORD\" # build: needs: test runs-on: ubuntu-latest outputs: script-file: ${{ steps.publish.outputs.file-name }} steps: ... # 추가된 코드 - name: Check DB information run: | echo \"DB_NAME: ${{ env.DB_NAME }}\" echo \"DB_USERNAME: $DB_USERNAME\" echo \"DB_PASSWORD: $DB_PASSWORD\" # DB_NAME은 workflow 전역으로 선언 DB_USERNAME, DB_PASSWORD는 job 범위로 선언 위 코드를 실행한 결과 중 test job의 실행 결과는 다음과 같다.\n모든 값이 다 출력되었고, 일치한다.\n그러면 build job의 실행 결과를 확인해보자.\nworkflow level에서 선언한 DB_NAME만 출력되고 다른 job에서 선언했던 DB_USERNAME과 DB_PASSWORD는 출력되지 않은 걸 알 수 있다.\n위 결과 workflow level에서 선언한 환경 변수에 접근하기 위해서는 ${{env.{key name}}}을 사용하여 접근하면 되고, job 내에서 선언한 환경변수는 $key_name을 통해 접근하면 된다는 걸 확인했다.\nSecrets 사용하기 Environment variables 처럼 동적 값이지만 노출되지 않아야 하는 값들은 Secrets으로 사용하면 된다. 예를 들어 API key, db 관련 정보들이 해당된다. 이 값을 사용하기 위해서는 secrets 라는 내장 키워드를 통해서 사용될 수 있다.\ngithub에는 이러한 secrets를 저장할 공간이 존재한다. Github 해당 repository -\u003e Settings tab -\u003e Security 의 Actions에 접근하면 아래 이미지 화면을 확인할 수 있다.\n위 화면을 확인했다면 secret을 추가하기 위해서 위 ‘New repository secret’ 버튼을 클릭하여 추가한다.\n예를 들어 DB_NAME: test 를 추가하고 싶다면 위 버튼을 클릭 후 ‘Name’에는 ‘DB_NAME’을 입력하고, ‘Secret’에 ’test’를 입력한다. 추가하면 다음 이미지처럼 확인할 수 있다.\n그러면 DB_USERNAME: project와 DB_PASSOWRD: 1234도 다 추가해보자. 그 다음에 secrets으로부터 값을 가져오기 위해서 해당 workflow의 env를 다음과 같이 수정한다.\n1 2 3 4 5 6 7 8 9 ... env: DB_NAME: ${{secrets.DB_NAME}} jobs: test: env: DB_USERNAME: ${{secrets.DB_USERNAME}} DB_PASSWORD: ${{secrets.DB_PASSOWRD}} ... 위와 같이 수정된 후 실행 결과를 확인해보면 이전과 달리 ‘*’ 라는 문자로 값이 드러나지 않는 걸 확인할 수 있다.\nJob마다 같은 용도지만 다른 값을 가진 secret 사용하기 위 소제목에 나온 대로 secret을 사용하고 싶다면 저장하는 secret name을 다르게 저장할 수 밖에 없다.\n이를 job마다 동일한 이름으로 분류하고 싶다면 아래 내용인 Github Actions Environments를 보도록 하자.\nGithub Actions Environments github repository에 code and automation tab에 Environments를 사용하여 job마다 다른 github action environment를 참고할 수 있다. 즉, Environment마다 다른 secret 값을 가질 수 있다.\ngithub profile의 settings가 아닌 repository들어가 보이는 Settings 여야 한다.\n그러면 ’testing’에 사용하는 secrets를 만들어보자.\n위 이미지에서 ‘New environment’를 클릭하여 ’testing’ 을 입력하여 ’testing’이란 이름의 environment를 생성해보자. 생성 결과는 다음과 같다. 아래 이미지로 보면 타이틀 부분에 Configure testing이 생긴 걸 알 수 있다. 그리고 나서 DB_NAME, DB_USERNAME, DB_PASSWORD를 입력해보자. 이번에는 ‘deploy’를 입력하여 ‘deploy’란 이름의 environment를 생성해보자.\n생성된 environment 목록은 다음과 같다. 이 목록을 확인하기 위해서는 side bar의 Environments tab을 입력하면 확인할 수 있다. Security tab의 Actions으로 가서 Repository secrets에 있는 모든 secret을 삭제한다.\nworkflow에 입력하기 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 name: Demo on: push: branches: - main - dev env: DB_NAME: ${{secrets.DB_NAME}} jobs: test: # 추가하기 environment: testing # env: DB_USERNAME: ${{secrets.DB_USERNAME}} DB_PASSWORD: ${{secrets.DB_PASSWORD}} runs-on: ubuntu-latest steps: - name: Get code uses: actions/checkout@v3 - name: Cache dependencies uses: actions/cache@v3 with: path: ~/.npm key: deps-node-modules-${{ hashFiles('**/package-lock.json') }} - name: Install dependencies run: npm ci - name: Check DB information run: | echo \"DB_NAME: ${{ env.DB_NAME }}\" echo \"DB_USERNAME: $DB_USERNAME\" echo \"DB_PASSWORD: $DB_PASSWORD\" 특정 브랜치에 한해서 workflow 실행되기 ‘Selected branches’를 선택한 다음에 testing job을 실행할 branch를 입력한다.\n위 이미지에 따르면 main을 선택했다. 그러면 dev branch를 새로 파서 여기에 push를 해보자. 아래 이미지에 나온 것처럼 배포에 실패했다.\nReference [udemy lecture] Github Actions - The Complete Guide Manage workflow runs - skip workflow runs github actions - context Skipping workflow runs github actions events github actions cache github actions - Default environment variables ","wordCount":"2827","inLanguage":"en","datePublished":"2023-08-10T22:13:42+09:00","dateModified":"2023-08-10T22:13:42+09:00","author":[{"@type":"Person","name":"Me"}],"mainEntityOfPage":{"@type":"WebPage","@id":"http://jeha00.github.io/post/ci_cd/github_action/lecture_02/"},"publisher":{"@type":"Organization","name":"Jeha DevLog","logo":{"@type":"ImageObject","url":"http://jeha00.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://jeha00.github.io/ accesskey=h title="@Jeha00 (Alt + H)">@Jeha00</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://jeha00.github.io/me/ title=About><span>About</span></a></li><li><a href=http://jeha00.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=http://jeha00.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=http://jeha00.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://jeha00.github.io/>Home</a>&nbsp;»&nbsp;<a href=http://jeha00.github.io/post/>Posts</a></div><h1 class=post-title>CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets</h1><div class=post-meta>CI/CD&nbsp;·&nbsp;<span title='2023-08-10 22:13:42 +0900 KST'>August 10, 2023</span>&nbsp;·&nbsp;Me</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#0-introduction aria-label="0. Introduction">0. Introduction</a></li><li><a href=#1-activity-type-and-filters-%ed%95%99%ec%8a%b5%ed%95%98%ea%b8%b0 aria-label="1. Activity type and Filters 학습하기">1. Activity type and Filters 학습하기</a><ul><ul><li><a href=#types%eb%a5%bc-%ec%9e%85%eb%a0%a5%ed%95%98%eb%8a%94-3%ea%b0%80%ec%a7%80-%eb%b0%a9%ec%8b%9d%ea%b3%bc-types%ea%b0%80-%ec%a1%b4%ec%9e%ac%ed%95%a0-%eb%95%8c-%ec%97%ac%eb%9f%ac-event%eb%a5%bc-%ec%9e%85%eb%a0%a5%ed%95%98%eb%8a%94-%eb%b0%a9%ec%8b%9d aria-label="types를 입력하는 3가지 방식과 types가 존재할 때 여러 event를 입력하는 방식">types를 입력하는 3가지 방식과 types가 존재할 때 여러 event를 입력하는 방식</a></li><li><a href=#push%ec%97%90-%eb%8c%80%ed%95%9c-filter-%ec%a0%81%ec%9a%a9 aria-label="push에 대한 filter 적용">push에 대한 filter 적용</a></li><li><a href=#workflow-%ea%b2%bd%eb%a1%9c%ec%97%90-%eb%94%b0%eb%9d%bc-%ec%8b%a4%ed%96%89%ed%95%98%ea%b8%b0 aria-label="workflow 경로에 따라 실행하기">workflow 경로에 따라 실행하기</a></li><li><a href=#forked-pull-request-workflows aria-label="Forked Pull Request Workflows">Forked Pull Request Workflows</a></li><li><a href=#%ec%a7%84%ed%96%89-%ec%a4%91%ec%9d%b8-workflow-%ec%b7%a8%ec%86%8c%ed%95%98%ea%b8%b0 aria-label="진행 중인 workflow 취소하기">진행 중인 workflow 취소하기</a></li><li><a href=#workflow-skip-%ed%95%98%ea%b8%b0 aria-label="workflow skip 하기">workflow skip 하기</a></li></ul></ul></li><li><a href=#2-job-data--outputs--caching aria-label="2. Job Data &amp;amp; Outputs &amp;amp; Caching">2. Job Data & Outputs & Caching</a><ul><li><a href=#what-is-job-artifacts aria-label="What is Job Artifacts">What is Job Artifacts</a></li><li><a href=#job-artifacts%eb%a5%bc-%ec%97%85%eb%a1%9c%eb%94%a9%ed%95%98%ea%b8%b0 aria-label="Job artifacts를 업로딩하기">Job artifacts를 업로딩하기</a></li><li><a href=#artifacts%ec%99%80-job-outputs aria-label="Artifacts와 Job Outputs">Artifacts와 Job Outputs</a><ul><li><a href=#build-job%ec%9d%98-publish-js-filename-step aria-label="build job의 Publish JS filename step">build job의 Publish JS filename step</a></li></ul></li><li><a href=#%eb%8b%a4%eb%a5%b8-job%ec%9d%98-output-%ec%9d%b4%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="다른 job의 output 이용하기">다른 job의 output 이용하기</a></li><li><a href=#cache%eb%a5%bc-%ec%82%ac%ec%9a%a9%ed%95%98%ec%97%ac-dependency-%ec%84%a4%ec%b9%98-%ec%8b%9c%ea%b0%84%ec%9d%84-%eb%8b%a8%ec%b6%95%ec%8b%9c%ed%82%a4%ea%b8%b0 aria-label="cache를 사용하여 Dependency 설치 시간을 단축시키기">cache를 사용하여 Dependency 설치 시간을 단축시키기</a></li><li><a href=#summary aria-label=Summary>Summary</a><ul><li><a href=#artifacts aria-label=Artifacts>Artifacts</a></li><li><a href=#outputs aria-label=Outputs>Outputs</a></li><li><a href=#caching aria-label=caching>caching</a></li></ul></li></ul></li><li><a href=#3-enviroment-variables--secrets-%ec%82%ac%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="3. Enviroment variables &amp;amp; Secrets 사용하기">3. Enviroment variables & Secrets 사용하기</a><ul><li><a href=#environments-variables aria-label="Environments variables">Environments variables</a><ul><li><a href=#workflow-job-step%ec%97%90-%eb%8c%80%ed%95%b4%ec%84%9c-%ed%99%98%ea%b2%bd-%eb%b3%80%ec%88%98-%ec%84%a0%ec%96%b8%ed%95%98%ea%b8%b0 aria-label="workflow, job, step에 대해서 환경 변수 선언하기">workflow, job, step에 대해서 환경 변수 선언하기</a></li><li><a href=#%ed%99%98%ea%b2%bd-%eb%b3%80%ec%88%98-%ec%82%ac%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="환경 변수 사용하기">환경 변수 사용하기</a></li></ul></li><li><a href=#secrets-%ec%82%ac%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="Secrets 사용하기">Secrets 사용하기</a><ul><li><a href=#job%eb%a7%88%eb%8b%a4-%ea%b0%99%ec%9d%80-%ec%9a%a9%eb%8f%84%ec%a7%80%eb%a7%8c-%eb%8b%a4%eb%a5%b8-%ea%b0%92%ec%9d%84-%ea%b0%80%ec%a7%84-secret-%ec%82%ac%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="Job마다 같은 용도지만 다른 값을 가진 secret 사용하기">Job마다 같은 용도지만 다른 값을 가진 secret 사용하기</a></li></ul></li><li><a href=#github-actions-environments aria-label="Github Actions Environments">Github Actions Environments</a><ul><li><a href=#workflow%ec%97%90-%ec%9e%85%eb%a0%a5%ed%95%98%ea%b8%b0 aria-label="workflow에 입력하기">workflow에 입력하기</a></li><li><a href=#%ed%8a%b9%ec%a0%95-%eb%b8%8c%eb%9e%9c%ec%b9%98%ec%97%90-%ed%95%9c%ed%95%b4%ec%84%9c-workflow-%ec%8b%a4%ed%96%89%eb%90%98%ea%b8%b0 aria-label="특정 브랜치에 한해서 workflow 실행되기">특정 브랜치에 한해서 workflow 실행되기</a></li></ul></li></ul></li><li><a href=#reference aria-label=Reference>Reference</a></li></ul></div></details></div><div class=post-content><h1 id=0-introduction>0. Introduction<a hidden class=anchor aria-hidden=true href=#0-introduction>#</a></h1><ul><li><a href=https://jeha00.github.io/post/ci_cd/github_action/lecture_01/>CI/CD를 위한 github action study basic</a></li></ul><p>프로젝트를 진행하면서 새로 작성된 또는 수정된 코드를 repository에 push하면 자동적으로 테스트를 실행하고, 통과되면 합쳐지고 아니면 에러를 발생시키는 workflow를 적용하고 싶어서 예전부터 공부하고 싶었던 github action에 대해 study를 시작한다.</p><p>국내에서는 github action에 대한 강의나 서적을 찾지 못하여 멘토링을 찾았지만 시간 대비 너무 비싸서 포기했다. 그래서 udemy를 찾던 중 저렴한 가격에 좋은 퀄리티 강의를 찾게 되어 이 강의를 중심으로 학습을 진행한다.</p><p>해당 강좌에서 사용되는 소스 코드를 사용하는 부분들은 빼고 블로그에 정리한다.</p><p>해당 소스 코드를 사용하는 부분이 있다면 그 부분이 없어도 해당 블로그만 봐도 익힐 수 있도록 정리해놓는다.</p><p>이미 알고 있는 개념들도 있지만, 놓치고 있는 부분을 확인하고자 정리해본다.</p><p>🔆 첨부된 링크는 구글에 <code>github actions {keyword}</code> 로 입력하면 제일 첫 번째로 나온다.</p><p> </p><h1 id=1-activity-type-and-filters-학습하기>1. Activity type and Filters 학습하기<a hidden class=anchor aria-hidden=true href=#1-activity-type-and-filters-학습하기>#</a></h1><hr><p>지난 학습을 통해서 <code>on: [push, workflow_dispatch]</code>로 events를 정의해놓으면 모든 push마다 workflow가 진행된다는 걸 알게 되었다.</p><p>그런데 이를 보다 더 정밀하게 event를 정의하고 싶다면 어떻게 해야할까?</p><p>그럴 때는 Activity type 또는 filter를 적용해야 한다. event의 Activity types 과 filters에 대해 알아보자.</p><p>Activity type에는 예를 들어서 event가 pull_request라면 activity type에는 opened, closed, edited 가 존재한다.</p><p>Filters는 push event라고 한다면 target branch에 대해 조건을 걸 수 있다.</p><ul><li><a href=https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull_request>github actions events</a>를 보면 여러 event와 activity type가 나와있다. 해당 event를 사용할 때는 <code>Note</code>를 반드시 읽어보도록 하자.</li></ul><h3 id=types를-입력하는-3가지-방식과-types가-존재할-때-여러-event를-입력하는-방식>types를 입력하는 3가지 방식과 types가 존재할 때 여러 event를 입력하는 방식<a hidden class=anchor aria-hidden=true href=#types를-입력하는-3가지-방식과-types가-존재할-때-여러-event를-입력하는-방식>#</a></h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Events Demo 1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>pull_request</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># types를 입력하는 3가지 방식: 반드시 types 이어야 한다. </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>types</span>: [<span style=color:#ae81ff>opened, edited]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>types</span>: <span style=color:#ae81ff>opened</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>types</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>opened</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>workflow_dispatch</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>...</span>
</span></span></code></pre></td></tr></table></div></div><p>그러면 아래와 같이 작성했다고 하면 수동적으로 실행했을 때와 PR을 open했을 때 workflow가 진행된다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Events Demo 1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>pull_request</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>types</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>opened</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>workflow_dispatch</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>...</span>
</span></span></code></pre></td></tr></table></div></div><p>아래 이미지를 통해 실행되는 걸 확인할 수 있다.</p><p><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/4594b9e1-9536-482f-99a2-ff3cd661ad55 alt=image></p><p>하지만 <code>types: closed</code> 인 경우에는 PR이 닫혀지고 나서 실행된다.</p><p>이처럼 types를 무엇으로 지정하냐에 따라서 workflow 진행 유무 기준을 구체적으로 정할 수 있다.</p><h3 id=push에-대한-filter-적용>push에 대한 filter 적용<a hidden class=anchor aria-hidden=true href=#push에-대한-filter-적용>#</a></h3><p>push를 할 때 내가 원하는 branch와 원하는 경로에 들어올 때만 실행하는 방법도 있다.</p><p>push keyword에 <code>branches</code> keyword를 입력해보자.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Events Demo 1 </span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>            - <span style=color:#e6db74>&#39;dev-*&#39;</span>
</span></span><span style=display:flex><span>            - <span style=color:#e6db74>&#39;feat/**&#39;</span>  
</span></span></code></pre></td></tr></table></div></div><p>위 workflow의 의미는 다음과 같다.</p><ul><li>main branch와</li><li><code>dev-</code>로 시작하는 branch와</li><li><code>feat/</code> 로 시작하는 branch
위 3가지 branch에 push를 할 경우에만 workflow를 실행한다.</li></ul><p>만약 <code>feature/</code> 로 시작한다면 실행되지 않는다.</p><h3 id=workflow-경로에-따라-실행하기>workflow 경로에 따라 실행하기<a hidden class=anchor aria-hidden=true href=#workflow-경로에-따라-실행하기>#</a></h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Events Demo 1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>: 
</span></span><span style=display:flex><span>    <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>paths-ignore</span>:
</span></span><span style=display:flex><span>            - <span style=color:#e6db74>&#39;.github/workflows/*&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Output event data</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;${{toJSON(github.event)}}&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Get code</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v3 </span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Install dependencies</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm ci</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Test code</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm run test</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build code </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm run build </span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy project</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;Deploying...&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>이 상황에서 만약 main branch로 push를 할 경우 Events Demo 1은 실행되지 않는다.</p><h3 id=forked-pull-request-workflows>Forked Pull Request Workflows<a hidden class=anchor aria-hidden=true href=#forked-pull-request-workflows>#</a></h3><p>만약 누군가 repository를 fork하고 main branch에 push할 경우, forked repository가 아닌 원래 repository에서 경고 표시로 workflow 가 뜨면서 진행되지 않는다.</p><p>이렇게 된 이유는 모든 사람들이 repository를 fork할 수 있는데, 악의적으로 workflow를 실행시켜서 cost를 과도하게 유발시키 수 있기 때문에, forked repository에서 main으로 push한 경우에는 바로 workflow가 진행되지 않는다.</p><h3 id=진행-중인-workflow-취소하기>진행 중인 workflow 취소하기<a hidden class=anchor aria-hidden=true href=#진행-중인-workflow-취소하기>#</a></h3><p>기본적으로 workflow가 진행 중이다가 실패하면 workflow는 당연히 취소된다.</p><p>또한, 수동적으로 직접 workflow를 취소할 수도 있다.</p><p>아래 이미지의 오른쪽 위를 보면 <code>Cancel workflow</code> button을 통해서 중지할 수 있다.</p><p><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/891aa483-1cc9-4ad4-b90e-c61f33e334f8 alt=image></p><h3 id=workflow-skip-하기>workflow skip 하기<a hidden class=anchor aria-hidden=true href=#workflow-skip-하기>#</a></h3><p>참고할 공식 문서는 <a href=https://docs.github.com/en/actions/managing-workflow-runs/skipping-workflow-runs>여기</a> 다.</p><p>위 문서에 따르면 commit message를 작성할 때 다음 메세지를 작성하면 된다.</p><ul><li><code>[skip ci]</code></li><li><code>[ci skip]</code></li><li><code>[no ci]</code></li><li><code>[skip actions]</code></li><li><code>[actions skip]</code></li></ul><p>그러면 main branch에 push는 했지만 github actions는 실행되지 않는 걸 확인할 수 있다.</p><p> </p><h1 id=2-job-data--outputs--caching>2. Job Data & Outputs & Caching<a hidden class=anchor aria-hidden=true href=#2-job-data--outputs--caching>#</a></h1><hr><h2 id=what-is-job-artifacts>What is Job Artifacts<a hidden class=anchor aria-hidden=true href=#what-is-job-artifacts>#</a></h2><p>Job Artifacts란 Job에 의해 생긴 결과물로 예를 들어서 log file이나 website files 등이 있다.</p><p>이 Job Artifacts를 Github UI나 REST API를 사용하여 수동적으로 다운받아 사용하는 방식이 있고 Job을 통해 Action으로 Job Artifacts를 다운받고 사용하는 방식이 있다.</p><p>예를 들어서 <code>npm run build</code>로 실행하여 생긴 dist folder는 build job에 의해서 생긴 artifacts다.</p><p>그러면 이 Artifacts를 upload 및 download 하도록 해보자.</p><p>이 작업이 필요한 이유는 <strong><em>각 job 단계에서의 runner machine은 다르기 때문에 같은 runner machine 정의를 가진다고 해도 각 runner machine에서는 그 파일을 가지고 있지 않는다. 그래서 job이 build -> deploy 순서로 존재한다고 할 때 build 단계에서 업로드한 파일을 deploy 단계에서 가지기 위해서는 &lsquo;다운로드&rsquo;를 진행해야 한다. 그리고 이를 위해서 업로딩이 필요하다.</em></strong></p><h2 id=job-artifacts를-업로딩하기>Job artifacts를 업로딩하기<a hidden class=anchor aria-hidden=true href=#job-artifacts를-업로딩하기>#</a></h2><p>이 Actions를 통해 생긴 결과물인 Job artifacts를 사용할 수 있다. workflow를 다음과 같이 작성한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deployment Exercise 2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>: 
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>main  </span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>needs</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Get code</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v3</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Install dependencies</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm ci</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build website  </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm run build</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 이 부분을 추가</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Upload artifacts    </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/upload-artifact@v3  </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dist-files  </span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>path</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            dist
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            package.json  </span>            
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># package.json은 경로를 여러 개 입력하는 방법을 보여주기 위해 입력한 예시</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>needs</span>: <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>...</span>
</span></span></code></pre></td></tr></table></div></div><p>아래 이미지처럼 Artifacts가 생성된다. 이를 클릭하면 수동으로 다운 받을 수 있다.</p><p><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/79c4e698-656a-4688-af67-38d14ff18d41 alt=image></p><p>자동으로 다운받아지기 위해서는 <code>deploy</code> job 단계에서 다운받는 step을 추가한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>...
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>needs</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 이 부분을 추가</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Upload artifacts    </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/upload-artifact@v3  </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dist-files  </span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 이 부분은 수정한다.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#   path: |</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#     dist</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#     package.json  </span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>path</span>: <span style=color:#ae81ff>dist</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>needs</span>: <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># 추가한 단계</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Get build artifacts </span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/download-artifact@v3 </span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dist-files  </span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Output contents</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>run</span>: <span style=color:#ae81ff>ls  </span>
</span></span><span style=display:flex><span>            - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;Deploying...&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>아래 이미지를 보면 Output contents step 단계에서 ls를 실행하여 파일 목록을 확인했다.</p><p><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/961cdee2-31d4-42e2-8e28-e61dfef6e182 alt=image></p><p>다운로드 시 Github에서 제공하는 Action을 사용하여 할 수 있다. 이 때 설정을 추가해야 한다. 업로드 했던 파일의 이름을 <code>name</code> key로 value를 입력한다. 그러면 deploy job이 실행되는 folder 안에 dist-files 내부 파일들이 바로 담겨진다.</p><h2 id=artifacts와-job-outputs>Artifacts와 Job Outputs<a hidden class=anchor aria-hidden=true href=#artifacts와-job-outputs>#</a></h2><p>&lsquo;Artifacts&rsquo;는 log file이나 website files로 사용된다면 &lsquo;Job Outputs&rsquo;는 순차적으로 일어나는 다음 job 들에 사용되는 값들을 말한다. 예를 들어서 이전 step 단계에서 생성된 파일의 이름을 말한다. 그러면 Job Outputs를 확인해보자.</p><p>아래 yml은 Job Output을 이용하는 workflow다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Demo</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>main  </span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>: 
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>needs</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 추가한 key: outputs</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>outputs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>script-file</span>:  <span style=color:#ae81ff>${{ steps.publish.outputs.file-name }}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 추가한 step</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Publish JS filename  </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>id</span>: <span style=color:#ae81ff>publish</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>find dist/assets/*.js -type f -execdir echo &#39;file-name={}&#39; &gt;&gt; $GITHUB_OUTPUT &#39;;&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>needs</span>: <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 추가한 steps  </span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Needs </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;${{ needs }}&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;${{ needs.build }}&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Output </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;${{ needs.build.outputs}}&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Output filename </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;${{ needs.build.outputs.script-file }}&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;Deploying...&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=build-job의-publish-js-filename-step>build job의 Publish JS filename step<a hidden class=anchor aria-hidden=true href=#build-job의-publish-js-filename-step>#</a></h3><ul><li><p><code>steps</code>라는 context name은 아래 공식문서에서와 같은 의미를 가지고 있어서 steps를 통해 해당 step의 정보를 얻을 수 있다.</p><ul><li><strong><em>Information about the steps that have been run in the current job.</em></strong></li></ul></li><li><p>위 단계에서 아래 command를 실행했다.</p></li><li><p><code>find dist/assets/*.js -type f -execdir echo 'file-name={}' >> $GITHUB_OUTPUT ';'</code></p></li><li><p>위 명령어의 의미는 다음과 같다.</p><ul><li><code>dist/assets/*.js</code>인 데이터를 찾는데, 이 데이터의 타입은 <code>f</code>로 파일이고,</li><li><code>execdir</code>을 사용해서 해당 파일이 있는 경로에서 <code>echo</code> 커맨드를 실행한다.</li><li><code>file-name</code> key에 해당하는 value를 $GITHUB_OUTPUT에 저장한다.</li><li>$GITHUB_OUTPUT은 <code>outputs</code>에 선언된 key 값에 연결된다. <code>file-name</code> key의 value에 저장된다.</li><li><code>script-file</code>이 <code>file-name</code>을 가리키기 때문에 <code>script-file</code>에 저장된다.</li></ul></li></ul><h2 id=다른-job의-output-이용하기>다른 job의 output 이용하기<a hidden class=anchor aria-hidden=true href=#다른-job의-output-이용하기>#</a></h2><p>deploy job을 보면 여러 개의 환경 변수들을 출력하고 있다</p><ul><li>needs, needs.build, needs.build.outputs, needs.build.outputs.script-file</li></ul><p>아래 image를 보면 해당 step name 별로 출력된 결과를 볼 수 있다.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/43799a52-5703-42c8-b488-67acd3835d6f#center width=50%></figure><p><code>needs.build.outputs.script-file</code>로 적어뒀던 Output filename step만 다른 값을 출력한 걸 확인할 수 있다.</p><p>이처럼 github output에 값을 담아두면 다른 job에서도 꺼내서 사용할 수 있는 걸 알 수 있다.</p><p>그리고, <strong><em>Artifacts와 outputs의 차이</em></strong> 를 확실히 알게 되었다. Artifacts는 외부에서 다운받을 수 있는 결과물이지만, outputs는 단순한 값이라는 걸 확인했다.</p><h2 id=cache를-사용하여-dependency-설치-시간을-단축시키기>cache를 사용하여 Dependency 설치 시간을 단축시키기<a hidden class=anchor aria-hidden=true href=#cache를-사용하여-dependency-설치-시간을-단축시키기>#</a></h2><p>여태 실습한 workflow는 간단하기 때문에 1분 내외지만 복잡한 workflow를 하게 되면서 시간이 많이 걸리게 된다.</p><p>이번 섹션에서는 이 workflow 실행 시간을 줄이는 것에 초점을 둔다.</p><p>실행 시간을 줄이는 방법 중 하나는 각 Step 마다 반복되는 부분을 빠르게 진행하는 것이다.</p><p>반복되는 부분을 확인해보자.</p><ul><li><p>Test job: Get code => Install Dependencies => Test App</p></li><li><p>Build job: Get code => Install Dependencies => Build Project</p></li></ul><p>여러 step 중에서 <code>Get code</code> 부분이 반복된다. 하지만 이 부분은 &lsquo;1s&rsquo; 밖에 걸리지 않기 때문에 이는 많이 느리지 않는다.</p><p>또한, <code>Install dependencies</code> 부분이 반복된다. 이 부분은 &rsquo;12s&rsquo;나 걸리기 때문에 많이 느리다.</p><p>그렇다면 dependencies 를 설치할 때 매 step마다 달라지는가? 얼마나 달라지는가?</p><p>dependencies는 자주 바뀌지 않는다. 그렇기 때문에 이 부분을 공통적으로 사용해도 문제가 없다. 이 부분을 단축한다면 전체 workflow 실행 시간이 줄어들 것이다. dependencies를 설치하는 부분의 시간을 &lsquo;cache&rsquo; 를 사용하여 단축해보자.</p><p>각 job마다 실행되는 runner (os)가 다른데 어떻게 cache를 사용할 수 있을까?</p><p><a href=https://github.com/actions/cache>github actions - cache</a> 를 사용하여 해당 job이 끝나면 지정한 폴더 또는 파일을 저장하여 다른 job이 실행될 때 이를 꺼내서 사용하는 방식으로 cache가 저장 및 사용된다.</p><p>코드는 다음과 같다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>: 
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Get code</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v3</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 추가된 코드</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Cache dependencies</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/cache@v3  </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>path</span>: <span style=color:#ae81ff>~/.npm</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>key</span>: <span style=color:#ae81ff>deps-node-modules-${{ hashFiles(&#39;**/package-lock.json&#39;) }}  </span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Install dependencies</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm ci</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Lint code</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm run lint  </span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Test code</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm run test</span>
</span></span></code></pre></td></tr></table></div></div><p>위 추가된 코드에 대해 설명하자면</p><ul><li><p><code>~/.npm</code>은 npm 에서 생성한 자체 cache folder인데, 이 folder를 actions를 사용하여 다른 workflow 또는 job 공용으로 사용하기 위해 github server에 있는 github cloud에 저장한다.</p></li><li><p>key는 미래에 이 cache data를 가져올 때 필요하다.</p></li><li><p>hashFiles를 사용한 이유는 혹시 dependency가 업데이트되었을 때, 중복되면 않되기 때문에 고유 식별자 역할을 하기 위해 사용한다.</p></li><li><p><code>**/package-lock.json</code> 인 이유는 경로 상관없이 package-lock.json을 저장할 것이기 때문이다.</p></li></ul><p>test job에 작성된 <code>Cache dependencies</code>를 다음 단계 job인 build에도 추가한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>needs</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>outputs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>script-file</span>:  <span style=color:#ae81ff>${{ steps.publish.outputs.file-name }}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Get code</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v3</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># add code</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Cache dependencies</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/cache@v3  </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>path</span>: <span style=color:#ae81ff>~/.npm</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>key</span>: <span style=color:#ae81ff>deps-node-modules-${{ hashFiles(&#39;**/package-lock.json&#39;) }}  </span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Install dependencies</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm ci</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>...</span>
</span></span></code></pre></td></tr></table></div></div><p>그러면 실행 결과를 확인해보자. 아래 이미지는 <code>test</code> job에서의 이미지다.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/5687fcc8-a0aa-462f-b043-f476da3066e3#center width=80%></figure><p>Cache dependencies 단계에서는 해당 key를 발견할 수 없다고 떴지만 Post Cache dependencies 단계에서 해당 key 값으로 cache에 저장된 걸 알 수 있다.</p><p>위 이미지에서는 안보이지만 test job에서 Install dependencies 단계에서는 &rsquo;11s&rsquo;가 걸렸다.</p><p>그러면 <code>test</code> 다음 job인 <code>build</code> job일 때 설치 시간, Cache dependencies를 확인해보자.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/a3e2a328-e38a-405b-ae99-8f2468a28f49#center width=90%></figure><ul><li><p>Cache dependencies 단계에서 다음 메세지를 확인할 수 있다.</p><ul><li><code>cache restored from key: deps-node-modules-...</code></li></ul></li><li><p>test 단계에서는 해당 key를 발견할 수 없다고 떴지만, 그 다음 build 단계에서는 해당 key로 cache에서 꺼낸 걸 알 수 있다.</p></li><li><p>그리고 그 다음 step인 Install dependencies 단계의 설치 시간은 &lsquo;5s&rsquo;로 줄어든 걸 확인할 수 있다.</p></li></ul><p>다른 workflow에도 똑같은 Install dependencies step이 존재한다면 실행 시간이 짧아진 거를 확인할 수 있을 것이다.</p><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><h3 id=artifacts>Artifacts<a hidden class=anchor aria-hidden=true href=#artifacts>#</a></h3><ul><li><strong>Job</strong> 실행에 의한 결과물로 공유되거나 분석될 수 있다.</li><li>Artifacts 또는 Job artifacts라고 불린다.</li><li>Github Actions에서 제공하는 action을 통해 uploading 과 downloading을 제공한다.</li></ul><h3 id=outputs>Outputs<a hidden class=anchor aria-hidden=true href=#outputs>#</a></h3><ul><li><p><strong>Steps</strong> 실행에 의해 생성된 결과물이고 단순한 값들이며, Job 간에 공유될 수 있다.</p></li><li><p>&lsquo;steps&rsquo; context를 통해서 Jobs들은 이를 사용 및 공유할 수 있다.</p></li><li><p><code>echo '{output-name}={output-value}' >> $GITHUB_OUTPUT</code> 명령어로 key-value로 저장한다.</p></li><li><p>위 command를 사용하는 step의 경우 <code>id</code>를 key를 입력해야 한다.</p></li><li><p>다른 job에서 이를 사용할 경우, <code>steps.{step_id}.outputs.{key}</code>로 사용가능하다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>needs</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>outputs</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>script-file</span>:  <span style=color:#ae81ff>${{ steps.publish.outputs.file-name }}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Publish JS filename  </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>id</span>: <span style=color:#ae81ff>publish</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>find dist/assets/*.js -type f -execdir echo &#39;file-name={}&#39; &gt;&gt; $GITHUB_OUTPUT &#39;;&#39;</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=caching>caching<a hidden class=anchor aria-hidden=true href=#caching>#</a></h3><ul><li>반복되고, 느린 step들의 속도를 증가시킬 수 있다.</li><li>전형적으로 사용되는 경우는 dependency 설치지만, 어느 파일과 폴더 모두 가능하다.</li><li>❗️ 하지만 artifacts를 caching하여 사용하지 말자. 용량이 크다.</li></ul><p> </p><hr><h1 id=3-enviroment-variables--secrets-사용하기>3. Enviroment variables & Secrets 사용하기<a hidden class=anchor aria-hidden=true href=#3-enviroment-variables--secrets-사용하기>#</a></h1><p>왜 github actions에 환경 변수가 필요할까? 왜냐하면 tesing 시 db와 production 시 db에 대한 password가 다른데 이를 환경 설정으로 다르게 해야 workflow를 진행 시 의도한 대로 정확하게 진행할 수 있기 때문이다.</p><h2 id=environments-variables>Environments variables<a hidden class=anchor aria-hidden=true href=#environments-variables>#</a></h2><p>code 상에서 사용할 수 있는 동적 값으로 다음과 같이 workflow 전체 범위로도, 해당 Job에 대해서만으로도, step에 대해서만으로도 할 수 있다. 환경 변수를 사용하기 위해서는 <code>env</code> 라는 내장 키워드를 통해서 접근할 수 있다.</p><h3 id=workflow-job-step에-대해서-환경-변수-선언하기>workflow, job, step에 대해서 환경 변수 선언하기<a hidden class=anchor aria-hidden=true href=#workflow-job-step에-대해서-환경-변수-선언하기>#</a></h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># on과 같은 level에서 선언: workflow 전체 범위로 선언</span>
</span></span><span style=display:flex><span><span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>DB_NAME</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># 해당 job에 대해서만 선언  </span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>DB_USERNAME</span>: <span style=color:#ae81ff>project</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DB_PASSWORD</span>: <span style=color:#ae81ff>1234</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># 해당 step에 대해서만 선언  </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>APPLE</span>: <span style=color:#ae81ff>1234</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>:
</span></span></code></pre></td></tr></table></div></div><ul><li>위 코드에서 &lsquo;DB_NAME&rsquo;은 workflow 전체 범위로 선언한 이유는 db name은 test이든 production이든 잘 변하지 않기 때문이다.</li></ul><h3 id=환경-변수-사용하기>환경 변수 사용하기<a hidden class=anchor aria-hidden=true href=#환경-변수-사용하기>#</a></h3><p>그러면 환경 변수를 사용하기 위해 workflow를 작성해보자.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Demo</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>main  </span>
</span></span><span style=display:flex><span><span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>DB_NAME</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>DB_USERNAME</span>: <span style=color:#ae81ff>project</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DB_PASSWORD</span>: <span style=color:#ae81ff>1234</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>: 
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 추가된 코드</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Check DB information</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;DB_NAME: ${{ env.DB_NAME }}&#34; 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;DB_USERNAME: $DB_USERNAME&#34; 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;DB_PASSWORD: $DB_PASSWORD&#34; </span>          
</span></span><span style=display:flex><span>      <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>needs</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>outputs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>script-file</span>:  <span style=color:#ae81ff>${{ steps.publish.outputs.file-name }}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 추가된 코드  </span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Check DB information</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;DB_NAME: ${{ env.DB_NAME }}&#34; 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;DB_USERNAME: $DB_USERNAME&#34; 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;DB_PASSWORD: $DB_PASSWORD&#34; </span>          
</span></span><span style=display:flex><span>      <span style=color:#75715e>#</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>DB_NAME은 workflow 전역으로 선언</li><li>DB_USERNAME, DB_PASSWORD는 job 범위로 선언</li></ul><p>위 코드를 실행한 결과 중 test job의 실행 결과는 다음과 같다.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/df6ed0aa-8b20-42b2-953c-be0f0c37861f#center width=60%></figure><p>모든 값이 다 출력되었고, 일치한다.</p><p>그러면 build job의 실행 결과를 확인해보자.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/4a386553-ea05-48af-ad66-ef17552ea3b1#center width=60%></figure><p>workflow level에서 선언한 DB_NAME만 출력되고 다른 job에서 선언했던 DB_USERNAME과 DB_PASSWORD는 출력되지 않은 걸 알 수 있다.</p><p>위 결과 workflow level에서 선언한 환경 변수에 접근하기 위해서는 <code>${{env.{key name}}}</code>을 사용하여 접근하면 되고, job 내에서 선언한 환경변수는 <code>$key_name</code>을 통해 접근하면 된다는 걸 확인했다.</p><h2 id=secrets-사용하기>Secrets 사용하기<a hidden class=anchor aria-hidden=true href=#secrets-사용하기>#</a></h2><p>Environment variables 처럼 동적 값이지만 노출되지 않아야 하는 값들은 Secrets으로 사용하면 된다. 예를 들어 API key, db 관련 정보들이 해당된다. 이 값을 사용하기 위해서는 <code>secrets</code> 라는 내장 키워드를 통해서 사용될 수 있다.</p><p>github에는 이러한 secrets를 저장할 공간이 존재한다. Github 해당 repository -> Settings tab -> Security 의 Actions에 접근하면 아래 이미지 화면을 확인할 수 있다.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/b214fbe9-0320-4e84-ae88-5bb15af8515a#center width=80%></figure><p>위 화면을 확인했다면 secret을 추가하기 위해서 위 &lsquo;New repository secret&rsquo; 버튼을 클릭하여 추가한다.</p><p>예를 들어 <code>DB_NAME: test</code> 를 추가하고 싶다면 위 버튼을 클릭 후 &lsquo;Name&rsquo;에는 &lsquo;DB_NAME&rsquo;을 입력하고, &lsquo;Secret&rsquo;에 &rsquo;test&rsquo;를 입력한다. 추가하면 다음 이미지처럼 확인할 수 있다.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/bd6d1a0a-0f74-4e7a-922d-033f2720d9ce#center width=80%></figure><p>그러면 <code>DB_USERNAME: project</code>와 <code>DB_PASSOWRD: 1234</code>도 다 추가해보자. 그 다음에 secrets으로부터 값을 가져오기 위해서 해당 workflow의 env를 다음과 같이 수정한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>DB_NAME</span>: <span style=color:#ae81ff>${{secrets.DB_NAME}}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>DB_USERNAME</span>: <span style=color:#ae81ff>${{secrets.DB_USERNAME}}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DB_PASSWORD</span>: <span style=color:#ae81ff>${{secrets.DB_PASSOWRD}}</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>...</span>
</span></span></code></pre></td></tr></table></div></div><p>위와 같이 수정된 후 실행 결과를 확인해보면 이전과 달리 &lsquo;*&rsquo; 라는 문자로 값이 드러나지 않는 걸 확인할 수 있다.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/43730534-a616-4f22-9fe2-a3839ecb5d77#center width=80%></figure><h3 id=job마다-같은-용도지만-다른-값을-가진-secret-사용하기>Job마다 같은 용도지만 다른 값을 가진 secret 사용하기<a hidden class=anchor aria-hidden=true href=#job마다-같은-용도지만-다른-값을-가진-secret-사용하기>#</a></h3><p>위 소제목에 나온 대로 secret을 사용하고 싶다면 저장하는 secret name을 다르게 저장할 수 밖에 없다.</p><p>이를 job마다 동일한 이름으로 분류하고 싶다면 아래 내용인 Github Actions Environments를 보도록 하자.</p><h2 id=github-actions-environments>Github Actions Environments<a hidden class=anchor aria-hidden=true href=#github-actions-environments>#</a></h2><p>github repository에 <code>code and automation</code> tab에 <code>Environments</code>를 사용하여 job마다 다른 github action environment를 참고할 수 있다. 즉, Environment마다 다른 secret 값을 가질 수 있다.</p><p>github profile의 settings가 아닌 repository들어가 보이는 Settings 여야 한다.</p><p><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/e80b3569-a43b-4975-a1c8-1f9a2551474c alt=image></p><p>그러면 &rsquo;testing&rsquo;에 사용하는 secrets를 만들어보자.</p><ol><li>위 이미지에서 &lsquo;New environment&rsquo;를 클릭하여 &rsquo;testing&rsquo; 을 입력하여 &rsquo;testing&rsquo;이란 이름의 environment를 생성해보자.</li></ol><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/fe8c4082-ba99-4ade-91e6-3af3808cabba#center width=80%></figure><ol start=2><li>생성 결과는 다음과 같다. 아래 이미지로 보면 타이틀 부분에 <code>Configure testing</code>이 생긴 걸 알 수 있다. 그리고 나서 DB_NAME, DB_USERNAME, DB_PASSWORD를 입력해보자.</li></ol><p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/58a01851-8d4f-4c60-85bb-c5351fc5d4bc#center width=80%></figure><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/85565592-a5c1-421d-a104-27f6fddac2f8#center width=80%></figure></p><ol start=3><li><p>이번에는 &lsquo;deploy&rsquo;를 입력하여 &lsquo;deploy&rsquo;란 이름의 environment를 생성해보자.</p></li><li><p>생성된 environment 목록은 다음과 같다. 이 목록을 확인하기 위해서는 side bar의 <code>Environments</code> tab을 입력하면 확인할 수 있다.<figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/9c0bc292-96bd-4068-80cc-4c4c19cc1697#center width=80%></figure></p></li><li><p>Security tab의 Actions으로 가서 Repository secrets에 있는 모든 secret을 삭제한다.</p></li></ol><h3 id=workflow에-입력하기>workflow에 입력하기<a hidden class=anchor aria-hidden=true href=#workflow에-입력하기>#</a></h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Demo</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>main </span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>dev </span>
</span></span><span style=display:flex><span><span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>DB_NAME</span>: <span style=color:#ae81ff>${{secrets.DB_NAME}}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># 추가하기</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>: <span style=color:#ae81ff>testing </span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>DB_USERNAME</span>: <span style=color:#ae81ff>${{secrets.DB_USERNAME}}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DB_PASSWORD</span>: <span style=color:#ae81ff>${{secrets.DB_PASSWORD}}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>: 
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Get code</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v3</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Cache dependencies</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/cache@v3  </span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>path</span>: <span style=color:#ae81ff>~/.npm</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>key</span>: <span style=color:#ae81ff>deps-node-modules-${{ hashFiles(&#39;**/package-lock.json&#39;) }}  </span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Install dependencies</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm ci</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Check DB information</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;DB_NAME: ${{ env.DB_NAME }}&#34; 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;DB_USERNAME: $DB_USERNAME&#34; 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;DB_PASSWORD: $DB_PASSWORD&#34; </span>          
</span></span></code></pre></td></tr></table></div></div><h3 id=특정-브랜치에-한해서-workflow-실행되기>특정 브랜치에 한해서 workflow 실행되기<a hidden class=anchor aria-hidden=true href=#특정-브랜치에-한해서-workflow-실행되기>#</a></h3><p>&lsquo;Selected branches&rsquo;를 선택한 다음에 testing job을 실행할 branch를 입력한다.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/4a2b5503-28c9-450a-bf06-95c38d467791#center width=80%></figure><p>위 이미지에 따르면 main을 선택했다. 그러면 dev branch를 새로 파서 여기에 push를 해보자. 아래 이미지에 나온 것처럼 배포에 실패했다.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/ee591318-a04e-46fa-bce9-8384fdcbbdb2#center width=80%></figure><p> </p><hr><h1 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h1><ul><li><a href=https://www.udemy.com/course/github-actions-the-complete-guide/>[udemy lecture] Github Actions - The Complete Guide</a></li><li><a href=https://docs.github.com/en/actions/managing-workflow-runs/skipping-workflow-runs>Manage workflow runs - skip workflow runs</a></li><li><a href=https://docs.github.com/en/actions/learn-github-actions/contexts>github actions - context</a></li><li><a href=https://docs.github.com/en/actions/managing-workflow-runs/skipping-workflow-runs>Skipping workflow runs</a></li><li><a href=https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull_request>github actions events</a></li><li><a href=https://github.com/actions/cache>github actions cache</a></li><li><a href=https://docs.github.com/en/actions/learn-github-actions/variables#default-environment-variables>github actions - Default environment variables</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://jeha00.github.io/tags/ci/cd/>ci/cd</a></li></ul><nav class=paginav><a class=prev href=http://jeha00.github.io/post/ci_cd/github_action/lecture_03/><span class=title>« Prev Page</span><br><span>CI/CD를 위한 github action study: workflow와 job 실행 제어하기 & Jobs 와 Docker containers</span></a>
<a class=next href=http://jeha00.github.io/post/ci_cd/github_action/lecture_01/><span class=title>Next Page »</span><br><span>CI/CD를 위한 github action study basic</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets on twitter" href="https://twitter.com/intent/tweet/?text=CI%2fCD%eb%a5%bc%20%ec%9c%84%ed%95%9c%20github%20action%20study%3a%20Activity%20type%2c%20filters%2c%20caching%2c%20environment%20variables%20and%20secrets&url=http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_02%2f&hashtags=ci%2fcd"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_02%2f&title=CI%2fCD%eb%a5%bc%20%ec%9c%84%ed%95%9c%20github%20action%20study%3a%20Activity%20type%2c%20filters%2c%20caching%2c%20environment%20variables%20and%20secrets&summary=CI%2fCD%eb%a5%bc%20%ec%9c%84%ed%95%9c%20github%20action%20study%3a%20Activity%20type%2c%20filters%2c%20caching%2c%20environment%20variables%20and%20secrets&source=http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_02%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets on reddit" href="https://reddit.com/submit?url=http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_02%2f&title=CI%2fCD%eb%a5%bc%20%ec%9c%84%ed%95%9c%20github%20action%20study%3a%20Activity%20type%2c%20filters%2c%20caching%2c%20environment%20variables%20and%20secrets"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_02%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets on whatsapp" href="https://api.whatsapp.com/send?text=CI%2fCD%eb%a5%bc%20%ec%9c%84%ed%95%9c%20github%20action%20study%3a%20Activity%20type%2c%20filters%2c%20caching%2c%20environment%20variables%20and%20secrets%20-%20http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_02%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets on telegram" href="https://telegram.me/share/url?text=CI%2fCD%eb%a5%bc%20%ec%9c%84%ed%95%9c%20github%20action%20study%3a%20Activity%20type%2c%20filters%2c%20caching%2c%20environment%20variables%20and%20secrets&url=http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_02%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://jeha00.github.io/>Jeha DevLog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>