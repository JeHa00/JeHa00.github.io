<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CI/CD를 위한 github action study: workflow와 job 실행 제어하기 & Jobs 와 Docker containers | Jeha DevLog</title><meta name=keywords content="ci/cd"><meta name=description content="계속 작업 중"><meta name=author content><link rel=canonical href=http://jeha00.github.io/post/ci_cd/github_action/lecture_03/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.82ffb49f4dad536e46fbe180b43e230f0d308d3cb9127068102090318b24d48c.css integrity="sha256-gv+0n02tU25G++GAtD4jDw0wjTy5EnBoECCQMYsk1Iw=" rel="preload stylesheet" as=style><link rel=icon href=http://jeha00.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://jeha00.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://jeha00.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://jeha00.github.io/apple-touch-icon.png><link rel=mask-icon href=http://jeha00.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.101.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="CI/CD를 위한 github action study: workflow와 job 실행 제어하기 & Jobs 와 Docker containers"><meta property="og:description" content="계속 작업 중"><meta property="og:type" content="article"><meta property="og:url" content="http://jeha00.github.io/post/ci_cd/github_action/lecture_03/"><meta property="og:image" content="http://jeha00.github.io/47"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-08-11T18:29:20+09:00"><meta property="article:modified_time" content="2023-08-11T18:29:20+09:00"><meta property="og:site_name" content="JeHa00 DevLog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://jeha00.github.io/47"><meta name=twitter:title content="CI/CD를 위한 github action study: workflow와 job 실행 제어하기 & Jobs 와 Docker containers"><meta name=twitter:description content="계속 작업 중"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://jeha00.github.io/post/"},{"@type":"ListItem","position":2,"name":"CI/CD를 위한 github action study: workflow와 job 실행 제어하기 \u0026 Jobs 와 Docker containers","item":"http://jeha00.github.io/post/ci_cd/github_action/lecture_03/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CI/CD를 위한 github action study: workflow와 job 실행 제어하기 \u0026 Jobs 와 Docker containers","name":"CI\/CD를 위한 github action study: workflow와 job 실행 제어하기 \u0026 Jobs 와 Docker containers","description":"계속 작업 중","keywords":["ci/cd"],"articleBody":"0. Introduction CI/CD를 위한 github action study basic CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets 프로젝트를 진행하면서 새로 작성된 또는 수정된 코드를 repository에 push하면 자동적으로 테스트를 실행하고, 통과되면 합쳐지고 아니면 에러를 발생시키는 workflow를 적용하고 싶어서 예전부터 공부하고 싶었던 github action에 대해 study를 시작한다.\n국내에서는 github action에 대한 강의나 서적을 찾지 못하여 멘토링을 찾았지만 시간 대비 너무 비싸서 포기했다. 그래서 udemy를 찾던 중 저렴한 가격에 좋은 퀄리티 강의를 찾게 되어 이 강의를 중심으로 학습을 진행한다.\n해당 강좌에서 사용되는 소스 코드를 사용하는 부분들은 빼고 블로그에 정리한다.\n해당 소스 코드를 사용하는 부분이 있다면 그 부분이 없어도 해당 블로그만 봐도 익힐 수 있도록 정리해놓는다.\n이미 알고 있는 개념들도 있지만, 놓치고 있는 부분을 확인하고자 정리해본다.\n🔆 첨부된 링크는 구글에 github actions {keyword} 로 입력하면 제일 첫 번째로 나온다.\n1. Controlling Workflow \u0026 Job Execution 1.1 if and continue-on-error workflow의 job들이 의존적으로 되어있고 실행 흐름 중간에 에러가 발생되면 그 이후 단계는 실행되지 않는다.\n그런데 에러가 발생해도 뒷 작업이 실행되야한다면 어떻게 해야할까?\nif field를 사용해서 조건을 부여하여 이를 제어할 수 있다.\n이 field와 함께 사용할 github actions 함수 몇 가지를 알아보자.\n특별한 조건 함수들 failure(): 한 job의 step이 실패하면 true를 반환 success(): 이전 Step, Job이 성공하면 true를 반환 always(): 이전 step이나 job이 취소되도 언제나 true를 반환 cancelled(): workflow가 취소된 경우 true를 반환 code 그러면 위 내용들을 code에 적용해보자.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 name: Demo on: push: branches: - main jobs: lint: runs-on: ubuntu-latest steps: ... test: runs-on: ubuntu-latest steps: ... - name: Test code # code 추가 id: run-tests # run: npm run test - name: Upload test report # code 추가 if: failure() \u0026\u0026 steps.run-tests.outcome == 'failure' # uses: actions/upload-artifact@v3 with: name: test-report path: test.json build: needs: test runs-on: ubuntu-latest steps: ... deploy: needs: build runs-on: ubuntu-latest steps: ... test.json 추가 프로젝트 .github과 동일한 level로 test.json을 생성한다. 그래서 Upload test report가 실행되면 test.json이 artifacts로서 다운받을 수 있다.\n그리고 name 필드는 artifacts의 이름을 지정한다.\nif 와 id field 적용 그리고 outputs 사용 내가 원하는 workflow 흐름은 Test code 단계 step이 실패하면 Upload test report step이 진행되기를 원한다. 이를 위해서 if 필드를 적용했다. 그리고 확실하게 어느 step인지를 지정하기 위해서 github actions context:steps 문서를 참고하여 id 필드를 적용했다.\n이 id 필드를 사용해서 steps..outputs 나 steps..conclusion을 사용하기 위해서다.\n위 코드에서 conclusions 말고 outcome을 사용한 이유는 continue-on-error 없이 사용하기 위해서다. 먼저 없는 거를 진행해본 후 continue-on-error를 적용해보자.\nfailure() 적용 그리고 failure() 이라는 함수를 추가한 이유는 이전 step들에서 실패하면 Upload test report가 진행되지 않기 때문이다. failure()를 추가하면 해당 step이 반드시 평가되기 때문에 진행된다.\n그러면 failure()만 하면 되지 왜 steps.run-tests.outcome을 추가한 것일까?\nfailure는 바로 직전 step 뿐만 아니라 그 전 step까지 포함하기 때문에 run-test에서 실패하지 않고 그 이전에 실패해도 실행된다. 하지만 내가 원하는 건 Test code 단계에서 실패할 경우이기 때문에 직전 step 실패를 적용하고자 \u0026\u0026 연산자를 추가했다.\nJob과 Step은 if field를 통해서 실행을 조절할 수 있다.\nStep은 continue-on-error filed를 통해서 error를 무시할 수 있다. 그래서 이 표현들을 통해서 조건들을 평가한다.\n그러면 failure()를 또 다른 job에 적용해보자.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 name: Demo on: push: branches: - main jobs: lint: ... test: ... build: ... deploy: ... report: needs: [lint, deploy] if: failure() runs-on: ubuntu-latest steps: - name: Output information run: | echo \"Something went wrong\" echo \"${{github}} 위 report job에서 needs field를 추가한 이유는 이 field를 추가하지 않으면 github action에서는 다른 job이 끝나기를 기다려주지 않기 때문에 강제적으로 선행 job을 지정해야 한다. 그리고 needs에 lint, deploy job만을 지정한 이유는 첫 번째 job이고, 마지막 job을 지정하여 처음과 끝 job 까지 다 거쳐서 그 과정에서 실패할 경우 해당 report job을 실행하도록 했다.\n이 needs를 사용하여 실행한 결과 다음 이미지의 job 순서를 확인할 수 있다. needs를 선정하지 않았다면 lint와 병렬적으로 실행하여 실패한다.\ncache에 if 적용하기 지난 챕터에서 caching을 사용해서 dependency 설치 시간을 감소했다. 하지만 더 좋은 방법은 이미 dependency를 설치하는 캐쉬 데이터가 있다면 해당 step을 진행하지 않는 게 더 좋지 않을까?\n그래서 다음과 같은 코드를 추가하자.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 build: needs: test runs-on: ubuntu-latest steps: - name: Cache dependencies id: cache uses: actions/cache@v3 with: path: ~/.npm key: deps-node-modules-${{ hashFiles('**/package-lock.json') }} - name: Install dependencies # 코드 추가 if: steps.cache.outputs.cache-hit != 'true' run: npm ci # 실행하면 다음과 같이 Install dependencies가 실행되지 않은 걸 알 수 있다.\ncontinue-on-error 적용하기 다음으로 continue-on-error field에 대해 알아보자. 이를 test job에 추가한다. 그러면 test 단계에서 error가 발생해도 다음 단계인 build job이 실행된다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 name: continue on: push: branches: - main jobs: lint: runs-on: ubuntu-latest steps: ... test: runs-on: ubuntu-latest steps: - name: Get code ... - name: Test code # 코드 추가 continue-on-error: true # id: run-tests run: npm run test - name: Upload test report ... build: needs: test runs-on: ubuntu-latest steps: - name: Get code uses: actions/checkout@v3 - name: Cache dependencies id: cache uses: actions/cache@v3 with: path: ~/.npm key: deps-node-modules-${{ hashFiles('**/package-lock.json') }} - name: Install dependencies if: steps.cache.outputs.cache-hit != 'true' run: npm ci ... deploy: ... report: ... continue-on-error가 추가되지 않고 test에서 에러가 발생할 경우 이후 작업은 다 생략된다.\ncontinue-on-error가 추가되고, test에서 에러가 발생할 경우, 이후 작업은 진행된다.\n1.2 Matrix를 사용해서 Job 실행하기 Github actions에서 Matrix란? 이번에는 Matrix에 대해 알아보자.\nMatrix는 runs-on filed로 지정한 운영체제가 만약 여러 종류이고, programming language의 여러 버전을 이라면 이 모든 경우의 수를 모두 workflow를 진행하고자 할 때 사용되는 방식이다.\n새롭게 matrix.yml을 생성하여 다음 코드를 작성해보자.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 name: Matrix Demo on: push jobs: # matrix 미 사용 시 build job build: runs-on: ubuntu-latest steps: - name: Get code uses: actions/checkout@v3 - name: Install NodeJS uses: actions/setup-node@v3 with: node-version: 14 - name: Install Dependencies run: npm ci - name: Build project run: npm run build # matrix 사용 시 build job build: # 추가된 코드 strategy: matrix: version: [12, 14, 16] os: [ubuntu-latest, windows-latest] runs-on: ${{ matrix.os }} # steps: - name: Get code uses: actions/checkout@v3 - name: Install NodeJS uses: actions/setup-node@v3 with: node-version: 14 node-version: ${{ matrix.version }} - name: Install Dependencies run: npm ci - name: Build project run: npm run build matrix가 추가된 workflow를 실행하면 다음과 같은 결과를 확인할 수 있다.\njob이 진행되는 걸 보면 matrix: build 를 확인할 수 있다. matrix로 진행되는 job들은 병렬적으로 진행된다. continue-on-error 가 없기 때문에 선행된 job이 실패해서 이후 job이 canceled 되었다. 하지만 continue-on-error를 job level에서 추가하면 다음과 같이 error가 발생되도 진행되는 걸 알 수 있다.\nmatrix의 include와 exclude matrix는 입력된 key에 대한 모든 조합을 실행한다. 그런데, 이 조합들 중에서 어떤 경우의 수는 배제하면 좋겠고, 어떤 경우의 수는 key에 포함되지 않지만 추가해서 수행되기를 원할 경우 어떻게 해야할까?\n이럴 때는 include와 exclude를 사용한다. 아래와 같이 코드를 작성한다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 name: Matrix Demo on: push jobs: build: continue-on-error: true strategy: matrix: version: [12, 14, 16] os: [ubuntu-latest, windows-latest] # 추가된 코드 include: - version: 18 os: ubuntu-latest exclude: - version: 12 os: windows-latest # runs-on: ${{ matrix.os }} steps: - name: Get code uses: actions/checkout@v3 - name: Install NodeJS uses: actions/setup-node@v3 with: node-version: ${{ matrix.version }} - name: Install Dependencies run: npm ci - name: Build project run: npm run build 실행된 결과는 다음 이미지와 같다.\n이전 이미지를 보면 node 12 version과 windows-latest 인 조합일 때 build 작업을 수행했지만, exclude로 입력하고 나서는 수행되지 않는 걸 확인할 수 있다. 그리고, include로 추가한 version 18과 windows-latest 조합이 수행된 걸 확인할 수 있다. version 18과 ubuntu-latest는 include에 포함되어 있지않고, matrix.version에 18이 없기 때문에 수행되지 않을 걸 확인할 수 있다.\n1.3 workflow 재 사용하기 workflow_call 이용하기 이번 장에서는 A, B workflow가 존재할 때 한 workflow에서 다른 workflow를 가져와 사용하는 방식을 알아보고자 한다.\n예를 들어 workflow reusable.yml 과 use-reuse.yml이 있다. use-reuse.yml에서 reusable.yml을 호출해서 사용할려고 한다.\n그렇다면 reusable.yml의 on field를 다음과 같이 작성해야 한다.\n1 2 3 4 5 6 7 8 9 10 # reusable.yml name: Reusable Deploy on: workflow_call jobs: deploy: runs-on: ubuntu-latest steps: - name: Output information run: echo \"Deploying \u0026 uploading...\" workflow_call은 workflow_dispatch와 달리 workflow가 호출되면 실행되는 event trigger다.\n그리고 reusable.yml을 호출하여 사용할 use-reuse.yml에 아래 코드를 추가한다.\n1 2 3 4 5 6 7 8 # use-reuse.yml jobs: build: ... deploy: needs: build uses: ./.github/workflows/reusable.yml 위 코드를 추가하여 실행한 결과 다음과 같이 deploy / deploy를 확인할 수 있다.\nreusable.yml의 job name이 deploy이고, 이 reusable.yml을 호출한 job이 use-reuse.yml의 deploy이기 때문이다.\nworkflow_call 시 artifacts file name 건네주기 workflow를 호출할 때, 단순히 호출하는 것을 넘어서 특정 값을 전달하여 호출된 workflow가 사용하도록 할 수 있다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 # reusable.yml name: Reusable Deploy on: workflow_call: inputs: artifact-name: description: The name of the deployable artifact files required: false default: dist type: string jobs: deploy: runs-on: ubuntu-latest steps: - name: Get code uses: actions/download-artifact@v3 with: name: ${{ inputs.artifact-name }} - name: List files run: ls - name: Output information run: echo \"Deploying \u0026 uploading...\" # use-reuse.yml name: Demo on: push: branches: - main jobs: test: runs-on: ubuntu-latest steps: ... - name: Upload test report uses: actions/upload-artifact@v3 with: name: dist-files path: dist deploy: needs: build uses: ./.github/workflows/reusable.yml # 추가된 코드 with: artifact-name: dist-files # report: needs: [lint, deploy] if: failure() runs-on: ubuntu-latest steps: - name: Output information run: | echo \"Something went wrong\" echo \"${{github}}\" required: false이면 workflow는 value를 제공하지 않아도 호출되는 게 가능하다는 의미다. default: artifact-name의 default 값이 dist라는 의미 type: 입력되는 타입은 string 문자열이라는 의미 ${{inputs.artifact-name}}으로 해당 값을 가져와서 artifact의 name으로 지정한다.\n2. Github actions with Docker container Docker container 안에서 github action을 실행하는 이유 github actions는 여러 개의 job을 가질 수 있는데, 하나의 job마다 실행 환경 runners를 입력해야만 한다. 이는 우분투, 윈도우, 리눅스, MacOS가 있지만 이는 이미 만들어져있는데 기성품 같은 것이기 때문에 우리가 모든 환경을 조절할 수 없다. 그래서 docker container 너를 각 job의 실행 머신 os로 지정한다면 docker image를 정의한 작성자가 훨씬 더 많은 걸 조절할 수 있기 때문에, docker container를 runners로 지정하는 걸 추천한다.\n기존에 제공하는 os를 사용하면 이에 따라 여러 가지 세팅들을 제공하기 때문에 충분할 수 있으나, 그렇지 않은 상황에서는 container를 추천한다.\n그리고 container를 사용하면 container를 재사용할 수 있다.\nReference github actions - steps context github actions - ","wordCount":"1815","inLanguage":"en","datePublished":"2023-08-11T18:29:20+09:00","dateModified":"2023-08-11T18:29:20+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://jeha00.github.io/post/ci_cd/github_action/lecture_03/"},"publisher":{"@type":"Organization","name":"Jeha DevLog","logo":{"@type":"ImageObject","url":"http://jeha00.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://jeha00.github.io/ accesskey=h title="@Jeha00 (Alt + H)">@Jeha00</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://jeha00.github.io/me/ title=About><span>About</span></a></li><li><a href=http://jeha00.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=http://jeha00.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=http://jeha00.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://jeha00.github.io/>Home</a>&nbsp;»&nbsp;<a href=http://jeha00.github.io/post/>Posts</a></div><h1 class=post-title>CI/CD를 위한 github action study: workflow와 job 실행 제어하기 & Jobs 와 Docker containers</h1><div class=post-meta>CI/CD&nbsp;·&nbsp;<span title='2023-08-11 18:29:20 +0900 KST'>August 11, 2023</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#0-introduction aria-label="0. Introduction">0. Introduction</a></li><li><a href=#1-controlling-workflow--job-execution aria-label="1. Controlling Workflow &amp;amp; Job Execution">1. Controlling Workflow & Job Execution</a><ul><li><a href=#11---if-and-continue-on-error aria-label="1.1   if and continue-on-error">1.1 if and continue-on-error</a><ul><li><a href=#%ed%8a%b9%eb%b3%84%ed%95%9c-%ec%a1%b0%ea%b1%b4-%ed%95%a8%ec%88%98%eb%93%a4 aria-label="특별한 조건 함수들">특별한 조건 함수들</a></li><li><a href=#code aria-label=code>code</a></li><li><a href=#testjson-%ec%b6%94%ea%b0%80 aria-label="test.json 추가">test.json 추가</a></li><li><a href=#if-%ec%99%80-id-field-%ec%a0%81%ec%9a%a9-%ea%b7%b8%eb%a6%ac%ea%b3%a0-outputs-%ec%82%ac%ec%9a%a9 aria-label="if 와 id field 적용 그리고 outputs 사용">if 와 id field 적용 그리고 outputs 사용</a></li><li><a href=#failure-%ec%a0%81%ec%9a%a9 aria-label="failure() 적용">failure() 적용</a></li><li><a href=#cache%ec%97%90-if-%ec%a0%81%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="cache에 if 적용하기">cache에 if 적용하기</a></li><li><a href=#continue-on-error-%ec%a0%81%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="continue-on-error 적용하기">continue-on-error 적용하기</a></li></ul></li><li><a href=#12-matrix%eb%a5%bc-%ec%82%ac%ec%9a%a9%ed%95%b4%ec%84%9c-job-%ec%8b%a4%ed%96%89%ed%95%98%ea%b8%b0 aria-label="1.2 Matrix를 사용해서 Job 실행하기">1.2 Matrix를 사용해서 Job 실행하기</a><ul><li><a href=#github-actions%ec%97%90%ec%84%9c-matrix%eb%9e%80 aria-label="Github actions에서 Matrix란?">Github actions에서 Matrix란?</a></li><li><a href=#matrix%ec%9d%98-include%ec%99%80-exclude aria-label="matrix의 include와 exclude">matrix의 include와 exclude</a></li></ul></li><li><a href=#13-workflow-%ec%9e%ac-%ec%82%ac%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="1.3 workflow 재 사용하기">1.3 workflow 재 사용하기</a><ul><li><a href=#workflow_call-%ec%9d%b4%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="workflow_call 이용하기">workflow_call 이용하기</a></li><li><a href=#workflow_call-%ec%8b%9c-artifacts-file-name-%ea%b1%b4%eb%84%a4%ec%a3%bc%ea%b8%b0 aria-label="workflow_call 시 artifacts file name 건네주기">workflow_call 시 artifacts file name 건네주기</a></li></ul></li></ul></li><li><a href=#2-github-actions-with-docker-container aria-label="2. Github actions with Docker container">2. Github actions with Docker container</a><ul><ul><li><a href=#docker-container-%ec%95%88%ec%97%90%ec%84%9c-github-action%ec%9d%84-%ec%8b%a4%ed%96%89%ed%95%98%eb%8a%94-%ec%9d%b4%ec%9c%a0 aria-label="Docker container 안에서 github action을 실행하는 이유">Docker container 안에서 github action을 실행하는 이유</a></li></ul></ul></li><li><a href=#reference aria-label=Reference>Reference</a></li></ul></div></details></div><div class=post-content><h1 id=0-introduction>0. Introduction<a hidden class=anchor aria-hidden=true href=#0-introduction>#</a></h1><ul><li><a href=https://jeha00.github.io/post/ci_cd/github_action/lecture_01/>CI/CD를 위한 github action study basic</a></li><li><a href=https://jeha00.github.io/post/ci_cd/github_action/lecture_02/>CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets</a></li></ul><p>프로젝트를 진행하면서 새로 작성된 또는 수정된 코드를 repository에 push하면 자동적으로 테스트를 실행하고, 통과되면 합쳐지고 아니면 에러를 발생시키는 workflow를 적용하고 싶어서 예전부터 공부하고 싶었던 github action에 대해 study를 시작한다.</p><p>국내에서는 github action에 대한 강의나 서적을 찾지 못하여 멘토링을 찾았지만 시간 대비 너무 비싸서 포기했다. 그래서 udemy를 찾던 중 저렴한 가격에 좋은 퀄리티 강의를 찾게 되어 이 강의를 중심으로 학습을 진행한다.</p><p>해당 강좌에서 사용되는 소스 코드를 사용하는 부분들은 빼고 블로그에 정리한다.</p><p>해당 소스 코드를 사용하는 부분이 있다면 그 부분이 없어도 해당 블로그만 봐도 익힐 수 있도록 정리해놓는다.</p><p>이미 알고 있는 개념들도 있지만, 놓치고 있는 부분을 확인하고자 정리해본다.</p><p>🔆 첨부된 링크는 구글에 <code>github actions {keyword}</code> 로 입력하면 제일 첫 번째로 나온다.</p><p> </p><h1 id=1-controlling-workflow--job-execution>1. Controlling Workflow & Job Execution<a hidden class=anchor aria-hidden=true href=#1-controlling-workflow--job-execution>#</a></h1><h2 id=11---if-and-continue-on-error>1.1 if and continue-on-error<a hidden class=anchor aria-hidden=true href=#11---if-and-continue-on-error>#</a></h2><hr><p>workflow의 job들이 의존적으로 되어있고 실행 흐름 중간에 에러가 발생되면 그 이후 단계는 실행되지 않는다.</p><p>그런데 에러가 발생해도 뒷 작업이 실행되야한다면 어떻게 해야할까?</p><p><code>if</code> field를 사용해서 조건을 부여하여 이를 제어할 수 있다.</p><p>이 field와 함께 사용할 github actions 함수 몇 가지를 알아보자.</p><h3 id=특별한-조건-함수들>특별한 조건 함수들<a hidden class=anchor aria-hidden=true href=#특별한-조건-함수들>#</a></h3><ul><li>failure(): 한 job의 step이 실패하면 true를 반환</li><li>success(): 이전 Step, Job이 성공하면 true를 반환</li><li>always(): 이전 step이나 job이 취소되도 언제나 true를 반환</li><li>cancelled(): workflow가 취소된 경우 true를 반환</li></ul><h3 id=code>code<a hidden class=anchor aria-hidden=true href=#code>#</a></h3><p>그러면 위 내용들을 code에 적용해보자.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff79c6>name</span>: Demo
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>branches</span>:
</span></span><span style=display:flex><span>      - main
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>lint</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Test code
</span></span><span style=display:flex><span>      <span style=color:#6272a4># code 추가</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>id</span>: run-tests 
</span></span><span style=display:flex><span>      <span style=color:#6272a4>#</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>run</span>: npm run test
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Upload test report
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#6272a4># code 추가</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span>: failure() &amp;&amp; steps.run-tests.outcome == &#39;failure&#39;
</span></span><span style=display:flex><span>      <span style=color:#6272a4>#</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/upload-artifact@v3
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>name</span>: test-report
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>path</span>: test.json
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>needs</span>: test
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>needs</span>: build
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>        ...
</span></span></code></pre></td></tr></table></div></div><h3 id=testjson-추가>test.json 추가<a hidden class=anchor aria-hidden=true href=#testjson-추가>#</a></h3><p>프로젝트 <code>.github</code>과 동일한 level로 <code>test.json</code>을 생성한다. 그래서 Upload test report가 실행되면 test.json이 artifacts로서 다운받을 수 있다.</p><p>그리고 <code>name</code> 필드는 artifacts의 이름을 지정한다.</p><h3 id=if-와-id-field-적용-그리고-outputs-사용>if 와 id field 적용 그리고 outputs 사용<a hidden class=anchor aria-hidden=true href=#if-와-id-field-적용-그리고-outputs-사용>#</a></h3><p>내가 원하는 workflow 흐름은 Test code 단계 step이 실패하면 <code>Upload test report</code> step이 진행되기를 원한다. 이를 위해서 <code>if</code> 필드를 적용했다. 그리고 확실하게 어느 step인지를 지정하기 위해서 <a href=https://docs.github.com/en/actions/learn-github-actions/contexts#steps-context>github actions context:steps</a> 문서를 참고하여 <code>id</code> 필드를 적용했다.<br>이 id 필드를 사용해서 <code>steps.&lt;step_id>.outputs</code> 나 <code>steps.&lt;step_id>.conclusion</code>을 사용하기 위해서다.</p><p>위 코드에서 conclusions 말고 outcome을 사용한 이유는 <code>continue-on-error</code> 없이 사용하기 위해서다. 먼저 없는 거를 진행해본 후 <code>continue-on-error</code>를 적용해보자.</p><h3 id=failure-적용>failure() 적용<a hidden class=anchor aria-hidden=true href=#failure-적용>#</a></h3><p>그리고 <code>failure()</code> 이라는 함수를 추가한 이유는 이전 step들에서 실패하면 <code>Upload test report</code>가 진행되지 않기 때문이다. failure()를 추가하면 해당 step이 반드시 평가되기 때문에 진행된다.</p><p>그러면 <code>failure()</code>만 하면 되지 왜 <code>steps.run-tests.outcome</code>을 추가한 것일까?</p><p><code>failure</code>는 바로 직전 step 뿐만 아니라 그 전 step까지 포함하기 때문에 <code>run-test</code>에서 실패하지 않고 그 이전에 실패해도 실행된다. 하지만 내가 원하는 건 Test code 단계에서 실패할 경우이기 때문에 직전 step 실패를 적용하고자 <code>&&</code> 연산자를 추가했다.</p><p>Job과 Step은 <code>if</code> field를 통해서 실행을 조절할 수 있다.</p><p>Step은 <code>continue-on-error</code> filed를 통해서 error를 무시할 수 있다. 그래서 이 표현들을 통해서 조건들을 평가한다.</p><p>그러면 <code>failure()</code>를 또 다른 job에 적용해보자.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff79c6>name</span>: Demo
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>branches</span>:
</span></span><span style=display:flex><span>      - main
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>lint</span>:
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>test</span>:
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>build</span>:
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>deploy</span>:
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>report</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>needs</span>: [lint, deploy]
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span>: failure()
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ff79c6>name</span>: Output information
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>run</span>: |<span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>                echo &#34;Something went wrong&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>                echo &#34;${{github}}</span>                
</span></span></code></pre></td></tr></table></div></div><p>위 report job에서 <code>needs</code> field를 추가한 이유는 이 field를 추가하지 않으면 github action에서는 다른 job이 끝나기를 기다려주지 않기 때문에 강제적으로 선행 job을 지정해야 한다.
그리고 needs에 lint, deploy job만을 지정한 이유는 첫 번째 job이고, 마지막 job을 지정하여 처음과 끝 job 까지 다 거쳐서 그 과정에서 실패할 경우 해당 report job을 실행하도록 했다.</p><p>이 needs를 사용하여 실행한 결과 다음 이미지의 job 순서를 확인할 수 있다. needs를 선정하지 않았다면 lint와 병렬적으로 실행하여 실패한다.</p><p><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/5db47ae3-b293-47f0-ba37-a60947e70a06#center alt=image></p><h3 id=cache에-if-적용하기>cache에 if 적용하기<a hidden class=anchor aria-hidden=true href=#cache에-if-적용하기>#</a></h3><p>지난 챕터에서 caching을 사용해서 dependency 설치 시간을 감소했다. 하지만 더 좋은 방법은 이미 dependency를 설치하는 캐쉬 데이터가 있다면 해당 step을 진행하지 않는 게 더 좋지 않을까?</p><p>그래서 다음과 같은 코드를 추가하자.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>  <span style=color:#ff79c6>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>needs</span>: test
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Cache dependencies
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>id</span>: cache
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>uses</span>: actions/cache@v3
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>path</span>: ~/.npm
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>key</span>: deps-node-modules-${{ hashFiles(&#39;**/package-lock.json&#39;) }}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Install dependencies
</span></span><span style=display:flex><span>    <span style=color:#6272a4># 코드 추가</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span>: steps.cache.outputs.cache-hit != &#39;true&#39; 
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>run</span>: npm ci 
</span></span><span style=display:flex><span>    <span style=color:#6272a4>#</span>
</span></span></code></pre></td></tr></table></div></div><p>실행하면 다음과 같이 Install dependencies가 실행되지 않은 걸 알 수 있다.</p><p><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/ea05fe5a-a6f6-4681-b398-82c3e18f3cbb#center alt=image></p><h3 id=continue-on-error-적용하기>continue-on-error 적용하기<a hidden class=anchor aria-hidden=true href=#continue-on-error-적용하기>#</a></h3><p>다음으로 <code>continue-on-error</code> field에 대해 알아보자. 이를 test job에 추가한다. 그러면 test 단계에서 error가 발생해도 다음 단계인 build job이 실행된다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff79c6>name</span>: continue
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>branches</span>:
</span></span><span style=display:flex><span>      - main
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>lint</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Get code
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Test code
</span></span><span style=display:flex><span>        <span style=color:#6272a4># 코드 추가</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>continue-on-error</span>: <span style=color:#ff79c6>true</span>  
</span></span><span style=display:flex><span>        <span style=color:#6272a4>#</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>id</span>: run-tests 
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>run</span>: npm run test
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Upload test report
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>needs</span>: test
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Get code
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/checkout@v3
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Cache dependencies
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>id</span>: cache
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/cache@v3
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>path</span>: ~/.npm
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>key</span>: deps-node-modules-${{ hashFiles(&#39;**/package-lock.json&#39;) }}
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Install dependencies
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span>: steps.cache.outputs.cache-hit != &#39;true&#39;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>run</span>: npm ci
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>deploy</span>:
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>report</span>:
</span></span><span style=display:flex><span>    ...
</span></span></code></pre></td></tr></table></div></div><ul><li><p><code>continue-on-error</code>가 추가되지 않고 test에서 에러가 발생할 경우 이후 작업은 다 생략된다.</p><p><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/6d4c8c24-9dbb-430a-850d-b0f0cb1586bb alt=image></p></li><li><p><code>continue-on-error</code>가 추가되고, test에서 에러가 발생할 경우, 이후 작업은 진행된다.</p><p><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/31088f61-8413-48df-9a80-30a08ea37f6a alt=image></p></li></ul><p> </p><h2 id=12-matrix를-사용해서-job-실행하기>1.2 Matrix를 사용해서 Job 실행하기<a hidden class=anchor aria-hidden=true href=#12-matrix를-사용해서-job-실행하기>#</a></h2><hr><h3 id=github-actions에서-matrix란>Github actions에서 Matrix란?<a hidden class=anchor aria-hidden=true href=#github-actions에서-matrix란>#</a></h3><p>이번에는 Matrix에 대해 알아보자.</p><p>Matrix는 runs-on filed로 지정한 운영체제가 만약 여러 종류이고, programming language의 여러 버전을 이라면 이 모든 경우의 수를 모두 workflow를 진행하고자 할 때 사용되는 방식이다.</p><p>새롭게 <code>matrix.yml</code>을 생성하여 다음 코드를 작성해보자.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff79c6>name</span>: Matrix Demo
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>: push
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># matrix 미 사용 시 build job</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>build</span>: 
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Get code
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/checkout@v3
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Install NodeJS
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/setup-node@v3
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>node-version</span>: <span style=color:#bd93f9>14</span>
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Install Dependencies
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>run</span>: npm ci
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Build project
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>run</span>: npm run build 
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#6272a4># matrix 사용 시 build job</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#6272a4># 추가된 코드</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>strategy</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>matrix</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>version</span>: [<span style=color:#bd93f9>12</span>, <span style=color:#bd93f9>14</span>, <span style=color:#bd93f9>16</span>]
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>os</span>: [ubuntu-latest, windows-latest] 
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ${{ matrix.os }} 
</span></span><span style=display:flex><span>    <span style=color:#6272a4>#</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Get code
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/checkout@v3
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Install NodeJS
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/setup-node@v3
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>node-version</span>: <span style=color:#bd93f9>14</span>
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>node-version</span>: ${{ matrix.version }}
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Install Dependencies
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>run</span>: npm ci
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Build project
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>run</span>: npm run build 
</span></span></code></pre></td></tr></table></div></div><p>matrix가 추가된 workflow를 실행하면 다음과 같은 결과를 확인할 수 있다.</p><ul><li>job이 진행되는 걸 보면 <code>matrix: build</code> 를 확인할 수 있다.</li><li>matrix로 진행되는 job들은 병렬적으로 진행된다.</li><li><code>continue-on-error</code> 가 없기 때문에 선행된 job이 실패해서 이후 job이 canceled 되었다.</li></ul><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/ed4e80df-c888-4e65-8076-a159a778878c#center width=80%></figure><p>하지만 <code>continue-on-error</code>를 job level에서 추가하면 다음과 같이 error가 발생되도 진행되는 걸 알 수 있다.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/33f7efa8-2292-432e-a22d-f563ab755385#center width=80%></figure><h3 id=matrix의-include와-exclude>matrix의 include와 exclude<a hidden class=anchor aria-hidden=true href=#matrix의-include와-exclude>#</a></h3><p>matrix는 입력된 key에 대한 모든 조합을 실행한다. 그런데, 이 조합들 중에서 어떤 경우의 수는 배제하면 좋겠고, 어떤 경우의 수는 key에 포함되지 않지만 추가해서 수행되기를 원할 경우 어떻게 해야할까?</p><p>이럴 때는 <code>include</code>와 <code>exclude</code>를 사용한다. 아래와 같이 코드를 작성한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff79c6>name</span>: Matrix Demo
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>: push
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>continue-on-error</span>: <span style=color:#ff79c6>true</span>  
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>strategy</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>matrix</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>version</span>: [<span style=color:#bd93f9>12</span>, <span style=color:#bd93f9>14</span>, <span style=color:#bd93f9>16</span>]
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>os</span>: [ubuntu-latest, windows-latest] 
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#6272a4># 추가된 코드</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>include</span>: 
</span></span><span style=display:flex><span>          - <span style=color:#ff79c6>version</span>: <span style=color:#bd93f9>18</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>os</span>: ubuntu-latest
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>exclude</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ff79c6>version</span>: <span style=color:#bd93f9>12</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>os</span>: windows-latest  
</span></span><span style=display:flex><span>        <span style=color:#6272a4>#</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ${{ matrix.os }} 
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Get code
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/checkout@v3
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Install NodeJS
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/setup-node@v3
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>node-version</span>: ${{ matrix.version }}
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Install Dependencies
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>run</span>: npm ci
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Build project
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>run</span>: npm run build 
</span></span></code></pre></td></tr></table></div></div><p>실행된 결과는 다음 이미지와 같다.</p><p>이전 이미지를 보면 node 12 version과 windows-latest 인 조합일 때 build 작업을 수행했지만, exclude로 입력하고 나서는 수행되지 않는 걸 확인할 수 있다.
그리고, include로 추가한 version 18과 windows-latest 조합이 수행된 걸 확인할 수 있다. version 18과 ubuntu-latest는 include에 포함되어 있지않고,
matrix.version에 18이 없기 때문에 수행되지 않을 걸 확인할 수 있다.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/229f5645-802a-4b66-9266-01c6e8fb281b#center width=50%></figure><p> </p><h2 id=13-workflow-재-사용하기>1.3 workflow 재 사용하기<a hidden class=anchor aria-hidden=true href=#13-workflow-재-사용하기>#</a></h2><h3 id=workflow_call-이용하기>workflow_call 이용하기<a hidden class=anchor aria-hidden=true href=#workflow_call-이용하기>#</a></h3><p>이번 장에서는 A, B workflow가 존재할 때 한 workflow에서 다른 workflow를 가져와 사용하는 방식을 알아보고자 한다.</p><p>예를 들어 workflow reusable.yml 과 use-reuse.yml이 있다. use-reuse.yml에서 reusable.yml을 호출해서 사용할려고 한다.</p><p>그렇다면 reusable.yml의 on field를 다음과 같이 작성해야 한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#6272a4># reusable.yml  </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>name</span>: Reusable Deploy
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>: workflow_call
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest 
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Output information
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>run</span>: echo &#34;Deploying &amp; uploading...&#34;
</span></span></code></pre></td></tr></table></div></div><p><code>workflow_call</code>은 workflow_dispatch와 달리 workflow가 호출되면 실행되는 event trigger다.</p><p>그리고 reusable.yml을 호출하여 사용할 use-reuse.yml에 아래 코드를 추가한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#6272a4># use-reuse.yml</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>build</span>:
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>needs</span>: build
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>uses</span>: ./.github/workflows/reusable.yml  
</span></span></code></pre></td></tr></table></div></div><p>위 코드를 추가하여 실행한 결과 다음과 같이 <code>deploy / deploy</code>를 확인할 수 있다.</p><p>reusable.yml의 job name이 deploy이고, 이 reusable.yml을 호출한 job이 use-reuse.yml의 deploy이기 때문이다.</p><figure><img loading=lazy src=https://github.com/JeHa00/image/assets/78094972/d541c849-cd38-4179-ad3e-748c0115b447#center width=80%></figure><h3 id=workflow_call-시-artifacts-file-name-건네주기>workflow_call 시 artifacts file name 건네주기<a hidden class=anchor aria-hidden=true href=#workflow_call-시-artifacts-file-name-건네주기>#</a></h3><p>workflow를 호출할 때, 단순히 호출하는 것을 넘어서 특정 값을 전달하여 호출된 workflow가 사용하도록 할 수 있다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#6272a4># reusable.yml  </span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>name</span>: Reusable Deploy
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>: 
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>workflow_call</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>inputs</span>: 
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>artifact-name</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>description</span>: The name of the deployable artifact files
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>default</span>: dist 
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>type</span>: string 
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest 
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Get code
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/download-artifact@v3 
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>name</span>: ${{ inputs.artifact-name }}
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: List files
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>run</span>: ls
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Output information
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>run</span>: echo &#34;Deploying &amp; uploading...&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># use-reuse.yml</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>name</span>: Demo
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>branches</span>:
</span></span><span style=display:flex><span>      - main
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>      ...
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Upload test report
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/upload-artifact@v3
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>name</span>: dist-files
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>path</span>: dist
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>needs</span>: build
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>uses</span>: ./.github/workflows/reusable.yml  
</span></span><span style=display:flex><span>    <span style=color:#6272a4># 추가된 코드</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>artifact-name</span>: dist-files  
</span></span><span style=display:flex><span>    <span style=color:#6272a4>#</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>report</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>needs</span>: [lint, deploy]
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span>: failure()
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ff79c6>name</span>: Output information
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>run</span>: |<span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>            echo &#34;Something went wrong&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>            echo &#34;${{github}}&#34;</span>            
</span></span></code></pre></td></tr></table></div></div><ul><li><code>required</code>: false이면 workflow는 value를 제공하지 않아도 호출되는 게 가능하다는 의미다.</li><li><code>default</code>: artifact-name의 default 값이 dist라는 의미</li><li><code>type</code>: 입력되는 타입은 string 문자열이라는 의미</li></ul><p><code>${{inputs.artifact-name}}</code>으로 해당 값을 가져와서 artifact의 name으로 지정한다.</p><p> </p><hr><h1 id=2-github-actions-with-docker-container>2. Github actions with Docker container<a hidden class=anchor aria-hidden=true href=#2-github-actions-with-docker-container>#</a></h1><hr><h3 id=docker-container-안에서-github-action을-실행하는-이유>Docker container 안에서 github action을 실행하는 이유<a hidden class=anchor aria-hidden=true href=#docker-container-안에서-github-action을-실행하는-이유>#</a></h3><p>github actions는 여러 개의 job을 가질 수 있는데, 하나의 job마다 실행 환경 runners를 입력해야만 한다. 이는 우분투, 윈도우, 리눅스, MacOS가 있지만 이는 이미 만들어져있는데 기성품 같은 것이기 때문에 우리가 모든 환경을 조절할 수 없다. 그래서 docker container 너를 각 job의 실행 머신 os로 지정한다면 docker image를 정의한 작성자가 훨씬 더 많은 걸 조절할 수 있기 때문에, docker container를 runners로 지정하는 걸 추천한다.</p><p>기존에 제공하는 os를 사용하면 이에 따라 여러 가지 세팅들을 제공하기 때문에 충분할 수 있으나, 그렇지 않은 상황에서는 container를 추천한다.</p><p>그리고 container를 사용하면 container를 재사용할 수 있다.</p><p> </p><hr><h1 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h1><ul><li><a href=https://docs.github.com/en/actions/learn-github-actions/contexts#steps-context>github actions - steps context</a></li><li><a href>github actions -</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://jeha00.github.io/tags/ci/cd/>ci/cd</a></li></ul><nav class=paginav><a class=prev href=http://jeha00.github.io/post/network/osi_7_layer/4_layer/><span class=title>« Prev Page</span><br><span>[TIL]OSI 7 layer: 4계층 전송 계층</span></a>
<a class=next href=http://jeha00.github.io/post/ci_cd/github_action/lecture_02/><span class=title>Next Page »</span><br><span>CI/CD를 위한 github action study: Activity type, filters, caching, environment variables and secrets</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share CI/CD를 위한 github action study: workflow와 job 실행 제어하기 & Jobs 와 Docker containers on twitter" href="https://twitter.com/intent/tweet/?text=CI%2fCD%eb%a5%bc%20%ec%9c%84%ed%95%9c%20github%20action%20study%3a%20workflow%ec%99%80%20job%20%ec%8b%a4%ed%96%89%20%ec%a0%9c%ec%96%b4%ed%95%98%ea%b8%b0%20%26%20Jobs%20%ec%99%80%20Docker%20containers&url=http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_03%2f&hashtags=ci%2fcd"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share CI/CD를 위한 github action study: workflow와 job 실행 제어하기 & Jobs 와 Docker containers on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_03%2f&title=CI%2fCD%eb%a5%bc%20%ec%9c%84%ed%95%9c%20github%20action%20study%3a%20workflow%ec%99%80%20job%20%ec%8b%a4%ed%96%89%20%ec%a0%9c%ec%96%b4%ed%95%98%ea%b8%b0%20%26%20Jobs%20%ec%99%80%20Docker%20containers&summary=CI%2fCD%eb%a5%bc%20%ec%9c%84%ed%95%9c%20github%20action%20study%3a%20workflow%ec%99%80%20job%20%ec%8b%a4%ed%96%89%20%ec%a0%9c%ec%96%b4%ed%95%98%ea%b8%b0%20%26%20Jobs%20%ec%99%80%20Docker%20containers&source=http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_03%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share CI/CD를 위한 github action study: workflow와 job 실행 제어하기 & Jobs 와 Docker containers on reddit" href="https://reddit.com/submit?url=http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_03%2f&title=CI%2fCD%eb%a5%bc%20%ec%9c%84%ed%95%9c%20github%20action%20study%3a%20workflow%ec%99%80%20job%20%ec%8b%a4%ed%96%89%20%ec%a0%9c%ec%96%b4%ed%95%98%ea%b8%b0%20%26%20Jobs%20%ec%99%80%20Docker%20containers"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share CI/CD를 위한 github action study: workflow와 job 실행 제어하기 & Jobs 와 Docker containers on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_03%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share CI/CD를 위한 github action study: workflow와 job 실행 제어하기 & Jobs 와 Docker containers on whatsapp" href="https://api.whatsapp.com/send?text=CI%2fCD%eb%a5%bc%20%ec%9c%84%ed%95%9c%20github%20action%20study%3a%20workflow%ec%99%80%20job%20%ec%8b%a4%ed%96%89%20%ec%a0%9c%ec%96%b4%ed%95%98%ea%b8%b0%20%26%20Jobs%20%ec%99%80%20Docker%20containers%20-%20http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_03%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share CI/CD를 위한 github action study: workflow와 job 실행 제어하기 & Jobs 와 Docker containers on telegram" href="https://telegram.me/share/url?text=CI%2fCD%eb%a5%bc%20%ec%9c%84%ed%95%9c%20github%20action%20study%3a%20workflow%ec%99%80%20job%20%ec%8b%a4%ed%96%89%20%ec%a0%9c%ec%96%b4%ed%95%98%ea%b8%b0%20%26%20Jobs%20%ec%99%80%20Docker%20containers&url=http%3a%2f%2fjeha00.github.io%2fpost%2fci_cd%2fgithub_action%2flecture_03%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://jeha00.github.io/>Jeha DevLog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>